within ProsNet.Examples;
package Bidirectional_Substation
  package ISGT2024
    model D2c_Licklederer_2prosumers_SF1
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,-5; 600,-5; 1200,-5; 1800,-10; 2400,10; 3600,4;
            4200,-6; 4800,-10; 5400,-4; 6000,6; 6600,10; 7200,-10; 7800,-5;
            8400,-5]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,30; 600,30; 1200,30; 1800,55; 2400,55; 3600,55;
            4200,30; 4800,30; 5400,30; 6000,55; 6600,55; 7200,30; 7800,30; 8400,
            30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,5; 600,5; 1200,5; 1800,10; 2400,-10; 3600,-4; 4200,
            6; 4800,10; 5400,4; 6000,-6; 6600,-10; 7200,10; 7800,5; 8400,5])
        annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,140})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,55; 600,55; 1200,55; 1800,55; 2400,30; 3600,30;
            4200,55; 4800,55; 5400,55; 6000,30; 6600,30; 7200,55; 7800,55; 8400,
            55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{-68,46},{-44,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{42,46},{66,80}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,86},
              {-62,86},{-62,80.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,86},{-50,
              86},{-50,81}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,129},{42,129},
              {42,80.8},{48,80.8}},color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              86},{60,86},{60,81}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{66,62},{76,62},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{42,62},{24,62},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-44,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-68,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200})}),
        experiment(
          StopTime=8400,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D2c_Licklederer_2prosumers_SF1;
  end ISGT2024;

  package Simulations_SF1

    model Speer_IEWT2023 "Producer and Consumer with Controller"
      Real Losses;

      BidirectionalSubstation.New_Substation.HTS PROSUMER1(
        Q_flow_nominal=25273*1.2,
        T_a1_nominal=338.15,
        T_a2_nominal=318.15,
        m_flow_nominal_1=0.41,
        dp1_nominal=20000,
        m_flow_nominal_2=0.41,
        dp2_nominal=20000,
        redeclare Fluid.Pumps.Data.Pumps_FSP.GrundfosCR17AAAEHQQE feedinPer,
        energyDynamics_feedPump=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_feedPump=3,
        use_inputFilter_feedPump=true,
        riseTime_feedPump=35,
        init_feedPump=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_conVal=1.6,
        use_inputFilter_conVal=true,
        riseTime_conVal=35,
        init_conVal=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_cheVal=11,
        length_transfer_pipe_tot=20,
        zeta_transferstation=14.12,
        d_transferpipe=0.0273,
        R_ins_transferpipe=1000,
        ambient_temperature=system.T_ambient,
        energyDynamics_pumpsSec=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_pumpsSec=3,
        use_inputFilter_pumpsSec=true,
        riseTime_pumpsSec=35,
        tau_cv=10,
        T_start_cv=333.15,
        valve_prim_cons(kFixed=0),
        heat_exchanger(T_a1_nominal=338.15, T_a2_nominal=318.15))
        annotation (Placement(transformation(extent={{-190,-10},{-138,42}})));

      BidirectionalSubstation.New_Substation.HTS PROSUMER2(
        Q_flow_nominal=21508*1.2,
        T_a1_nominal=338.15,
        T_a2_nominal=318.15,
        m_flow_nominal_1=0.35,
        dp1_nominal=20000,
        m_flow_nominal_2=0.35,
        dp2_nominal=20000,
        redeclare Fluid.Pumps.Data.Pumps_FSP.GrundfosCR17AAAEHQQE feedinPer,
        energyDynamics_feedPump=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_feedPump=3,
        use_inputFilter_feedPump=true,
        riseTime_feedPump=35,
        init_feedPump=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_conVal=1.6,
        use_inputFilter_conVal=true,
        riseTime_conVal=35,
        init_conVal=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_cheVal=11,
        length_transfer_pipe_tot=20,
        zeta_transferstation=14.15,
        d_transferpipe=0.0273,
        R_ins_transferpipe=1000,
        ambient_temperature=system.T_ambient,
        energyDynamics_pumpsSec=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_pumpsSec=3,
        use_inputFilter_pumpsSec=true,
        riseTime_pumpsSec=35,
        energyDynamics_cv=Modelica.Fluid.Types.Dynamics.SteadyState,
        tau_cv=10,
        T_start_cv=333.15,
        heat_exchanger(T_a1_nominal=PROSUMER2.T_a1_nominal, T_a2_nominal=
              PROSUMER2.T_a2_nominal))
        annotation (Placement(transformation(extent={{-12,2},{-64,56}})));

      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{70,-188},{126,-162}})));
      Fluid.Pipes.InsulatedPipe Pipe_ID_2_pipe_hot_12(
        allowFlowReversal=true,
        T_amb=system.T_ambient,
        R_ins=1000,
        length=40,
        diameter=0.0273,
        zeta=3.6,
        energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
        T_start=313.15)
        annotation (Placement(transformation(extent={{-132,-110},{-96,-74}})));
      Fluid.Pipes.InsulatedPipe Pipe_ID_2_pipe_cold_12(
        allowFlowReversal=true,
        T_amb=system.T_ambient,
        R_ins=1000,
        length=40,
        diameter=0.0273,
        zeta=3.6,
        energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
        T_start=313.15)
        annotation (Placement(transformation(extent={{-98,-66},{-134,-30}})));
      Fluid.Sources.Boundary_pT bou(
        T=330.65,                   nPorts=1, redeclare final package Medium =
            Media.Water)
        annotation (Placement(transformation(extent={{-2,-198},{-46,-154}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Controller_1(
        Delta_Qdot_norm=1,
        Delta_T_norm=3,
        T_prim_hot_des=340.15,
        T_sec_hot_des=333.15,
        DeltaT_prim_des=15,
        DeltaT_sec_des=15,
        V_dot_sec_max=29.02,
        k_prim_prod=1.5,
        Ti_prim_prod=35,
        Td_prim_prod=0,
        alpha_prim_prod=0.85,
        k_sec_prod=1.5,
        Ti_sec_prod=35,
        Td_sec_prod=0,
        alpha_sec_prod=0.85,
        k_prim_cons=1.5,
        Ti_prim_cons=35,
        Td_prim_cons=0,
        alpha_prim_cons=0.9,
        k_sec_cons=1.5,
        Ti_sec_cons=35,
        Td_sec_cons=0,
        alpha_sec_cons=0.4,
        controllerType=Modelica.Blocks.Types.SimpleController.PI,
        initType=Modelica.Blocks.Types.Init.InitialOutput)
        annotation (Placement(transformation(extent={{-268,-4},{-226,44}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        T_sec_in_array_1(table=[0,341.15; 900,341.15; 1800,341.15; 2700,341.15;
            3600,341.15; 4500,341.15; 5400,341.15; 6300,341.15; 7200,341.15;
            8100,318.15; 9000,318.15; 9900,318.15; 10800,318.15; 11700,318.15;
            12600,318.15; 13500,318.15; 14400,318.15; 15300,318.15; 16200,
            318.15; 17100,318.15; 18000,318.15; 18900,341.15; 19800,341.15;
            20700,341.15; 21600,341.15; 22500,341.15; 23400,341.15; 24300,
            341.15; 25200,341.15; 26100,341.15; 27000,341.15; 27900,341.15;
            28800,341.15; 29700,318.15; 30600,318.15; 31500,318.15; 32400,
            318.15; 33300,318.15])
        annotation (Placement(transformation(extent={{-400,32},{-380,52}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Controller_2(
        Delta_Qdot_norm=1,
        Delta_T_norm=3,
        T_prim_hot_des=340.15,
        T_sec_hot_des=333.15,
        DeltaT_prim_des=15,
        DeltaT_sec_des=15,
        V_dot_sec_max=24.7,
        k_prim_prod=1.5,
        Ti_prim_prod=35,
        Td_prim_prod=0,
        alpha_prim_prod=0.85,
        k_sec_prod=1.5,
        Ti_sec_prod=35,
        Td_sec_prod=0,
        alpha_sec_prod=0.85,
        k_prim_cons=1.5,
        Ti_prim_cons=35,
        Td_prim_cons=0,
        alpha_prim_cons=0.9,
        k_sec_cons=1.5,
        Ti_sec_cons=35,
        Td_sec_cons=0,
        alpha_sec_cons=0.4,
        controllerType=Modelica.Blocks.Types.SimpleController.PI,
        initType=Modelica.Blocks.Types.Init.InitialOutput)
        annotation (Placement(transformation(extent={{64,8},{22,56}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        Q_management_array_1(table=[0,12.64; 900,12.64; 1800,12.64; 2700,12.64;
            3600,25.27; 4500,25.27; 5400,25.27; 6300,25.27; 7200,12.64; 8100,-12.64;
            9000,-25.27; 9900,-25.27; 10800,-25.27; 11700,-25.27; 12600,-12.64;
            13500,-12.64; 14400,-25.27; 15300,-25.27; 16200,-25.27; 17100,-25.27;
            18000,-12.64; 18900,12.64; 19800,25.27; 20700,25.27; 21600,25.27;
            22500,25.27; 23400,12.64; 24300,6.32; 25200,12.64; 26100,12.64;
            27000,12.64; 27900,12.64; 28800,6.32; 29700,-6.32; 30600,-12.64;
            31500,-12.64; 32400,-12.64; 33300,-12.64])
        annotation (Placement(transformation(extent={{-316,8},{-296,28}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        Q_management_array_2(table=[0,10.75; 900,10.75; 1800,10.75; 2700,10.75;
            3600,21.51; 4500,21.51; 5400,21.51; 6300,21.51; 7200,10.75; 8100,-10.75;
            9000,-21.51; 9900,-21.51; 10800,-21.51; 11700,-21.51; 12600,-10.75;
            13500,-10.75; 14400,-21.51; 15300,-21.51; 16200,-21.51; 17100,-21.51;
            18000,-10.75; 18900,10.75; 19800,21.51; 20700,21.51; 21600,21.51;
            22500,21.51; 23400,10.75; 24300,5.38; 25200,10.75; 26100,10.75;
            27000,10.75; 27900,10.75; 28800,5.38; 29700,-5.38; 30600,-10.75;
            31500,-10.75; 32400,-10.75; 33300,-10.75])
        annotation (Placement(transformation(extent={{124,-10},{104,10}})));
      inner Modelica.Blocks.Noise.GlobalSeed globalSeed(enableNoise=false,
          fixedSeed=4345)
        annotation (Placement(transformation(extent={{-126,72},{-106,92}})));
      Modelica.Blocks.Noise.NormalNoise normalNoise(
        samplePeriod=30,
        mu=0,
        sigma=3)
        annotation (Placement(transformation(extent={{-400,70},{-380,90}})));
      Modelica.Blocks.Math.Add add
        annotation (Placement(transformation(extent={{-356,54},{-336,74}})));
      Modelica.Blocks.Noise.NormalNoise normalNoise1(
        samplePeriod=30,
        mu=0,
        sigma=3) annotation (Placement(transformation(extent={{178,54},{158,74}})));
      Modelica.Blocks.Math.Add add1
        annotation (Placement(transformation(extent={{132,32},{112,52}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        T_sec_in_array_2(table=[0,341.15; 900,341.15; 1800,341.15; 2700,341.15;
            3600,341.15; 4500,341.15; 5400,341.15; 6300,341.15; 7200,341.15;
            8100,318.15; 9000,318.15; 9900,318.15; 10800,318.15; 11700,318.15;
            12600,318.15; 13500,318.15; 14400,318.15; 15300,318.15; 16200,
            318.15; 17100,318.15; 18000,318.15; 18900,341.15; 19800,341.15;
            20700,341.15; 21600,341.15; 22500,341.15; 23400,341.15; 24300,
            341.15; 25200,341.15; 26100,341.15; 27000,341.15; 27900,341.15;
            28800,341.15; 29700,318.15; 30600,318.15; 31500,318.15; 32400,
            318.15; 33300,318.15])
        annotation (Placement(transformation(extent={{166,-14},{146,6}})));
      BidirectionalSubstation.New_Substation.HTS PROSUMER3(
        Q_flow_nominal=21245*1.2,
        T_a1_nominal=338.15,
        T_a2_nominal=318.15,
        m_flow_nominal_1=0.34,
        dp1_nominal=20000,
        m_flow_nominal_2=0.34,
        dp2_nominal=20000,
        redeclare Fluid.Pumps.Data.Pumps_FSP.GrundfosCR17AAAEHQQE feedinPer,
        energyDynamics_feedPump=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_feedPump=3,
        use_inputFilter_feedPump=true,
        riseTime_feedPump=35,
        init_feedPump=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_conVal=1.6,
        use_inputFilter_conVal=true,
        riseTime_conVal=35,
        init_conVal=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_cheVal=11,
        length_transfer_pipe_tot=20,
        zeta_transferstation=14.15,
        d_transferpipe=0.0273,
        R_ins_transferpipe=1000,
        ambient_temperature=system.T_ambient,
        energyDynamics_pumpsSec=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_pumpsSec=3,
        use_inputFilter_pumpsSec=true,
        riseTime_pumpsSec=35,
        energyDynamics_cv=Modelica.Fluid.Types.Dynamics.SteadyState,
        tau_cv=10,
        T_start_cv=333.15)
        annotation (Placement(transformation(extent={{284,0},{232,54}})));

      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Controller_3(
        Delta_Qdot_norm=1,
        Delta_T_norm=3,
        T_prim_hot_des=340.15,
        T_sec_hot_des=333.15,
        DeltaT_prim_des=15,
        DeltaT_sec_des=15,
        V_dot_sec_max=24.4,
        k_prim_prod=1.5,
        Ti_prim_prod=35,
        Td_prim_prod=0,
        alpha_prim_prod=0.85,
        k_sec_prod=1.5,
        Ti_sec_prod=35,
        Td_sec_prod=0,
        alpha_sec_prod=0.85,
        k_prim_cons=1.5,
        Ti_prim_cons=35,
        Td_prim_cons=0,
        alpha_prim_cons=0.9,
        k_sec_cons=1.5,
        Ti_sec_cons=35,
        Td_sec_cons=0,
        alpha_sec_cons=0.4,
        controllerType=Modelica.Blocks.Types.SimpleController.PI,
        initType=Modelica.Blocks.Types.Init.InitialOutput)
        annotation (Placement(transformation(extent={{360,8},{318,56}})));
      Modelica.Blocks.Noise.NormalNoise normalNoise2(
        samplePeriod=30,
        mu=0,
        sigma=3) annotation (Placement(transformation(extent={{472,54},{452,74}})));
      Modelica.Blocks.Math.Add add2
        annotation (Placement(transformation(extent={{426,32},{406,52}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        T_sec_in_array_3(table=[0,341.15; 900,341.15; 1800,341.15; 2700,341.15;
            3600,341.15; 4500,341.15; 5400,341.15; 6300,341.15; 7200,341.15;
            8100,318.15; 9000,318.15; 9900,318.15; 10800,318.15; 11700,318.15;
            12600,318.15; 13500,341.15; 14400,341.15; 15300,341.15; 16200,
            341.15; 17100,341.15; 18000,341.15; 18900,318.15; 19800,318.15;
            20700,318.15; 21600,318.15; 22500,318.15; 23400,318.15; 24300,
            341.15; 25200,341.15; 26100,341.15; 27000,341.15; 27900,341.15;
            28800,341.15; 29700,318.15; 30600,318.15; 31500,318.15; 32400,
            318.15; 33300,318.15])
        annotation (Placement(transformation(extent={{460,-14},{440,6}})));
      Fluid.Pipes.InsulatedPipe Pipe_ID_4_pipe_cold_23(
        allowFlowReversal=true,
        T_amb=system.T_ambient,
        R_ins=1000,
        length=40,
        diameter=0.036,
        zeta=2.5,
        energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
        T_start=313.15)
        annotation (Placement(transformation(extent={{202,-62},{168,-28}})));
      Fluid.Pipes.InsulatedPipe Pipe_ID_4_pipe_hot_23(
        allowFlowReversal=true,
        T_amb=system.T_ambient,
        R_ins=1000,
        length=40,
        diameter=0.036,
        zeta=2.5,
        energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
        T_start=313.15)
        annotation (Placement(transformation(extent={{168,-106},{202,-72}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        Q_management_array_3(table=[0,8.15; 900,8.15; 1800,8.15; 2700,8.15;
            3600,16.29; 4500,16.29; 5400,16.29; 6300,16.29; 7200,8.15; 8100,-8.15;
            9000,-16.29; 9900,-16.29; 10800,-16.29; 11700,-16.29; 12600,-8.15;
            13500,10.62; 14400,21.24; 15300,21.24; 16200,21.24; 17100,21.24;
            18000,10.62; 18900,-10.62; 19800,-21.24; 20700,-21.24; 21600,-21.24;
            22500,-21.24; 23400,-10.62; 24300,4.07; 25200,8.15; 26100,8.15;
            27000,8.15; 27900,8.15; 28800,4.07; 29700,-4.07; 30600,-8.15; 31500,
            -8.15; 32400,-8.15; 33300,-8.15])
        annotation (Placement(transformation(extent={{422,-14},{402,6}})));
      BidirectionalSubstation.New_Substation.HTS PROSUMER4(
        Q_flow_nominal=41827*1.2,
        T_a1_nominal=338.15,
        T_a2_nominal=318.15,
        m_flow_nominal_1=0.68,
        dp1_nominal=20000,
        m_flow_nominal_2=0.68,
        dp2_nominal=20000,
        redeclare Fluid.Pumps.Data.Pumps_FSP.GrundfosCR35AAAEHQQE feedinPer,
        energyDynamics_feedPump=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_feedPump=3,
        use_inputFilter_feedPump=true,
        riseTime_feedPump=35,
        init_feedPump=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_conVal=2.5,
        use_inputFilter_conVal=true,
        riseTime_conVal=35,
        init_conVal=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_cheVal=20,
        length_transfer_pipe_tot=20,
        zeta_transferstation=18.75,
        d_transferpipe=0.036,
        R_ins_transferpipe=1000,
        ambient_temperature=system.T_ambient,
        energyDynamics_pumpsSec=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_pumpsSec=3,
        use_inputFilter_pumpsSec=true,
        riseTime_pumpsSec=35,
        energyDynamics_cv=Modelica.Fluid.Types.Dynamics.SteadyState,
        tau_cv=10,
        T_start_cv=333.15)
        annotation (Placement(transformation(extent={{580,-6},{512,74}})));

      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Controller_4(
        Delta_Qdot_norm=1,
        Delta_T_norm=3,
        T_prim_hot_des=340.15,
        T_sec_hot_des=333.15,
        DeltaT_prim_des=15,
        DeltaT_sec_des=15,
        V_dot_sec_max=48.03,
        k_prim_prod=1.5,
        Ti_prim_prod=35,
        Td_prim_prod=0,
        alpha_prim_prod=0.85,
        k_sec_prod=1.5,
        Ti_sec_prod=35,
        Td_sec_prod=0,
        alpha_sec_prod=0.85,
        k_prim_cons=1.5,
        Ti_prim_cons=35,
        Td_prim_cons=0,
        alpha_prim_cons=0.9,
        k_sec_cons=1.5,
        Ti_sec_cons=35,
        Td_sec_cons=0,
        alpha_sec_cons=0.4,
        controllerType=Modelica.Blocks.Types.SimpleController.PI,
        initType=Modelica.Blocks.Types.Init.InitialOutput)
        annotation (Placement(transformation(extent={{658,10},{616,58}})));
      Modelica.Blocks.Noise.NormalNoise normalNoise3(
        samplePeriod=30,
        mu=0,
        sigma=3) annotation (Placement(transformation(extent={{768,60},{748,80}})));
      Modelica.Blocks.Math.Add add3
        annotation (Placement(transformation(extent={{722,38},{702,58}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        T_sec_in_array_4(table=[0,318.15; 900,318.15; 1800,318.15; 2700,318.15;
            3600,318.15; 4500,318.15; 5400,318.15; 6300,318.15; 7200,318.15;
            8100,341.15; 9000,341.15; 9900,341.15; 10800,341.15; 11700,341.15;
            12600,341.15; 13500,341.15; 14400,341.15; 15300,341.15; 16200,
            341.15; 17100,341.15; 18000,341.15; 18900,318.15; 19800,318.15;
            20700,318.15; 21600,318.15; 22500,318.15; 23400,318.15; 24300,
            318.15; 25200,318.15; 26100,318.15; 27000,318.15; 27900,318.15;
            28800,318.15; 29700,341.15; 30600,341.15; 31500,341.15; 32400,
            341.15; 33300,341.15])
        annotation (Placement(transformation(extent={{768,-8},{736,24}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        Q_management_array_4(table=[0,-20.91; 900,-20.91; 1800,-20.91; 2700,-20.91;
            3600,-41.83; 4500,-41.83; 5400,-41.83; 6300,-41.83; 7200,-20.91;
            8100,20.91; 9000,41.83; 9900,41.83; 10800,41.83; 11700,41.83; 12600,
            20.91; 13500,6.38; 14400,12.77; 15300,12.77; 16200,12.77; 17100,
            12.77; 18000,6.38; 18900,-6.38; 19800,-12.77; 20700,-12.77; 21600,-12.77;
            22500,-12.77; 23400,-6.38; 24300,-10.46; 25200,-20.91; 26100,-20.91;
            27000,-20.91; 27900,-20.91; 28800,-10.46; 29700,10.46; 30600,20.91;
            31500,20.91; 32400,20.91; 33300,20.91])
        annotation (Placement(transformation(extent={{714,-8},{682,24}})));
      Fluid.Pipes.InsulatedPipe Pipe_ID_6_pipe_hot_34(
        allowFlowReversal=true,
        T_amb=system.T_ambient,
        R_ins=1000,
        length=49.5,
        diameter=0.0419,
        zeta=2.6,
        energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
        T_start=313.15)
        annotation (Placement(transformation(extent={{362,-104},{394,-72}})));
      Fluid.Pipes.InsulatedPipe Pipe_ID_6_pipe_cold_34(
        allowFlowReversal=true,
        T_amb=system.T_ambient,
        R_ins=1000,
        length=49.5,
        diameter=0.0419,
        zeta=2.6,
        energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
        T_start=313.15)
        annotation (Placement(transformation(extent={{394,-60},{360,-26}})));
      BidirectionalSubstation.New_Substation.HTS PROSUMER5(
        Q_flow_nominal=21245*1.2,
        T_a1_nominal=338.15,
        T_a2_nominal=318.15,
        m_flow_nominal_1=0.34,
        dp1_nominal=20000,
        m_flow_nominal_2=0.34,
        dp2_nominal=20000,
        redeclare Fluid.Pumps.Data.Pumps_FSP.GrundfosCR17AAAEHQQE feedinPer,
        energyDynamics_feedPump=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_feedPump=3,
        use_inputFilter_feedPump=true,
        riseTime_feedPump=35,
        init_feedPump=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_conVal=1.6,
        use_inputFilter_conVal=true,
        riseTime_conVal=35,
        init_conVal=Modelica.Blocks.Types.Init.InitialOutput,
        Kv_cheVal=11,
        length_transfer_pipe_tot=20,
        zeta_transferstation=14.15,
        d_transferpipe=0.0273,
        R_ins_transferpipe=1000,
        ambient_temperature=system.T_ambient,
        energyDynamics_pumpsSec=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
        tau_pumpsSec=3,
        use_inputFilter_pumpsSec=true,
        riseTime_pumpsSec=35,
        energyDynamics_cv=Modelica.Fluid.Types.Dynamics.SteadyState,
        tau_cv=10,
        T_start_cv=333.15)
        annotation (Placement(transformation(extent={{858,-6},{796,76}})));

      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Controller_5(
        Delta_Qdot_norm=1,
        Delta_T_norm=3,
        T_prim_hot_des=340.15,
        T_sec_hot_des=333.15,
        DeltaT_prim_des=15,
        DeltaT_sec_des=15,
        V_dot_sec_max=24.4,
        k_prim_prod=1.5,
        Ti_prim_prod=35,
        Td_prim_prod=0,
        alpha_prim_prod=0.85,
        k_sec_prod=1.5,
        Ti_sec_prod=35,
        Td_sec_prod=0,
        alpha_sec_prod=0.85,
        k_prim_cons=1.5,
        Ti_prim_cons=35,
        Td_prim_cons=0,
        alpha_prim_cons=0.9,
        k_sec_cons=1.5,
        Ti_sec_cons=35,
        Td_sec_cons=0,
        alpha_sec_cons=0.4,
        controllerType=Modelica.Blocks.Types.SimpleController.PI,
        initType=Modelica.Blocks.Types.Init.InitialOutput)
        annotation (Placement(transformation(extent={{936,20},{894,68}})));
      Modelica.Blocks.Noise.NormalNoise normalNoise4(
        samplePeriod=30,
        mu=0,
        sigma=3) annotation (Placement(transformation(extent={{1046,62},{1026,
                82}})));
      Modelica.Blocks.Math.Add add4
        annotation (Placement(transformation(extent={{1000,40},{980,60}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        T_sec_in_array_5(table=[0,318.15; 900,318.15; 1800,318.15; 2700,318.15;
            3600,318.15; 4500,318.15; 5400,318.15; 6300,318.15; 7200,318.15;
            8100,341.15; 9000,341.15; 9900,341.15; 10800,341.15; 11700,341.15;
            12600,341.15; 13500,341.15; 14400,341.15; 15300,341.15; 16200,
            341.15; 17100,341.15; 18000,341.15; 18900,318.15; 19800,318.15;
            20700,318.15; 21600,318.15; 22500,318.15; 23400,318.15; 24300,
            318.15; 25200,318.15; 26100,318.15; 27000,318.15; 27900,318.15;
            28800,318.15; 29700,341.15; 30600,341.15; 31500,341.15; 32400,
            341.15; 33300,341.15])
        annotation (Placement(transformation(extent={{1044,-16},{1012,16}})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        Q_management_array_5(table=[0,-10.62; 900,-10.62; 1800,-10.62; 2700,-10.62;
            3600,-21.24; 4500,-21.24; 5400,-21.24; 6300,-21.24; 7200,-10.62;
            8100,10.62; 9000,21.24; 9900,21.24; 10800,21.24; 11700,21.24; 12600,
            10.62; 13500,6.38; 14400,12.77; 15300,12.77; 16200,12.77; 17100,
            12.77; 18000,6.38; 18900,-6.38; 19800,-12.77; 20700,-12.77; 21600,-12.77;
            22500,-12.77; 23400,-6.38; 24300,-5.31; 25200,-10.62; 26100,-10.62;
            27000,-10.62; 27900,-10.62; 28800,-5.31; 29700,5.31; 30600,10.62;
            31500,10.62; 32400,10.62; 33300,10.62])
        annotation (Placement(transformation(extent={{992,-16},{960,16}})));
      Fluid.Pipes.InsulatedPipe Pipe_ID_8_pipe_hot_45(
        allowFlowReversal=true,
        T_amb=system.T_ambient,
        R_ins=1000,
        length=46.5,
        diameter=0.0273,
        zeta=4.3,
        energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
        T_start=313.15)
        annotation (Placement(transformation(extent={{680,-104},{712,-72}})));
      Fluid.Pipes.InsulatedPipe Pipe_ID_8_pipe_cold_45(
        allowFlowReversal=true,
        T_amb=system.T_ambient,
        R_ins=1000,
        length=46.5,
        diameter=0.0273,
        zeta=4.3,
        energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
        T_start=313.15)
        annotation (Placement(transformation(extent={{712,-60},{680,-28}})));
    equation
      Losses =PROSUMER1.Q_dot_trnsf_is + PROSUMER2.Q_dot_trnsf_is;

      connect(Pipe_ID_2_pipe_hot_12.port_a, PROSUMER1.hot_prim) annotation (
          Line(points={{-132,-92},{-182.2,-92},{-182.2,-10.2889}},     color={0,
              127,255}));
      connect(Pipe_ID_2_pipe_hot_12.port_b, PROSUMER2.hot_prim) annotation (
          Line(points={{-96,-92},{-19.8,-92},{-19.8,1.7}},        color={0,127,
              255}));
      connect(Pipe_ID_2_pipe_cold_12.port_a, PROSUMER2.cold_prim) annotation (
          Line(points={{-98,-48},{-52,-48},{-52,-20},{-56.2,-20},{-56.2,2}},
            color={0,127,255}));
      connect(PROSUMER1.cold_prim, Pipe_ID_2_pipe_cold_12.port_b) annotation (
          Line(points={{-145.8,-10},{-145.8,-48},{-134,-48}},      color={0,127,
              255}));
      connect(bou.ports[1], Pipe_ID_2_pipe_hot_12.port_b) annotation (Line(
            points={{-46,-176},{-80,-176},{-80,-92},{-96,-92}}, color={0,127,
              255}));
      connect(Controller_1.T_sec_set, PROSUMER1.T_sec_in_set) annotation (Line(
            points={{-226,44},{-226,52},{-210,52},{-210,36.2222},{-190,36.2222}},
            color={0,0,127}));
      connect(Controller_1.V_dot_sec_set, PROSUMER1.V_dot_sec_set) annotation (
          Line(points={{-226,34.4},{-212,34.4},{-212,30.4444},{-190,30.4444}},
            color={0,0,127}));
      connect(Controller_1.pi_set, PROSUMER1.pi) annotation (Line(points={{-226,
              24.8},{-190,21.7778}}, color={255,127,0}));
      connect(Controller_1.mu_set, PROSUMER1.mu) annotation (Line(points={{-226,
              15.2},{-210,15.2},{-210,16},{-190,16}}, color={255,127,0}));
      connect(PROSUMER1.u_set, Controller_1.u_set) annotation (Line(points={{-190,
              10.2222},{-190,5.6},{-226,5.6}},      color={0,0,127}));
      connect(PROSUMER1.kappa_set, Controller_1.kappa_set) annotation (Line(
            points={{-190,4.44444},{-210,4.44444},{-210,-16},{-226,-16},{-226,-4}},
                    color={0,0,127}));
      connect(PROSUMER1.T_sec_hot, Controller_1.T_sec_hot) annotation (Line(
            points={{-169.2,42},{-169.2,54},{-252,54},{-252,46},{-253.3,46},{
              -253.3,44}},
                    color={0,0,127}));
      connect(PROSUMER1.T_sec_cold, Controller_1.T_sec_cold) annotation (Line(
            points={{-141.467,42},{-192,42},{-192,44},{-240.7,44}},
                                                            color={0,0,127}));
      connect(PROSUMER1.V_dot_sec, Controller_1.V_dot_sec) annotation (Line(
            points={{-155.333,42},{-155.333,58},{-278,58},{-278,34.4},{-268,34.4}},
                      color={0,0,127}));
      connect(PROSUMER1.T_prim_hot, Controller_1.T_prim_hot) annotation (Line(
            points={{-169.2,-10},{-169.2,-18},{-252,-18},{-252,-10},{-253.3,-10},
              {-253.3,-4}}, color={0,0,127}));
      connect(PROSUMER1.T_prim_cold, Controller_1.T_prim_cold) annotation (Line(
            points={{-141.467,-10},{-218,-10},{-218,-12},{-240.7,-12},{-240.7,-4}},
            color={0,0,127}));
      connect(Controller_1.V_dot_prim, PROSUMER1.V_dot_prim) annotation (Line(
            points={{-268,5.6},{-278,5.6},{-278,-22},{-155.333,-22},{-155.333,-10}},
                    color={0,0,127}));
      connect(PROSUMER1.Q_dot_trnsf_is, Controller_1.Qdot_is) annotation (Line(
            points={{-190,-4.22222},{-214,-4.22222},{-214,-24},{-280,-24},{-280,
              15.2},{-268,15.2}}, color={0,0,127}));
      connect(Controller_2.T_sec_set, PROSUMER2.T_sec_in_set) annotation (Line(
            points={{22,56},{22,64},{0,64},{0,50},{-12,50}}, color={0,0,127}));
      connect(Controller_2.V_dot_sec_set, PROSUMER2.V_dot_sec_set) annotation (
          Line(points={{22,46.4},{0,46.4},{0,44},{-12,44}}, color={0,0,127}));
      connect(Controller_2.pi_set, PROSUMER2.pi)
        annotation (Line(points={{22,36.8},{-12,35}}, color={255,127,0}));
      connect(Controller_2.mu_set, PROSUMER2.mu) annotation (Line(points={{22,27.2},
              {0,27.2},{0,29},{-12,29}},       color={255,127,0}));
      connect(Controller_2.u_set, PROSUMER2.u_set) annotation (Line(points={{22,17.6},
              {0,17.6},{0,23},{-12,23}},       color={0,0,127}));
      connect(Controller_2.kappa_set, PROSUMER2.kappa_set) annotation (Line(
            points={{22,8},{14,8},{14,-6},{-2,-6},{-2,14},{-12,14},{-12,17}},
            color={0,0,127}));
      connect(PROSUMER2.T_sec_hot, Controller_2.T_sec_hot) annotation (Line(
            points={{-32.8,56},{-32.8,68},{48,68},{48,58},{49.3,58},{49.3,56}},
            color={0,0,127}));
      connect(PROSUMER2.T_sec_cold, Controller_2.T_sec_cold) annotation (Line(
            points={{-60.5333,56},{-56,56},{-56,66},{36.7,66},{36.7,56}}, color=
             {0,0,127}));
      connect(PROSUMER2.V_dot_sec, Controller_2.V_dot_sec) annotation (Line(
            points={{-46.6667,56},{-46.6667,72},{74,72},{74,46.4},{64,46.4}},
            color={0,0,127}));
      connect(PROSUMER2.T_prim_hot, Controller_2.T_prim_hot) annotation (Line(
            points={{-32.8,2},{-32.8,-10},{48,-10},{48,2},{49.3,2},{49.3,8}},
            color={0,0,127}));
      connect(PROSUMER2.T_prim_cold, Controller_2.T_prim_cold) annotation (Line(
            points={{-60.5333,2},{-60,2},{-60,-16},{36.7,-16},{36.7,8}}, color=
              {0,0,127}));
      connect(PROSUMER2.V_dot_prim, Controller_2.V_dot_prim) annotation (Line(
            points={{-46.6667,2},{-46,2},{-46,-14},{74,-14},{74,17.6},{64,17.6}},
            color={0,0,127}));
      connect(PROSUMER2.Q_dot_trnsf_is, Controller_2.Qdot_is) annotation (Line(
            points={{-12,8},{-4,8},{-4,-18},{76,-18},{76,27.2},{64,27.2}},
            color={0,0,127}));
      connect(Q_management_array_1.y, Controller_1.Qdot_set) annotation (Line(
            points={{-295,18},{-278,18},{-278,24.8},{-268,24.8}}, color={0,0,127}));
      connect(Q_management_array_2.y, Controller_2.Qdot_set) annotation (Line(
            points={{103,0},{84,0},{84,36.8},{64,36.8}}, color={0,0,127}));
      connect(normalNoise.y, add.u1) annotation (Line(points={{-379,80},{-366,80},{
              -366,70},{-358,70}}, color={0,0,127}));
      connect(T_sec_in_array_1.y, add.u2) annotation (Line(points={{-379,42},{-366,
              42},{-366,58},{-358,58}}, color={0,0,127}));
      connect(add.y, Controller_1.T_sec_sim) annotation (Line(points={{-335,64},{
              -318,64},{-318,44},{-268,44}},
                                        color={0,0,127}));
      connect(normalNoise1.y, add1.u1) annotation (Line(points={{157,64},{144,64},{
              144,48},{134,48}}, color={0,0,127}));
      connect(add1.y, Controller_2.T_sec_sim) annotation (Line(points={{111,42},{
              80,42},{80,56},{64,56}},
                                    color={0,0,127}));
      connect(T_sec_in_array_2.y, add1.u2) annotation (Line(points={{145,-4},{136,
              -4},{136,26},{142,26},{142,36},{134,36}}, color={0,0,127}));
      connect(Controller_3.T_sec_set, PROSUMER3.T_sec_in_set) annotation (Line(
            points={{318,56},{318,64},{294,64},{294,48},{284,48}}, color={0,0,
              127}));
      connect(Controller_3.V_dot_sec_set, PROSUMER3.V_dot_sec_set) annotation (
          Line(points={{318,46.4},{294,46.4},{294,42},{284,42}}, color={0,0,127}));
      connect(Controller_3.pi_set, PROSUMER3.pi)
        annotation (Line(points={{318,36.8},{284,33}}, color={255,127,0}));
      connect(Controller_3.mu_set, PROSUMER3.mu) annotation (Line(points={{318,
              27.2},{294,27.2},{294,27},{284,27}}, color={255,127,0}));
      connect(Controller_3.u_set, PROSUMER3.u_set) annotation (Line(points={{318,
              17.6},{294,17.6},{294,21},{284,21}},     color={0,0,127}));
      connect(Controller_3.kappa_set, PROSUMER3.kappa_set) annotation (Line(
            points={{318,8},{308,8},{308,-6},{292,-6},{292,14},{284,14},{284,15}},
            color={0,0,127}));
      connect(PROSUMER3.T_sec_hot, Controller_3.T_sec_hot) annotation (Line(
            points={{263.2,54},{263.2,68},{342,68},{342,58},{345.3,58},{345.3,56}},
                    color={0,0,127}));
      connect(PROSUMER3.T_sec_cold, Controller_3.T_sec_cold) annotation (Line(
            points={{235.467,54},{238,54},{238,66},{332.7,66},{332.7,56}},
            color={0,0,127}));
      connect(PROSUMER3.V_dot_sec, Controller_3.V_dot_sec) annotation (Line(
            points={{249.333,54},{249.333,72},{368,72},{368,46.4},{360,46.4}},
            color={0,0,127}));
      connect(PROSUMER3.T_prim_hot, Controller_3.T_prim_hot) annotation (Line(
            points={{263.2,0},{263.2,-10},{342,-10},{342,2},{345.3,2},{345.3,8}},
            color={0,0,127}));
      connect(PROSUMER3.T_prim_cold, Controller_3.T_prim_cold) annotation (Line(
            points={{235.467,0},{234,0},{234,-16},{332.7,-16},{332.7,8}}, color=
             {0,0,127}));
      connect(PROSUMER3.V_dot_prim, Controller_3.V_dot_prim) annotation (Line(
            points={{249.333,0},{248,0},{248,-14},{368,-14},{368,17.6},{360,17.6}},
                      color={0,0,127}));
      connect(PROSUMER3.Q_dot_trnsf_is, Controller_3.Qdot_is) annotation (Line(
            points={{284,6},{290,6},{290,-18},{370,-18},{370,27.2},{360,27.2}},
            color={0,0,127}));
      connect(normalNoise2.y,add2. u1) annotation (Line(points={{451,64},{438,64},{
              438,48},{428,48}}, color={0,0,127}));
      connect(add2.y, Controller_3.T_sec_sim) annotation (Line(points={{405,42},{
              374,42},{374,56},{360,56}}, color={0,0,127}));
      connect(T_sec_in_array_3.y, add2.u2) annotation (Line(points={{439,-4},{430,
              -4},{430,26},{436,26},{436,36},{428,36}}, color={0,0,127}));
      connect(Pipe_ID_2_pipe_cold_12.port_a, Pipe_ID_4_pipe_cold_23.port_b)
        annotation (Line(points={{-98,-48},{42,-48},{42,-45},{168,-45}}, color=
              {0,127,255}));
      connect(Pipe_ID_2_pipe_hot_12.port_b, Pipe_ID_4_pipe_hot_23.port_a)
        annotation (Line(points={{-96,-92},{38,-92},{38,-89},{168,-89}}, color=
              {0,127,255}));
      connect(Pipe_ID_4_pipe_cold_23.port_a, PROSUMER3.cold_prim) annotation (
          Line(points={{202,-45},{240,-45},{240,-8},{239.8,-8},{239.8,0}},
            color={0,127,255}));
      connect(PROSUMER3.hot_prim, Pipe_ID_4_pipe_hot_23.port_b) annotation (
          Line(points={{276.2,-0.3},{256,-0.3},{256,-89},{202,-89}},   color={0,
              127,255}));
      connect(Q_management_array_3.y, Controller_3.Qdot_set) annotation (Line(
            points={{401,-4},{376,-4},{376,36.8},{360,36.8}}, color={0,0,127}));
      connect(Controller_4.T_sec_set, PROSUMER4.T_sec_in_set) annotation (Line(
            points={{616,58},{616,70},{590,70},{590,65.1111},{580,65.1111}},
                                                                   color={0,0,
              127}));
      connect(Controller_4.V_dot_sec_set, PROSUMER4.V_dot_sec_set) annotation (
          Line(points={{616,48.4},{590,48.4},{590,56.2222},{580,56.2222}},
                                                                 color={0,0,127}));
      connect(Controller_4.pi_set, PROSUMER4.pi)
        annotation (Line(points={{616,38.8},{580,42.8889}},
                                                       color={255,127,0}));
      connect(Controller_4.mu_set, PROSUMER4.mu) annotation (Line(points={{616,
              29.2},{590,29.2},{590,34},{580,34}}, color={255,127,0}));
      connect(Controller_4.u_set, PROSUMER4.u_set) annotation (Line(points={{616,
              19.6},{590,19.6},{590,25.1111},{580,25.1111}},
                                                       color={0,0,127}));
      connect(Controller_4.kappa_set, PROSUMER4.kappa_set) annotation (Line(
            points={{616,10},{604,10},{604,0},{588,0},{588,20},{580,20},{580,
              16.2222}},
            color={0,0,127}));
      connect(PROSUMER4.T_sec_hot, Controller_4.T_sec_hot) annotation (Line(
            points={{552.8,74},{638,74},{638,64},{643.3,64},{643.3,58}},
                    color={0,0,127}));
      connect(PROSUMER4.T_sec_cold, Controller_4.T_sec_cold) annotation (Line(
            points={{516.533,74},{534,74},{534,72},{630.7,72},{630.7,58}},
            color={0,0,127}));
      connect(PROSUMER4.V_dot_sec, Controller_4.V_dot_sec) annotation (Line(
            points={{534.667,74},{664,74},{664,48.4},{658,48.4}},
            color={0,0,127}));
      connect(PROSUMER4.T_prim_hot, Controller_4.T_prim_hot) annotation (Line(
            points={{552.8,-6},{552.8,-4},{638,-4},{638,8},{643.3,8},{643.3,10}},
            color={0,0,127}));
      connect(PROSUMER4.T_prim_cold, Controller_4.T_prim_cold) annotation (Line(
            points={{516.533,-6},{530,-6},{530,-10},{630.7,-10},{630.7,10}},
            color={0,0,127}));
      connect(PROSUMER4.V_dot_prim, Controller_4.V_dot_prim) annotation (Line(
            points={{534.667,-6},{544,-6},{544,-8},{664,-8},{664,19.6},{658,19.6}},
            color={0,0,127}));
      connect(PROSUMER4.Q_dot_trnsf_is, Controller_4.Qdot_is) annotation (Line(
            points={{580,2.88889},{586,2.88889},{586,-12},{666,-12},{666,29.2},{
              658,29.2}},
            color={0,0,127}));
      connect(normalNoise3.y,add3. u1) annotation (Line(points={{747,70},{734,
              70},{734,54},{724,54}},
                                 color={0,0,127}));
      connect(add3.y,Controller_4. T_sec_sim) annotation (Line(points={{701,48},{
              670,48},{670,58},{658,58}}, color={0,0,127}));
      connect(T_sec_in_array_4.y,add3. u2) annotation (Line(points={{734.4,8},{
              726,8},{726,32},{732,32},{732,42},{724,42}},
                                                        color={0,0,127}));
      connect(Q_management_array_4.y,Controller_4. Qdot_set) annotation (Line(
            points={{680.4,8},{672,8},{672,38.8},{658,38.8}}, color={0,0,127}));
      connect(Pipe_ID_6_pipe_hot_34.port_a, Pipe_ID_4_pipe_hot_23.port_b)
        annotation (Line(points={{362,-88},{282,-88},{282,-89},{202,-89}},
            color={0,127,255}));
      connect(PROSUMER4.cold_prim, Pipe_ID_6_pipe_cold_34.port_a) annotation (
          Line(points={{522.2,-6},{537.2,-6},{537.2,-43},{394,-43}},   color={0,
              127,255}));
      connect(Pipe_ID_6_pipe_cold_34.port_b, PROSUMER3.cold_prim) annotation (
          Line(points={{360,-43},{238,-43},{238,-45},{240,-45},{240,-8},{239.8,-8},{239.8,
              0}},               color={0,127,255}));
      connect(PROSUMER4.hot_prim, Pipe_ID_6_pipe_hot_34.port_b) annotation (
          Line(points={{569.8,-6.44444},{554.866,-6.44444},{554.866,-88},{394,-88}},
            color={0,127,255}));
      connect(Controller_5.T_sec_set, PROSUMER5.T_sec_in_set) annotation (Line(
            points={{894,68},{894,72},{868,72},{868,66.8889},{858,66.8889}},
                                                                   color={0,0,
              127}));
      connect(Controller_5.V_dot_sec_set, PROSUMER5.V_dot_sec_set) annotation (
          Line(points={{894,58.4},{868,58.4},{868,57.7778},{858,57.7778}},
                                                                 color={0,0,127}));
      connect(Controller_5.pi_set, PROSUMER5.pi)
        annotation (Line(points={{894,48.8},{858,44.1111}},
                                                       color={255,127,0}));
      connect(Controller_5.mu_set, PROSUMER5.mu) annotation (Line(points={{894,
              39.2},{868,39.2},{868,35},{858,35}}, color={255,127,0}));
      connect(Controller_5.u_set, PROSUMER5.u_set) annotation (Line(points={{894,
              29.6},{868,29.6},{868,25.8889},{858,25.8889}},
                                                       color={0,0,127}));
      connect(Controller_5.kappa_set, PROSUMER5.kappa_set) annotation (Line(
            points={{894,20},{882,20},{882,2},{866,2},{866,22},{858,22},{858,
              16.7778}},
            color={0,0,127}));
      connect(PROSUMER5.T_sec_hot, Controller_5.T_sec_hot) annotation (Line(
            points={{833.2,76},{916,76},{916,68},{921.3,68}},
                    color={0,0,127}));
      connect(PROSUMER5.T_sec_cold, Controller_5.T_sec_cold) annotation (Line(
            points={{800.133,76},{812,76},{812,74},{908.7,74},{908.7,68}},
            color={0,0,127}));
      connect(PROSUMER5.V_dot_sec, Controller_5.V_dot_sec) annotation (Line(
            points={{816.667,76},{816.667,80},{942,80},{942,58.4},{936,58.4}},
            color={0,0,127}));
      connect(PROSUMER5.T_prim_hot, Controller_5.T_prim_hot) annotation (Line(
            points={{833.2,-6},{833.2,-2},{916,-2},{916,10},{921.3,10},{921.3,20}},
            color={0,0,127}));
      connect(PROSUMER5.T_prim_cold, Controller_5.T_prim_cold) annotation (Line(
            points={{800.133,-6},{808,-6},{808,-8},{908.7,-8},{908.7,20}},
                                                                         color=
              {0,0,127}));
      connect(PROSUMER5.V_dot_prim, Controller_5.V_dot_prim) annotation (Line(
            points={{816.667,-6},{942,-6},{942,29.6},{936,29.6}},
            color={0,0,127}));
      connect(PROSUMER5.Q_dot_trnsf_is, Controller_5.Qdot_is) annotation (Line(
            points={{858,3.11111},{864,3.11111},{864,-10},{944,-10},{944,39.2},{
              936,39.2}},
            color={0,0,127}));
      connect(normalNoise4.y,add4. u1) annotation (Line(points={{1025,72},{1012,
              72},{1012,56},{1002,56}},
                                 color={0,0,127}));
      connect(add4.y,Controller_5. T_sec_sim) annotation (Line(points={{979,50},{
              948,50},{948,68},{936,68}}, color={0,0,127}));
      connect(T_sec_in_array_5.y,add4. u2) annotation (Line(points={{1010.4,0},{
              1004,0},{1004,34},{1010,34},{1010,44},{1002,44}},
                                                        color={0,0,127}));
      connect(Q_management_array_5.y,Controller_5. Qdot_set) annotation (Line(
            points={{958.4,0},{950,0},{950,48.8},{936,48.8}}, color={0,0,127}));
      connect(PROSUMER5.cold_prim, Pipe_ID_8_pipe_cold_45.port_a) annotation (
          Line(points={{805.3,-6},{815.2,-6},{815.2,-44},{712,-44}},   color={0,
              127,255}));
      connect(Pipe_ID_8_pipe_cold_45.port_b, Pipe_ID_6_pipe_cold_34.port_a)
        annotation (Line(points={{680,-44},{536,-44},{536,-43},{394,-43}},
                          color={0,127,255}));
      connect(Pipe_ID_8_pipe_hot_45.port_b, PROSUMER5.hot_prim) annotation (
          Line(points={{712,-88},{834,-88},{834,-6.45556},{848.7,-6.45556}},
                                                                     color={0,
              127,255}));
      connect(Pipe_ID_8_pipe_hot_45.port_a, Pipe_ID_6_pipe_hot_34.port_b)
        annotation (Line(points={{680,-88},{394,-88}},
            color={0,127,255}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-440,
                -220},{1060,120}})),Diagram(coordinateSystem(preserveAspectRatio=
                false, extent={{-440,-220},{1060,120}}),graphics={
            Text(
              extent={{-142,-24},{-98,-38}},
              textColor={28,108,200},
              textString="cold"),
            Text(
              extent={{-134,-124},{-98,-140}},
              textColor={238,46,47},
              textString="hot"),
            Text(
              extent={{514,116},{594,82}},
              textColor={0,0,0},
              textString="Prosumer4
MF5"),      Text(
              extent={{792,118},{872,84}},
              textColor={0,0,0},
              textString="Prosumer5
SF2"),      Text(
              extent={{268,110},{348,76}},
              textColor={0,0,0},
              textString="Prosumer3
SF4"),      Text(
              extent={{-32,114},{48,80}},
              textColor={0,0,0},
              textString="Prosumer2
SF3"),      Text(
              extent={{-252,102},{-172,68}},
              textColor={0,0,0},
              textString="Prosumer1
SF1"),      Text(
              extent={{170,-118},{206,-134}},
              textColor={238,46,47},
              textString="hot"),
            Text(
              extent={{162,-18},{206,-32}},
              textColor={28,108,200},
              textString="cold"),
            Text(
              extent={{364,-118},{400,-134}},
              textColor={238,46,47},
              textString="hot"),
            Text(
              extent={{356,-18},{400,-32}},
              textColor={28,108,200},
              textString="cold"),
            Text(
              extent={{678,-114},{714,-130}},
              textColor={238,46,47},
              textString="hot"),
            Text(
              extent={{674,-20},{718,-34}},
              textColor={28,108,200},
              textString="cold")}),
        experiment(
          StopTime=34200,
          Interval=10,
          __Dymola_Algorithm="Dassl"),
        __Dymola_Commands(file="Scripts/COSES_PLOT.mos" "COSES_PLOT", file=
              "Scripts/cosesplot.mos" "cosesplot",
          file="Scripts/cosesplot.mos" "cosesplot",
          file="Scripts/cosesplot.mos" "cosesplot",
          file="Scripts/coses_plot_tables.mos" "coses_plot_tables"));
    end Speer_IEWT2023;

    model A1a_Licklederer_crossover_noheat_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-58,46},{-34,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{136,48},{160,82}})));
      Prosumers.SF1 sF1_1
        annotation (Placement(transformation(extent={{-228,70},{-144,132}})));
      Prosumers.SF4 sF4_1
        annotation (Placement(transformation(extent={{-240,-68},{-156,-8}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl
        tESNetworkControl(deltaT=0)
        annotation (Placement(transformation(extent={{-126,122},{-106,142}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl
        tESNetworkControl1(deltaT=0)
        annotation (Placement(transformation(extent={{-138,-16},{-118,4}})));
      Prosumers.MF5 mF5_1
        annotation (Placement(transformation(extent={{232,58},{316,140}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl
        tESNetworkControl2(deltaT=0)
        annotation (Placement(transformation(extent={{328,124},{348,144}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,81}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{136,64},{122,64},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{160,64},{174,64},{174,8},{168.2,8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{
              154,97.5},{154,83}},        color={0,0,127}));
      connect(sF4_1.port_a1, B2.port_a1) annotation (Line(points={{-219.4,-7.9},
              {-219.4,16},{-72,16},{-72,25},{40.8,25}}, color={0,127,255}));
      connect(sF4_1.port_b1, B2.port_b1) annotation (Line(points={{-183.6,-0.9},
              {-183.6,18},{-184,18},{-184,36},{60,36},{60,30},{59,30},{59,25}},
                                                              color={0,127,255}));
      connect(B1.port_a1, sF1_1.port_a1) annotation (Line(points={{-57.2,25},{
              -57.2,28},{-138,28},{-138,150},{-205.3,150},{-205.3,134.3}},
            color={0,127,255}));
      connect(sF1_1.port_b1, B1.port_b1) annotation (Line(points={{-166.7,134},
              {-166.7,148},{-82,148},{-82,58},{-68,58},{-68,32},{-39,32},{-39,
              25}}, color={0,127,255}));
      connect(tESNetworkControl.Tstorage_top, sF1_1.TTop) annotation (Line(
            points={{-128.8,139.2},{-144,139.2},{-144,142.1},{-147.3,142.1}},
            color={0,0,127}));
      connect(tESNetworkControl.Tstorage_middle, sF1_1.TMiddle) annotation (
          Line(points={{-128.8,133.2},{-147.2,133.2},{-147.2,138.2}}, color={0,
              0,127}));
      connect(tESNetworkControl.Tstorage_bottom, sF1_1.TBottom) annotation (
          Line(points={{-128.8,127.2},{-140,127.2},{-140,135.1},{-147.3,135.1}},
            color={0,0,127}));
      connect(Ctrl1.Q_dot_set, tESNetworkControl.P) annotation (Line(points={{
              -52,80.8},{-52,88},{-98,88},{-98,132},{-107.4,132}}, color={0,0,
              127}));
      connect(tESNetworkControl1.Tstorage_bottom, sF4_1.TBottom) annotation (
          Line(points={{-140.8,-10.8},{-150,-10.8},{-150,-4.9},{-159.3,-4.9}},
            color={0,0,127}));
      connect(tESNetworkControl1.Tstorage_middle, sF4_1.TMiddle) annotation (
          Line(points={{-140.8,-4.8},{-148,-4.8},{-148,-1.8},{-159.2,-1.8}},
            color={0,0,127}));
      connect(tESNetworkControl1.Tstorage_top, sF4_1.TTop) annotation (Line(
            points={{-140.8,1.2},{-150.05,1.2},{-150.05,2.1},{-159.3,2.1}},
            color={0,0,127}));
      connect(Ctrl2.Q_dot_set, tESNetworkControl1.P) annotation (Line(points={{
              46,82.8},{46,90},{-22,90},{-22,32},{-76,32},{-76,-6},{-119.4,-6}},
            color={0,0,127}));
      connect(mF5_1.TBottom, tESNetworkControl2.Tstorage_bottom) annotation (
          Line(points={{312.7,123.1},{320,123.1},{320,129.2},{325.2,129.2}},
            color={0,0,127}));
      connect(tESNetworkControl2.Tstorage_middle, mF5_1.TMiddle) annotation (
          Line(points={{325.2,135.2},{325.2,136},{318,136},{318,126.2},{312.8,
              126.2}}, color={0,0,127}));
      connect(mF5_1.TTop, tESNetworkControl2.Tstorage_top) annotation (Line(
            points={{312.7,130.1},{312.7,136},{312,136},{312,142},{325.2,142},{
              325.2,141.2}},                                              color
            ={0,0,127}));
      connect(tESNetworkControl2.P, Ctrl3.Q_dot_set) annotation (Line(points={{
              346.6,134},{354,134},{354,158},{142,158},{142,82.8}}, color={0,0,
              127}));
      connect(B3.port_a1, mF5_1.port_a1) annotation (Line(points={{138.8,25},{
              138.8,28},{226,28},{226,146},{257.1,146},{257.1,132.8}}, color={0,
              127,255}));
      connect(B3.port_b1, mF5_1.port_b1) annotation (Line(points={{157,25},{157,
              28},{176,28},{176,104},{222,104},{222,148},{292.1,148},{292.1,
              131.9}}, color={0,127,255}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A1a_Licklederer_crossover_noheat_noweight;

    model A1a_Licklederer_crossover_noheat_noweight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-58,46},{-34,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{136,48},{160,82}})));
      Prosumers.SF1 sF1_1
        annotation (Placement(transformation(extent={{-228,70},{-144,132}})));
      Prosumers.SF4 sF4_1
        annotation (Placement(transformation(extent={{-240,-68},{-156,-8}})));
      Prosumers.MF5 mF5_1
        annotation (Placement(transformation(extent={{232,58},{316,140}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl2
        tESNetworkControl2_1(deltaT=0)
        annotation (Placement(transformation(extent={{-214,40},{-194,60}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl2
        tESNetworkControl2_2(deltaT=0)
        annotation (Placement(transformation(extent={{-122,116},{-102,136}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl2
        tESNetworkControl2_3(deltaT=0)
        annotation (Placement(transformation(extent={{334,96},{354,116}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,81}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{136,64},{122,64},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{160,64},{174,64},{174,8},{168.2,8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{
              154,97.5},{154,83}},        color={0,0,127}));
      connect(sF4_1.port_a1, B2.port_a1) annotation (Line(points={{-219.4,-7.9},
              {-219.4,16},{-72,16},{-72,25},{40.8,25}}, color={0,127,255}));
      connect(sF4_1.port_b1, B2.port_b1) annotation (Line(points={{-183.6,-0.9},
              {-183.6,32},{-66,32},{-66,34},{59,34},{59,25}}, color={0,127,255}));
      connect(B1.port_a1, sF1_1.port_a1) annotation (Line(points={{-57.2,25},{
              -57.2,28},{-138,28},{-138,150},{-205.3,150},{-205.3,134.3}},
            color={0,127,255}));
      connect(sF1_1.port_b1, B1.port_b1) annotation (Line(points={{-166.7,134},
              {-166.7,148},{-82,148},{-82,58},{-68,58},{-68,32},{-39,32},{-39,
              25}}, color={0,127,255}));
      connect(sF4_1.TTop, tESNetworkControl2_1.Tstorage_top) annotation (Line(
            points={{-159.3,2.1},{-159.3,34},{-224,34},{-224,57.2},{-216.8,57.2}},
            color={0,0,127}));
      connect(sF4_1.TBottom, tESNetworkControl2_1.Tstorage_bottom) annotation (
          Line(points={{-159.3,-4.9},{-164,-4.9},{-164,18},{-226,18},{-226,45.2},
              {-216.8,45.2}}, color={0,0,127}));
      connect(sF4_1.TMiddle, tESNetworkControl2_1.Tstorage_middle) annotation (
          Line(points={{-159.2,-1.8},{-174,-1.8},{-174,10},{-230,10},{-230,51.2},
              {-216.8,51.2}}, color={0,0,127}));
      connect(Ctrl2.Q_dot_set, tESNetworkControl2_1.P) annotation (Line(points=
              {{46,82.8},{46,90},{-34,90},{-34,92},{-140,92},{-140,50},{-195.4,
              50}}, color={0,0,127}));
      connect(tESNetworkControl2_2.Tstorage_top, sF1_1.TTop) annotation (Line(
            points={{-124.8,133.2},{-140,133.2},{-140,142.1},{-147.3,142.1}},
            color={0,0,127}));
      connect(tESNetworkControl2_2.Tstorage_middle, sF1_1.TMiddle) annotation (
          Line(points={{-124.8,127.2},{-140,127.2},{-140,138.2},{-147.2,138.2}},
            color={0,0,127}));
      connect(tESNetworkControl2_2.Tstorage_bottom, sF1_1.TBottom) annotation (
          Line(points={{-124.8,121.2},{-140,121.2},{-140,144},{-144,144},{-144,
              146},{-147.3,146},{-147.3,135.1}}, color={0,0,127}));
      connect(tESNetworkControl2_2.P, Ctrl1.Q_dot_set) annotation (Line(points=
              {{-103.4,126},{-80,126},{-80,90},{-52,90},{-52,80.8}}, color={0,0,
              127}));
      connect(mF5_1.TTop, tESNetworkControl2_3.Tstorage_top) annotation (Line(
            points={{312.7,130.1},{312.7,142},{320,142},{320,126},{322,126},{
              322,113.2},{331.2,113.2}}, color={0,0,127}));
      connect(tESNetworkControl2_3.Tstorage_middle, mF5_1.TMiddle) annotation (
          Line(points={{331.2,107.2},{318,107.2},{318,146},{312.8,146},{312.8,
              126.2}}, color={0,0,127}));
      connect(tESNetworkControl2_3.Tstorage_bottom, mF5_1.TBottom) annotation (
          Line(points={{331.2,101.2},{318,101.2},{318,148},{312.7,148},{312.7,
              123.1}}, color={0,0,127}));
      connect(tESNetworkControl2_3.P, Ctrl3.Q_dot_set) annotation (Line(points=
              {{352.6,106},{360,106},{360,154},{142,154},{142,82.8}}, color={0,
              0,127}));
      connect(B3.port_a1, mF5_1.port_a1) annotation (Line(points={{138.8,25},{
              257.1,25},{257.1,132.8}}, color={0,127,255}));
      connect(B3.port_b1, mF5_1.port_b1) annotation (Line(points={{157,25},{157,
              28},{224,28},{224,146},{292.1,146},{292.1,131.9}}, color={0,127,
              255}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A1a_Licklederer_crossover_noheat_noweight2;

    model A1a_Licklederer_crossover_noheat_noweight3
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{-58,46},{-34,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{42,34},{66,68}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{136,48},{160,82}})));
      Prosumers.SF1 sF1_1
        annotation (Placement(transformation(extent={{-70,136},{-48,150}})));
      Prosumers.SF4 sF4_1
        annotation (Placement(transformation(extent={{24,128},{52,144}})));
      Prosumers.MF5 mF5_1
        annotation (Placement(transformation(extent={{126,122},{148,144}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
        tESNetworkControl3_1(deltaT=0) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={-44,114})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
        tESNetworkControl3_2(deltaT=0) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={52,98})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
        tESNetworkControl3_3(deltaT=0) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=270,
            origin={150,100})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{66,50},{76,50},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{42,50},{24,50},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{136,64},{122,64},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{160,64},{174,64},{174,8},{168.2,8}}, color={0,0,127}));
      connect(sF4_1.port_a1, B2.port_a1) annotation (Line(points={{30.8667,
              144.027},{30.8667,152},{18,152},{18,24},{20,24},{20,25},{40.8,25}},
                                                        color={0,127,255}));
      connect(sF4_1.port_b1, B2.port_b1) annotation (Line(points={{42.8,145.893},
              {42.8,154},{80,154},{80,44},{74,44},{74,25},{59,25}},
                                                              color={0,127,255}));
      connect(B1.port_a1, sF1_1.port_a1) annotation (Line(points={{-57.2,25},{
              -57.2,36},{-76,36},{-76,150.519},{-64.0548,150.519}},
            color={0,127,255}));
      connect(sF1_1.port_b1, B1.port_b1) annotation (Line(points={{-53.9452,
              150.452},{-53.9452,154},{-24,154},{-24,30},{-39,30},{-39,25}},
                    color={0,127,255}));
      connect(B3.port_a1, mF5_1.port_a1) annotation (Line(points={{138.8,25},{
              138.8,44},{124,44},{124,144},{132.574,144},{132.574,142.068}},
            color={0,127,255}));
      connect(B3.port_b1, mF5_1.port_b1) annotation (Line(points={{157,25},{157,
              44},{168,44},{168,144},{141.74,144},{141.74,141.827}}, color={0,
              127,255}));
      connect(tESNetworkControl3_1.Tout, Ctrl1.T_sec_in_is) annotation (Line(
            points={{-48,105.4},{-26,105.4},{-26,92},{-40,92},{-40,81}}, color=
              {0,0,127}));
      connect(tESNetworkControl3_1.P, Ctrl1.Q_dot_set) annotation (Line(points=
              {{-44,105.4},{-30,105.4},{-30,94},{-52,94},{-52,80.8}}, color={0,
              0,127}));
      connect(tESNetworkControl3_1.Tstorage_top, sF1_1.TTop) annotation (Line(
            points={{-36.8,126.8},{-36.8,140},{-36,140},{-36,152},{-48.8643,152},
              {-48.8643,152.281}}, color={0,0,127}));
      connect(tESNetworkControl3_1.Tstorage_middle, sF1_1.TMiddle) annotation (
          Line(points={{-42.8,126.8},{-42.8,151.4},{-48.8381,151.4}}, color={0,
              0,127}));
      connect(sF1_1.TBottom, tESNetworkControl3_1.Tstorage_bottom) annotation (
          Line(points={{-48.8643,150.7},{-46,150.7},{-46,132},{-56,132},{-56,
              126.8},{-48.8,126.8}}, color={0,0,127}));
      connect(sF4_1.TTop, tESNetworkControl3_2.Tstorage_top) annotation (Line(
            points={{50.9,146.693},{50.9,148},{72,148},{72,110.8},{59.2,110.8}},
            color={0,0,127}));
      connect(sF4_1.TMiddle, tESNetworkControl3_2.Tstorage_middle) annotation (
          Line(points={{50.9333,145.653},{50.9333,148},{54,148},{54,142},{56,
              142},{56,118},{53.2,118},{53.2,110.8}}, color={0,0,127}));
      connect(tESNetworkControl3_2.Tstorage_bottom, sF4_1.TBottom) annotation (
          Line(points={{47.2,110.8},{47.2,118},{58,118},{58,144.827},{50.9,
              144.827}}, color={0,0,127}));
      connect(tESNetworkControl3_2.P, Ctrl2.Q_dot_set) annotation (Line(points=
              {{52,89.4},{52,76},{48,76},{48,68.8}}, color={0,0,127}));
      connect(tESNetworkControl3_2.Tout, Ctrl2.T_sec_in_is) annotation (Line(
            points={{48,89.4},{48,82},{60,82},{60,69}}, color={0,0,127}));
      connect(mF5_1.TTop, tESNetworkControl3_3.Tstorage_top) annotation (Line(
            points={{147.136,141.344},{152,141.344},{152,136},{158,136},{158,
              112.8},{157.2,112.8}}, color={0,0,127}));
      connect(tESNetworkControl3_3.Tstorage_middle, mF5_1.TMiddle) annotation (
          Line(points={{151.2,112.8},{151.2,140.298},{147.162,140.298}}, color=
              {0,0,127}));
      connect(mF5_1.TBottom, tESNetworkControl3_3.Tstorage_bottom) annotation (
          Line(points={{147.136,139.466},{150,139.466},{150,120},{145.2,120},{
              145.2,112.8}}, color={0,0,127}));
      connect(tESNetworkControl3_3.P, Ctrl3.Q_dot_set) annotation (Line(points=
              {{150,91.4},{146,91.4},{146,82.8},{142,82.8}}, color={0,0,127}));
      connect(tESNetworkControl3_3.Tout, Ctrl3.T_sec_in_is) annotation (Line(
            points={{146,91.4},{146,83},{154,83}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A1a_Licklederer_crossover_noheat_noweight3;

    model A1b_Licklederer_crossover_noheat_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1
        annotation (Placement(transformation(extent={{-58,48},{-34,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
              {-52,90},{-52,82.8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,64},{-18,64},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,83}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,82.8},{46,82.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A1b_Licklederer_crossover_noheat_defweight;

    model A1c_Licklederer_crossover_noheat_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{-58,48},{-34,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
              {-52,90},{-52,82.8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,64},{-18,64},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,83}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,82.8},{46,82.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A1c_Licklederer_crossover_noheat_weight2;

    model A2a_Licklederer_crossover_heat_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-58,48},{-34,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
              {-52,90},{-52,82.8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,64},{-18,64},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,83}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,82.8},{46,82.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A2a_Licklederer_crossover_heat_noweight;

    model A2b_Licklederer_crossover_heat_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1
        annotation (Placement(transformation(extent={{-58,48},{-34,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
              {-52,90},{-52,82.8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,64},{-18,64},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,83}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,82.8},{46,82.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A2b_Licklederer_crossover_heat_defweight;

    model A2c_Licklederer_crossover_heat_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{-58,48},{-34,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
              {-52,90},{-52,82.8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,64},{-18,64},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,83}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,82.8},{46,82.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A2c_Licklederer_crossover_heat_weight2;

    model A3a_Licklederer_crossover_smallpump_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-58,46},{-34,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
              {-52,90},{-52,80.8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,81}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,82.8},{46,82.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A3a_Licklederer_crossover_smallpump_noweight;

    model A3b_Licklederer_crossover_smallpump_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-50,10})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1
        annotation (Placement(transformation(extent={{-58,48},{-34,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-36,-8.2},{-36,-45},{-8,-45}},  color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-64,-8},{-64,-90},{-8,-90}},  color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
              {-52,90},{-52,82.8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,64},{-74,64},{-74,10},{-70,10}},
                                                                     color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,64},{-18,64},{-18,10},{-29.8,10}},
                                                                       color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,83}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,82.8},{46,82.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A3b_Licklederer_crossover_smallpump_defweight;

    model A3c_Licklederer_crossover_smallpump_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-50,10})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{-58,48},{-34,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-36,-8.2},{-36,-45},{-8,-45}},  color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-64,-8},{-64,-90},{-8,-90}},  color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
              {-52,90},{-52,82.8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,64},{-74,64},{-74,10},{-70,10}},
                                                                     color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,64},{-18,64},{-18,10},{-29.8,10}},
                                                                       color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,83}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,82.8},{46,82.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end A3c_Licklederer_crossover_smallpump_weight2;

    model B1a_Licklederer_sameside_noheat_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-44,75})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,74},{-32,74}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-56,74},{-74,74},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,93},{-38,93}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,98},
              {-50,98},{-50,92.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B1a_Licklederer_sameside_noheat_noweight;

    model B1b_Licklederer_sameside_noheat_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-42,75})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,140})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,74},{-30,74}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,74},{-74,74},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,93},{-36,93}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,129},{-66,98},
              {-48,98},{-48,92.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B1b_Licklederer_sameside_noheat_defweight;

    model B1c_Licklederer_sameside_noheat_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-42,75})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,74},{-30,74}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,74},{-74,74},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,93},{-36,93}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,98},
              {-48,98},{-48,92.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B1c_Licklederer_sameside_noheat_weight2;

    model B2a_Licklederer_sameside_heat_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-44,75})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,74},{-32,74}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-56,74},{-74,74},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,93},{-38,93}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,98},
              {-50,98},{-50,92.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B2a_Licklederer_sameside_heat_noweight;

    model B2b_Licklederer_sameside_heat_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-44,77})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,76},{-32,76}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-56,76},{-74,76},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,95},{-38,95}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,98},
              {-50,98},{-50,94.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B2b_Licklederer_sameside_heat_defweight;

    model B2c_Licklederer_sameside_heat_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-44,77})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,76},{-32,76}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-56,76},{-74,76},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,95},{-38,95}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,98},
              {-50,98},{-50,94.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B2c_Licklederer_sameside_heat_weight2;

    model B3a_Licklederer_sameside_smallpump_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-44,75})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=1,
        alpha_sec_cons=0) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,74},{-32,74}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-56,74},{-74,74},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,93},{-38,93}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,98},
              {-50,98},{-50,92.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B3a_Licklederer_sameside_smallpump_noweight;

    model B3b_Licklederer_sameside_smallpump_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-42,75})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3
        annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,74},{-30,74}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,74},{-74,74},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,93},{-36,93}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,98},
              {-48,98},{-48,92.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B3b_Licklederer_sameside_smallpump_defweight;

    model B3c_Licklederer_sameside_smallpump_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={-42,75})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={52,73})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_sameside Ctrl3(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25) annotation (Placement(transformation(
            extent={{-12,-17},{12,17}},
            rotation=0,
            origin={148,71})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
    equation
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,74},{-30,74}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,74},{-74,74},{-74,8},{-68,8}}, color={0,0,127}));
      connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
        annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
      connect(Ctrl2.states,B2. states)
        annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
      connect(B3.contr_vars_real,Ctrl3. contr_vars_real)
        annotation (Line(points={{168.2,8},{176,8},{176,70},{160,70}}, color={0,0,127}));
      connect(Ctrl3.states,B3. states)
        annotation (Line(points={{136,70},{122,70},{122,8},{128,8}}, color={0,0,127}));
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-31,93},{-36,93}}, color={0,0,127}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{155,94},{
              166,94},{166,89},{154,89}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,98},
              {-48,98},{-48,92.8}}, color={0,0,127}));
      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set)
        annotation (Line(points={{32,127},{32,90.8},{46,90.8}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,96},
              {142,96},{142,88.8}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B3c_Licklederer_sameside_smallpump_weight2;

    model C1a_Licklederer_mix1_noheat_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-58,50},{-34,84}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{34,42},{58,76}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{132,50},{156,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,92},
              {-52,92},{-52,84.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,92},{-40,
              92},{-40,85}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,66},{-18,66},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,66},{-82,66},{-82,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{34,58},{24,58},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{58,58},{76,58},{76,8},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              82},{52,82},{52,77}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{32,100.5},
              {40,100.5},{40,76.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,90},
              {138,90},{138,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{150,90},{150,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C1a_Licklederer_mix1_noheat_noweight;

    model C1b_Licklederer_mix1_noheat_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1
        annotation (Placement(transformation(extent={{-58,50},{-34,84}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2
        annotation (Placement(transformation(extent={{34,42},{58,76}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3
        annotation (Placement(transformation(extent={{132,50},{156,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,92},
              {-52,92},{-52,84.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,92},{-40,
              92},{-40,85}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,66},{-18,66},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,66},{-82,66},{-82,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{34,58},{24,58},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{58,58},{76,58},{76,8},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              82},{52,82},{52,77}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{32,100.5},
              {40,100.5},{40,76.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,90},
              {138,90},{138,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{150,90},{150,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C1b_Licklederer_mix1_noheat_defweight;

    model C1c_Licklederer_mix1_noheat_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{-58,50},{-34,84}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{34,42},{58,76}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{132,50},{156,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,92},
              {-52,92},{-52,84.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,92},{-40,
              92},{-40,85}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,66},{-18,66},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,66},{-82,66},{-82,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{34,58},{24,58},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{58,58},{76,58},{76,8},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              82},{52,82},{52,77}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{32,100.5},
              {40,100.5},{40,76.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,90},
              {138,90},{138,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{150,90},{150,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C1c_Licklederer_mix1_noheat_weight2;

    model C2a_Licklederer_mix1_heat_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-58,50},{-34,84}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{34,42},{58,76}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{132,50},{156,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,92},
              {-52,92},{-52,84.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,92},{-40,
              92},{-40,85}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,66},{-18,66},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,66},{-82,66},{-82,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{34,58},{24,58},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{58,58},{76,58},{76,8},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              82},{52,82},{52,77}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{32,100.5},
              {40,100.5},{40,76.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,90},
              {138,90},{138,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{150,90},{150,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C2a_Licklederer_mix1_heat_noweight;

    model C2b_Licklederer_mix1_heat_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1
        annotation (Placement(transformation(extent={{-58,50},{-34,84}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2
        annotation (Placement(transformation(extent={{34,42},{58,76}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3
        annotation (Placement(transformation(extent={{132,50},{156,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,92},
              {-52,92},{-52,84.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,92},{-40,
              92},{-40,85}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,66},{-18,66},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,66},{-82,66},{-82,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{34,58},{24,58},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{58,58},{76,58},{76,8},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              82},{52,82},{52,77}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{32,100.5},
              {40,100.5},{40,76.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,90},
              {138,90},{138,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{150,90},{150,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C2b_Licklederer_mix1_heat_defweight;

    model C2c_Licklederer_mix1_heat_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{-58,50},{-34,84}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{34,42},{58,76}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{132,50},{156,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,92},
              {-52,92},{-52,84.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,92},{-40,
              92},{-40,85}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,66},{-18,66},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,66},{-82,66},{-82,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{34,58},{24,58},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{58,58},{76,58},{76,8},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              82},{52,82},{52,77}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{32,100.5},
              {40,100.5},{40,76.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,90},
              {138,90},{138,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{150,90},{150,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C2c_Licklederer_mix1_heat_weight2;

    model C3a_Licklederer_mix1_smallpump_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-54,48},{-30,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{38,44},{62,78}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3(
        alpha_prim_prod=0,
        alpha_sec_prod=1,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{136,44},{160,78}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-60,127},
              {-60,82.8},{-48,82.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-36,97.5},{-36,83}}, color={0,0,127}));
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,64},{-30,64}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{38,60},{24,60},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{62,60},{76,60},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{160,60},{174,60},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{136,60},{122,60},{122,8},{128,8}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,78.8},{44,78.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              84},{56,84},{56,79}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,86},
              {142,86},{142,78.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is)
        annotation (Line(points={{155,97.5},{154,97.5},{154,79}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C3a_Licklederer_mix1_smallpump_noweight;

    model C3b_Licklederer_mix1_smallpump_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1
        annotation (Placement(transformation(extent={{-54,48},{-30,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2
        annotation (Placement(transformation(extent={{38,44},{62,78}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3
        annotation (Placement(transformation(extent={{136,44},{160,78}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-60,127},
              {-60,82.8},{-48,82.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-36,97.5},{-36,83}}, color={0,0,127}));
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,64},{-30,64}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{38,60},{24,60},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{62,60},{76,60},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{160,60},{174,60},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{136,60},{122,60},{122,8},{128,8}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,78.8},{44,78.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              84},{56,84},{56,79}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,86},
              {142,86},{142,78.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is)
        annotation (Line(points={{155,97.5},{154,97.5},{154,79}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C3b_Licklederer_mix1_smallpump_defweight;

    model C3c_Licklederer_mix1_smallpump_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl1(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{-54,48},{-30,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl2(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{38,44},{62,78}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix1 Ctrl3(
        alpha_prim_prod=0.25,
        alpha_sec_prod=0.75,
        alpha_prim_cons=0.25,
        alpha_sec_cons=0.75)
        annotation (Placement(transformation(extent={{136,44},{160,78}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-60,127},
              {-60,82.8},{-48,82.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is)
        annotation (Line(points={{-31,97.5},{-36,97.5},{-36,83}}, color={0,0,127}));
      connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
        annotation (Line(points={{-27.8,8},{-20,8},{-20,64},{-30,64}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{38,60},{24,60},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{62,60},{76,60},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{160,60},{174,60},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{136,60},{122,60},{122,8},{128,8}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,78.8},{44,78.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              84},{56,84},{56,79}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,86},
              {142,86},{142,78.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is)
        annotation (Line(points={{155,97.5},{154,97.5},{154,79}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end C3c_Licklederer_mix1_smallpump_weight2;

    model D1a_Licklederer_mix2_noheat_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-29,101})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,140})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{-60,44},{-36,78}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{50,44},{74,78}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{138,44},{162,78}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-26,107},{-12,107},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-32,
              114},{-32,107}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,129},{-66,84},
              {-54,84},{-54,78.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-29,95.5},{-29,84},{-42,
              84},{-42,79}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-36,60},{-18,60},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-60,60},{-74,60},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{74,60},{80,60},{80,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{50,60},{24,60},{24,8},{30,8}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{44,127},{
              44,78.8},{56,78.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              84},{68,84},{68,79}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,86},
              {144,86},{144,78.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,84},{156,84},{156,79}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{162,60},{174,60},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states) annotation (Line(points={{138,60},{112,60},{112,6},
              {128,6},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D1a_Licklederer_mix2_noheat_noweight;

    model D1b_Licklederer_mix2_noheat_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-29,101})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,140})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1
        annotation (Placement(transformation(extent={{-60,44},{-36,78}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2
        annotation (Placement(transformation(extent={{50,44},{74,78}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3
        annotation (Placement(transformation(extent={{138,44},{162,78}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-26,107},{-12,107},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-32,
              114},{-32,107}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,129},{-66,84},
              {-54,84},{-54,78.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-29,95.5},{-29,84},{-42,
              84},{-42,79}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-36,60},{-18,60},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-60,60},{-74,60},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{74,60},{80,60},{80,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{50,60},{24,60},{24,8},{30,8}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{44,127},{
              44,78.8},{56,78.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              84},{68,84},{68,79}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,86},
              {144,86},{144,78.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,84},{156,84},{156,79}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{162,60},{174,60},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states) annotation (Line(points={{138,60},{112,60},{112,6},
              {128,6},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D1b_Licklederer_mix2_noheat_defweight;

    model D1c_Licklederer_mix2_noheat_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{-58,44},{-34,78}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{40,42},{64,76}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{134,44},{158,78}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,86},
              {-52,86},{-52,78.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,86},{-40,
              86},{-40,79}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,60},{-18,60},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,60},{-74,60},{-74,8},{-68,8}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{32,102.5},
              {46,102.5},{46,76.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,77}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,58},{76,58},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,58},{24,58},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,60},{122,60},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,60},{174,60},{174,8},{168.2,8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,86},
              {140,86},{140,78.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,84},{152,84},{152,79}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D1c_Licklederer_mix2_noheat_weight2;

    model D2a_Licklederer_mix2_heat_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{-68,46},{-44,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{42,46},{66,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{132,48},{156,82}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,86},
              {-62,86},{-62,80.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,86},{-50,
              86},{-50,81}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{42,127},{
              42,80.8},{48,80.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              86},{60,86},{60,81}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,88},
              {138,88},{138,82.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,88},{150,88},{150,83}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,64},{122,64},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,64},{174,64},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{66,62},{76,62},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{42,62},{24,62},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-44,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-68,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D2a_Licklederer_mix2_heat_noweight;

    model D2b_Licklederer_mix2_heat_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1
        annotation (Placement(transformation(extent={{-68,46},{-44,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2
        annotation (Placement(transformation(extent={{42,46},{66,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3
        annotation (Placement(transformation(extent={{132,48},{156,82}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,86},
              {-62,86},{-62,80.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,86},{-50,
              86},{-50,81}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{42,127},{
              42,80.8},{48,80.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              86},{60,86},{60,81}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,88},
              {138,88},{138,82.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,88},{150,88},{150,83}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,64},{122,64},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,64},{174,64},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{66,62},{76,62},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{42,62},{24,62},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-44,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-68,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D2b_Licklederer_mix2_heat_defweight;

    model D2c_Licklederer_mix2_heat_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=5) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=5,       length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{-68,46},{-44,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{42,46},{66,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{132,48},{156,82}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,86},
              {-62,86},{-62,80.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,86},{-50,
              86},{-50,81}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{42,127},{
              42,80.8},{48,80.8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              86},{60,86},{60,81}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,88},
              {138,88},{138,82.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,88},{150,88},{150,83}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{132,64},{122,64},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{156,64},{174,64},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{66,62},{76,62},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{42,62},{24,62},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-44,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-68,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D2c_Licklederer_mix2_heat_weight2;

    model D3a_Licklederer_mix2_smallpump_noweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{-54,48},{-30,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{38,46},{62,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=1,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,88},
              {-48,88},{-48,82.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,88},{-36,
              88},{-36,83}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-30,64},{-20,64},{-20,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{38,62},{24,62},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real) annotation (Line(points={{62,62},
              {80,62},{80,2},{70.2,2},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              86},{56,86},{56,81}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,80.8},{44,80.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D3a_Licklederer_mix2_smallpump_noweight;

    model D3b_Licklederer_mix2_smallpump_defweight
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1
        annotation (Placement(transformation(extent={{-54,48},{-30,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2
        annotation (Placement(transformation(extent={{38,46},{62,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,88},
              {-48,88},{-48,82.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,88},{-36,
              88},{-36,83}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-30,64},{-20,64},{-20,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{38,62},{24,62},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real) annotation (Line(points={{62,62},
              {80,62},{80,2},{70.2,2},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              86},{56,86},{56,81}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,80.8},{44,80.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D3b_Licklederer_mix2_smallpump_defweight;

    model D3c_Licklederer_mix2_smallpump_weight2
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
            21600,10; 25200,10]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-66,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
            21600,-4; 25200,-4]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={32,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
            21600,-6; 25200,-6]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={130,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl1(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{-54,48},{-30,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl2(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{38,46},{62,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_mix2 Ctrl3(
        alpha_prim_prod=0.75,
        alpha_sec_prod=0.25,
        alpha_prim_cons=0.75,
        alpha_sec_cons=0.25)
        annotation (Placement(transformation(extent={{134,50},{158,84}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,88},
              {-48,88},{-48,82.8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,88},{-36,
              88},{-36,83}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-54,64},{-74,64},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-30,64},{-20,64},{-20,8},{-27.8,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{38,62},{24,62},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real) annotation (Line(points={{62,62},
              {80,62},{80,2},{70.2,2},{70.2,8}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is) annotation (Line(points={{59,95.5},{58,95.5},{58,
              86},{56,86},{56,81}}, color={0,0,127}));
      connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
              40,80.8},{44,80.8}}, color={0,0,127}));
      connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
              {140,92},{140,84.8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
              154,90},{152,90},{152,85}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end D3c_Licklederer_mix2_smallpump_weight2;

  end Simulations_SF1;

  package Scenarios
    model B1a_Afshoun_crossover_noheat_noweight_alpha0
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-58,46},{-34,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{136,48},{160,82}})));
      Prosumers.SF1 sF1_1
        annotation (Placement(transformation(extent={{-228,70},{-144,132}})));
      Prosumers.SF4 sF4_1
        annotation (Placement(transformation(extent={{-240,-68},{-156,-8}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl
        tESNetworkControl(deltaT=0)
        annotation (Placement(transformation(extent={{-126,122},{-106,142}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl
        tESNetworkControl1(deltaT=0)
        annotation (Placement(transformation(extent={{-138,-16},{-118,4}})));
      Prosumers.MF5 mF5_1
        annotation (Placement(transformation(extent={{232,58},{316,140}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl
        tESNetworkControl2(deltaT=0)
        annotation (Placement(transformation(extent={{328,124},{348,144}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,81}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{136,64},{122,64},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{160,64},{174,64},{174,8},{168.2,8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{
              154,97.5},{154,83}},        color={0,0,127}));
      connect(sF4_1.port_a1, B2.port_a1) annotation (Line(points={{-219.4,-7.9},
              {-219.4,16},{-72,16},{-72,25},{40.8,25}}, color={0,127,255}));
      connect(sF4_1.port_b1, B2.port_b1) annotation (Line(points={{-183.6,-0.9},
              {-183.6,18},{-184,18},{-184,36},{60,36},{60,30},{59,30},{59,25}},
                                                              color={0,127,255}));
      connect(B1.port_a1, sF1_1.port_a1) annotation (Line(points={{-57.2,25},{
              -57.2,28},{-138,28},{-138,150},{-205.3,150},{-205.3,134.3}},
            color={0,127,255}));
      connect(sF1_1.port_b1, B1.port_b1) annotation (Line(points={{-166.7,134},
              {-166.7,148},{-82,148},{-82,58},{-68,58},{-68,32},{-39,32},{-39,
              25}}, color={0,127,255}));
      connect(tESNetworkControl.Tstorage_top, sF1_1.TTop) annotation (Line(
            points={{-128.8,139.2},{-144,139.2},{-144,142.1},{-147.3,142.1}},
            color={0,0,127}));
      connect(tESNetworkControl.Tstorage_middle, sF1_1.TMiddle) annotation (
          Line(points={{-128.8,133.2},{-147.2,133.2},{-147.2,138.2}}, color={0,
              0,127}));
      connect(tESNetworkControl.Tstorage_bottom, sF1_1.TBottom) annotation (
          Line(points={{-128.8,127.2},{-140,127.2},{-140,135.1},{-147.3,135.1}},
            color={0,0,127}));
      connect(Ctrl1.Q_dot_set, tESNetworkControl.P) annotation (Line(points={{
              -52,80.8},{-52,88},{-98,88},{-98,132},{-107.4,132}}, color={0,0,
              127}));
      connect(tESNetworkControl1.Tstorage_bottom, sF4_1.TBottom) annotation (
          Line(points={{-140.8,-10.8},{-150,-10.8},{-150,-4.9},{-159.3,-4.9}},
            color={0,0,127}));
      connect(tESNetworkControl1.Tstorage_middle, sF4_1.TMiddle) annotation (
          Line(points={{-140.8,-4.8},{-148,-4.8},{-148,-1.8},{-159.2,-1.8}},
            color={0,0,127}));
      connect(tESNetworkControl1.Tstorage_top, sF4_1.TTop) annotation (Line(
            points={{-140.8,1.2},{-150.05,1.2},{-150.05,2.1},{-159.3,2.1}},
            color={0,0,127}));
      connect(Ctrl2.Q_dot_set, tESNetworkControl1.P) annotation (Line(points={{
              46,82.8},{46,90},{-22,90},{-22,32},{-76,32},{-76,-6},{-119.4,-6}},
            color={0,0,127}));
      connect(mF5_1.TBottom, tESNetworkControl2.Tstorage_bottom) annotation (
          Line(points={{312.7,125.859},{320,125.859},{320,129.2},{325.2,129.2}},
            color={0,0,127}));
      connect(tESNetworkControl2.Tstorage_middle, mF5_1.TMiddle) annotation (
          Line(points={{325.2,135.2},{325.2,136},{318,136},{318,128.453},{312.8,
              128.453}},
                       color={0,0,127}));
      connect(mF5_1.TTop, tESNetworkControl2.Tstorage_top) annotation (Line(
            points={{312.7,131.716},{312.7,136},{312,136},{312,142},{325.2,142},
              {325.2,141.2}},                                             color
            ={0,0,127}));
      connect(tESNetworkControl2.P, Ctrl3.Q_dot_set) annotation (Line(points={{
              346.6,134},{354,134},{354,158},{142,158},{142,82.8}}, color={0,0,
              127}));
      connect(B3.port_a1, mF5_1.port_a1) annotation (Line(points={{138.8,25},{
              138.8,28},{226,28},{226,146},{257.1,146},{257.1,133.976}},
                                                                       color={0,
              127,255}));
      connect(B3.port_b1, mF5_1.port_b1) annotation (Line(points={{157,25},{157,
              28},{176,28},{176,104},{222,104},{222,148},{292.1,148},{292.1,
              133.222}},
                       color={0,127,255}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B1a_Afshoun_crossover_noheat_noweight_alpha0;

    model B1b_afshoun_crossover_noheat_noweight_alpha0
      BidirectionalSubstation.New_Substation.HTS B1(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={-48,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
      BidirectionalSubstation.New_Substation.HTS B2(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={50,8})));
      BidirectionalSubstation.New_Substation.HTS B3(
        n=0.5,
        redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
        R_ins_transferpipe=100000) annotation (Placement(transformation(
            extent={{20,-18},{-20,18}},
            rotation=0,
            origin={148,8})));
      Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
      Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
        annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
      Modelica.Fluid.Sources.Boundary_pT boundary(
        redeclare package Medium = Media.Water,
        use_p_in=false,
        T=325.4,
        nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
      inner Modelica.Fluid.System system(T_ambient=285.15)
        annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
      Modelica.Blocks.Math.Add add annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={-31,103})));
      Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={-8,117})));
      Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={82,115})));
      Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={59,101})));
      Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
          Placement(transformation(
            extent={{-5,-6},{5,6}},
            rotation=270,
            origin={178,117})));
      Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
            extent={{-5,-5},{5,5}},
            rotation=-90,
            origin={155,103})));

      Real Losses;

      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
            55; 21600,55; 25200,55]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={-24,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
            30; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={74,138})));
      BidirectionalSubstation.Controller_PID_based.auxiliary.TimeTable_noInterp
        temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
            55; 21600,30; 25200,30]) annotation (Placement(transformation(
            extent={{-10,-10},{10,10}},
            rotation=-90,
            origin={172,138})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=1)
        annotation (Placement(transformation(extent={{-58,46},{-34,80}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
        alpha_prim_prod=0,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{40,48},{64,82}})));
      BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
        alpha_prim_prod=1,
        alpha_sec_prod=0,
        alpha_prim_cons=0,
        alpha_sec_cons=0)
        annotation (Placement(transformation(extent={{136,48},{160,82}})));
      Prosumers.SF1 sF1_1
        annotation (Placement(transformation(extent={{-228,70},{-144,132}})));
      Prosumers.SF4 sF4_1
        annotation (Placement(transformation(extent={{-240,-68},{-156,-8}})));
      Prosumers.MF5 mF5_1
        annotation (Placement(transformation(extent={{232,58},{316,140}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl2
        tESNetworkControl2_1(deltaT=0)
        annotation (Placement(transformation(extent={{-214,40},{-194,60}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl2
        tESNetworkControl2_2(deltaT=0)
        annotation (Placement(transformation(extent={{-122,116},{-102,136}})));
      Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl2
        tESNetworkControl2_3(deltaT=0)
        annotation (Placement(transformation(extent={{334,96},{354,116}})));
    equation
      connect(B1.hot_prim, pipe_hot12.port_a)
        annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
      connect(pipe_hot12.port_b, B2.hot_prim)
        annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_a, B2.hot_prim)
        annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
      connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
              {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
      connect(B1.cold_prim, pipe_cold12.port_b)
        annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
      connect(pipe_cold12.port_a, B2.cold_prim)
        annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
      connect(B2.cold_prim, pipe_cold23.port_b)
        annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
      connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
              -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
      connect(pipe_hot12.port_a, boundary.ports[1])
        annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
      connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
              106},{-8,106},{-8,111.5}}, color={0,0,127}));
      connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
              68,104},{68,107},{62,107}}, color={0,0,127}));
      connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
              {164,106},{164,109},{158,109}}, color={0,0,127}));
          Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

      connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
              114},{-34,109}}, color={0,0,127}));
      connect(temp_sec_in2.y, add1.u2)
        annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
      connect(temp_sec_in3.y, add2.u2)
        annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
      connect(Ctrl1.states, B1.states)
        annotation (Line(points={{-58,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
      connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
        annotation (Line(points={{-34,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
      connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
              90},{-40,81}}, color={0,0,127}));
      connect(add1.y, Ctrl2.T_sec_in_is)
        annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
      connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
        annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
      connect(Ctrl2.states, B2.states)
        annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
      connect(Ctrl3.states, B3.states)
        annotation (Line(points={{136,64},{122,64},{122,8},{128,8}}, color={0,0,127}));
      connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
        annotation (Line(points={{160,64},{174,64},{174,8},{168.2,8}}, color={0,0,127}));
      connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{
              154,97.5},{154,83}},        color={0,0,127}));
      connect(sF4_1.port_a1, B2.port_a1) annotation (Line(points={{-219.4,-7.9},
              {-219.4,16},{-72,16},{-72,25},{40.8,25}}, color={0,127,255}));
      connect(sF4_1.port_b1, B2.port_b1) annotation (Line(points={{-183.6,-0.9},
              {-183.6,32},{-66,32},{-66,34},{59,34},{59,25}}, color={0,127,255}));
      connect(B1.port_a1, sF1_1.port_a1) annotation (Line(points={{-57.2,25},{
              -57.2,28},{-138,28},{-138,150},{-205.3,150},{-205.3,134.3}},
            color={0,127,255}));
      connect(sF1_1.port_b1, B1.port_b1) annotation (Line(points={{-166.7,134},
              {-166.7,148},{-82,148},{-82,58},{-68,58},{-68,32},{-39,32},{-39,
              25}}, color={0,127,255}));
      connect(sF4_1.TTop, tESNetworkControl2_1.Tstorage_top) annotation (Line(
            points={{-159.3,2.1},{-159.3,34},{-224,34},{-224,57.2},{-216.8,57.2}},
            color={0,0,127}));
      connect(sF4_1.TBottom, tESNetworkControl2_1.Tstorage_bottom) annotation (
          Line(points={{-159.3,-4.9},{-164,-4.9},{-164,18},{-226,18},{-226,45.2},
              {-216.8,45.2}}, color={0,0,127}));
      connect(sF4_1.TMiddle, tESNetworkControl2_1.Tstorage_middle) annotation (
          Line(points={{-159.2,-1.8},{-174,-1.8},{-174,10},{-230,10},{-230,51.2},
              {-216.8,51.2}}, color={0,0,127}));
      connect(Ctrl2.Q_dot_set, tESNetworkControl2_1.P) annotation (Line(points=
              {{46,82.8},{46,90},{-34,90},{-34,92},{-140,92},{-140,50},{-195.4,
              50}}, color={0,0,127}));
      connect(tESNetworkControl2_2.Tstorage_top, sF1_1.TTop) annotation (Line(
            points={{-124.8,133.2},{-140,133.2},{-140,142.1},{-147.3,142.1}},
            color={0,0,127}));
      connect(tESNetworkControl2_2.Tstorage_middle, sF1_1.TMiddle) annotation (
          Line(points={{-124.8,127.2},{-140,127.2},{-140,138.2},{-147.2,138.2}},
            color={0,0,127}));
      connect(tESNetworkControl2_2.Tstorage_bottom, sF1_1.TBottom) annotation (
          Line(points={{-124.8,121.2},{-140,121.2},{-140,144},{-144,144},{-144,
              146},{-147.3,146},{-147.3,135.1}}, color={0,0,127}));
      connect(tESNetworkControl2_2.P, Ctrl1.Q_dot_set) annotation (Line(points=
              {{-103.4,126},{-80,126},{-80,90},{-52,90},{-52,80.8}}, color={0,0,
              127}));
      connect(mF5_1.TTop, tESNetworkControl2_3.Tstorage_top) annotation (Line(
            points={{312.7,130.1},{312.7,142},{320,142},{320,126},{322,126},{
              322,113.2},{331.2,113.2}}, color={0,0,127}));
      connect(tESNetworkControl2_3.Tstorage_middle, mF5_1.TMiddle) annotation (
          Line(points={{331.2,107.2},{318,107.2},{318,146},{312.8,146},{312.8,
              126.2}}, color={0,0,127}));
      connect(tESNetworkControl2_3.Tstorage_bottom, mF5_1.TBottom) annotation (
          Line(points={{331.2,101.2},{318,101.2},{318,148},{312.7,148},{312.7,
              123.1}}, color={0,0,127}));
      connect(tESNetworkControl2_3.P, Ctrl3.Q_dot_set) annotation (Line(points=
              {{352.6,106},{360,106},{360,154},{142,154},{142,82.8}}, color={0,
              0,127}));
      connect(B3.port_a1, mF5_1.port_a1) annotation (Line(points={{138.8,25},{
              257.1,25},{257.1,132.8}}, color={0,127,255}));
      connect(B3.port_b1, mF5_1.port_b1) annotation (Line(points={{157,25},{157,
              28},{224,28},{224,146},{292.1,146},{292.1,131.9}}, color={0,127,
              255}));
      annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                200,160}})),                                         Diagram(
            coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                         graphics={Rectangle(extent={{-92,
                  154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                  154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                  154},{194,-20}},lineColor={28,108,200})}),
        experiment(
          StopTime=25200,
          Interval=1,
          __Dymola_Algorithm="Dassl"));
    end B1b_afshoun_crossover_noheat_noweight_alpha0;

    package ideal_prosumer
      model A1a_afshoun_crossover_noheat_noweight
        BidirectionalSubstation.Substation_idealProsumer.new_prosumer_models.heat_transfer_station
          B1(
          n=0.5,
          redeclare ProsNet.Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180
            feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={-48,8})));
        ProsNet.Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000, length=
              100)
          annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
        BidirectionalSubstation.Substation_idealProsumer.new_prosumer_models.heat_transfer_station
          B2(
          n=0.5,
          redeclare ProsNet.Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180
            feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={50,8})));
        BidirectionalSubstation.Substation_idealProsumer.new_prosumer_models.heat_transfer_station
          B3(
          n=0.5,
          redeclare ProsNet.Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180
            feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={148,8})));
        ProsNet.Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000, length=
              100)
          annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
        ProsNet.Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000, length=
              100)
          annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
        ProsNet.Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000, length=
              100)
          annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
        Modelica.Fluid.Sources.Boundary_pT boundary(
          redeclare package Medium = ProsNet.Media.Water,
          use_p_in=false,
          T=325.4,
          nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
        inner Modelica.Fluid.System system(T_ambient=285.15)
          annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
        Modelica.Blocks.Math.Add add annotation (Placement(transformation(
              extent={{-5,-5},{5,5}},
              rotation=-90,
              origin={-31,103})));
        Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
            Placement(transformation(
              extent={{-5,-6},{5,6}},
              rotation=270,
              origin={-8,117})));
        Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
            Placement(transformation(
              extent={{-5,-6},{5,6}},
              rotation=270,
              origin={82,115})));
        Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
              extent={{-5,-5},{5,5}},
              rotation=-90,
              origin={59,101})));
        Modelica.Blocks.Sources.RealExpression realExpression2(y=273.15) annotation (
            Placement(transformation(
              extent={{-5,-6},{5,6}},
              rotation=270,
              origin={178,117})));
        Modelica.Blocks.Math.Add add2 annotation (Placement(transformation(
              extent={{-5,-5},{5,5}},
              rotation=-90,
              origin={155,103})));

        Real Losses;

        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.auxiliary.TimeTable_noInterp
          power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6; 18000,6;
              21600,10; 25200,10]) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=-90,
              origin={-66,138})));
        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.auxiliary.TimeTable_noInterp
          temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30; 18000,
              55; 21600,55; 25200,55]) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=-90,
              origin={-24,138})));
        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.auxiliary.TimeTable_noInterp
          power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10; 18000,-10;
              21600,-4; 25200,-4]) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=-90,
              origin={32,138})));
        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.auxiliary.TimeTable_noInterp
          temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55; 18000,
              30; 21600,30; 25200,30]) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=-90,
              origin={74,138})));
        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.auxiliary.TimeTable_noInterp
          power_set3(table=[0,6; 3600,-6; 7200,-6; 10800,6; 14400,-4; 18000,4;
              21600,-6; 25200,-6]) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=-90,
              origin={130,138})));
        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.auxiliary.TimeTable_noInterp
          temp_sec_in3(table=[0,55; 3600,30; 7200,30; 10800,55; 14400,30; 18000,
              55; 21600,30; 25200,30]) annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=-90,
              origin={172,138})));
        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.PID_Q_T_weighted_crossover
          Ctrl1(
          alpha_prim_prod=1,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=1)
          annotation (Placement(transformation(extent={{-58,46},{-34,80}})));
        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.PID_Q_T_weighted_crossover
          Ctrl2(
          alpha_prim_prod=1,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=1)
          annotation (Placement(transformation(extent={{40,48},{64,82}})));
        BidirectionalSubstation.Substation_idealProsumer.Controller_PID_based.PID_Q_T_weighted_crossover
          Ctrl3(
          alpha_prim_prod=1,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=1)
          annotation (Placement(transformation(extent={{134,50},{158,84}})));
      equation
        connect(B1.hot_prim, pipe_hot12.port_a)
          annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
        connect(pipe_hot12.port_b, B2.hot_prim)
          annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
        connect(pipe_hot23.port_a, B2.hot_prim)
          annotation (Line(points={{88,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
        connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},{138,-45},
                {138,-46},{162,-46},{162,-10.2}}, color={0,127,255}));
        connect(B1.cold_prim, pipe_cold12.port_b)
          annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
        connect(pipe_cold12.port_a, B2.cold_prim)
          annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
        connect(B2.cold_prim, pipe_cold23.port_b)
          annotation (Line(points={{36,-10},{36,-90},{88,-90}}, color={0,127,255}));
        connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},{124,
                -90},{124,-92},{134,-92},{134,-10}}, color={0,127,255}));
        connect(pipe_hot12.port_a, boundary.ports[1])
          annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
        connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
                106},{-8,106},{-8,111.5}}, color={0,0,127}));
        connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{
                68,104},{68,107},{62,107}}, color={0,0,127}));
        connect(realExpression2.y, add2.u1) annotation (Line(points={{178,111.5},{178,106},
                {164,106},{164,109},{158,109}}, color={0,0,127}));
            Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

        connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-24,127},{-24,114},{-34,
                114},{-34,109}}, color={0,0,127}));
        connect(temp_sec_in2.y, add1.u2)
          annotation (Line(points={{74,127},{56,127},{56,107}}, color={0,0,127}));
        connect(temp_sec_in3.y, add2.u2)
          annotation (Line(points={{172,127},{152,127},{152,109}}, color={0,0,127}));
        connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-66,127},{-66,90},
                {-52,90},{-52,80.8}}, color={0,0,127}));
        connect(Ctrl1.states, B1.states)
          annotation (Line(points={{-58,62},{-74,62},{-74,8},{-68,8}}, color={0,0,127}));
        connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
          annotation (Line(points={{-34,62},{-18,62},{-18,8},{-27.8,8}}, color={0,0,127}));
        connect(add.y, Ctrl1.T_sec_in_is) annotation (Line(points={{-31,97.5},{-31,90},{-40,
                90},{-40,81}}, color={0,0,127}));
        connect(power_set2.y, Ctrl2.Q_dot_set) annotation (Line(points={{32,127},{40,127},{
                40,82.8},{46,82.8}}, color={0,0,127}));
        connect(add1.y, Ctrl2.T_sec_in_is)
          annotation (Line(points={{59,95.5},{58,95.5},{58,83}}, color={0,0,127}));
        connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
          annotation (Line(points={{64,64},{76,64},{76,8},{70.2,8}}, color={0,0,127}));
        connect(Ctrl2.states, B2.states)
          annotation (Line(points={{40,64},{24,64},{24,8},{30,8}}, color={0,0,127}));
        connect(Ctrl3.states, B3.states)
          annotation (Line(points={{134,66},{122,66},{122,8},{128,8}}, color={0,0,127}));
        connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
          annotation (Line(points={{158,66},{174,66},{174,8},{168.2,8}}, color={0,0,127}));
        connect(power_set3.y, Ctrl3.Q_dot_set) annotation (Line(points={{130,127},{130,92},
                {140,92},{140,84.8}}, color={0,0,127}));
        connect(add2.y, Ctrl3.T_sec_in_is) annotation (Line(points={{155,97.5},{154,97.5},{
                154,90},{152,90},{152,85}}, color={0,0,127}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                  200,160}})),                                         Diagram(
              coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                           graphics={Rectangle(extent={{-92,
                    154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                    154},{96,-20}}, lineColor={28,108,200}),         Rectangle(extent={{104,
                    154},{194,-20}},lineColor={28,108,200})}),
          experiment(
            StopTime=25200,
            Interval=1,
            __Dymola_Algorithm="Dassl"));
      end A1a_afshoun_crossover_noheat_noweight;
    end ideal_prosumer;

    package Combined_model
      model B2a_Afshoun_crossover_noheat_noweight_alpha0
        BidirectionalSubstation.New_Substation.HTS B1(
          n=0.5,
          redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={-86,0})));
        Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
          annotation (Placement(transformation(extent={{-36,-58},{-10,-32}})));
        BidirectionalSubstation.New_Substation.HTS B2(
          n=0.5,
          redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={34,0})));
        BidirectionalSubstation.New_Substation.HTS B3(
          n=0.5,
          redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={146,-2})));
        Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
          annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
        Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
          annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
        Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
          annotation (Placement(transformation(extent={{-10,-103},{-36,-77}})));
        Modelica.Fluid.Sources.Boundary_pT boundary(
          redeclare package Medium = Media.Water,
          use_p_in=false,
          T=325.4,
          nPorts=1) annotation (Placement(transformation(extent={{-160,-55},{-140,
                  -35}})));
        inner Modelica.Fluid.System system(T_ambient=285.15)
          annotation (Placement(transformation(extent={{-152,-112},{-132,-92}})));

        Real Losses;

        BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl1(
          alpha_prim_prod=0,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=0)
          annotation (Placement(transformation(extent={{-100,28},{-72,70}})));
        BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl2(
          alpha_prim_prod=0,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=0)
          annotation (Placement(transformation(extent={{20,26},{48,66}})));
        BidirectionalSubstation.Controller_PID_based.PID_Q_T_weighted_crossover Ctrl3(
          alpha_prim_prod=0,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=0)
          annotation (Placement(transformation(extent={{134,30},{158,64}})));
        Prosumers.SF1 sF1_1
          annotation (Placement(transformation(extent={{-108,150},{-74,170}})));
        Prosumers.SF4 sF4_1
          annotation (Placement(transformation(extent={{12,150},{48,172}})));
        Prosumers.MF5 mF5_1
          annotation (Placement(transformation(extent={{122,142},{162,178}})));
        Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
          tESNetworkControl3_1(deltaT=0) annotation (Placement(transformation(
              extent={{-14,-14},{14,14}},
              rotation=270,
              origin={-86,100})));
        Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
          tESNetworkControl3_2(deltaT=0) annotation (Placement(transformation(
              extent={{-13,-13},{13,13}},
              rotation=270,
              origin={35,99})));
        Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
          tESNetworkControl3_3(deltaT=0) annotation (Placement(transformation(
              extent={{-13,-13},{13,13}},
              rotation=270,
              origin={147,101})));
      equation
        connect(B1.hot_prim, pipe_hot12.port_a)
          annotation (Line(points={{-72,-18.2},{-72,-45},{-36,-45}},color={0,127,255}));
        connect(pipe_hot12.port_b, B2.hot_prim)
          annotation (Line(points={{-10,-45},{-10,-46},{48,-46},{48,-18.2}},
                                                                  color={0,127,255}));
        connect(pipe_hot23.port_a, B2.hot_prim)
          annotation (Line(points={{88,-45},{88,-46},{48,-46},{48,-18.2}},
                                                                  color={0,127,255}));
        connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},
                {114,-46},{160,-46},{160,-20.2}}, color={0,127,255}));
        connect(B1.cold_prim, pipe_cold12.port_b)
          annotation (Line(points={{-100,-18},{-100,-90},{-36,-90}},
                                                                  color={0,127,255}));
        connect(pipe_cold12.port_a, B2.cold_prim)
          annotation (Line(points={{-10,-90},{20,-90},{20,-18}},color={0,127,255}));
        connect(B2.cold_prim, pipe_cold23.port_b)
          annotation (Line(points={{20,-18},{20,-90},{88,-90}}, color={0,127,255}));
        connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},
                {132,-90},{132,-20}},                color={0,127,255}));
        connect(pipe_hot12.port_a, boundary.ports[1])
          annotation (Line(points={{-36,-45},{-140,-45}},
                                                        color={0,127,255}));
            Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

        connect(Ctrl1.states, B1.states)
          annotation (Line(points={{-100,47.7647},{-116,47.7647},{-116,0},{-106,0}},
                                                                       color={0,0,127}));
        connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
          annotation (Line(points={{-72,47.7647},{-56,47.7647},{-56,0},{-65.8,0}},
                                                                         color={0,0,127}));
        connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
          annotation (Line(points={{48,44.8235},{64,44.8235},{64,0},{54.2,0}},
                                                                     color={0,0,127}));
        connect(Ctrl2.states, B2.states)
          annotation (Line(points={{20,44.8235},{4,44.8235},{4,0},{14,0}},
                                                                   color={0,0,127}));
        connect(Ctrl3.states, B3.states)
          annotation (Line(points={{134,46},{116,46},{116,-2},{126,-2}},
                                                                       color={0,0,127}));
        connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
          annotation (Line(points={{158,46},{176,46},{176,-2},{166.2,-2}},
                                                                         color={0,0,127}));
        connect(sF4_1.port_a1, B2.port_a1) annotation (Line(points={{20.8286,
                172.037},{20.8286,182},{-4,182},{-4,16},{10,16},{10,17},{24.8,
                17}},                                     color={0,127,255}));
        connect(sF4_1.port_b1, B2.port_b1) annotation (Line(points={{36.1714,
                174.603},{36.1714,182},{70,182},{70,16},{54,16},{54,17},{43,17}},
                                                                color={0,127,255}));
        connect(B1.port_a1, sF1_1.port_a1) annotation (Line(points={{-95.2,17},
                {-110,17},{-110,18},{-128,18},{-128,184},{-98.8119,184},{
                -98.8119,170.742}},
              color={0,127,255}));
        connect(sF1_1.port_b1, B1.port_b1) annotation (Line(points={{-83.1881,
                170.645},{-83.1881,184},{-46,184},{-46,18},{-60,18},{-60,17},{
                -77,17}},
                      color={0,127,255}));
        connect(B3.port_a1, mF5_1.port_a1) annotation (Line(points={{136.8,15},
                {136.8,14},{108,14},{108,182},{133.952,182},{133.952,174.839}},
              color={0,127,255}));
        connect(B3.port_b1, mF5_1.port_b1) annotation (Line(points={{155,15},{
                156,15},{156,14},{186,14},{186,182},{150.619,182},{150.619,
                174.444}},                                             color={0,
                127,255}));
        connect(tESNetworkControl3_1.Tout, Ctrl1.T_sec_in_is) annotation (Line(
              points={{-77.32,87.68},{-77.32,78},{-79,78},{-79,71.2353}},  color=
                {0,0,127}));
        connect(tESNetworkControl3_1.P, Ctrl1.Q_dot_set) annotation (Line(points={{-90.76,
                87.68},{-90.76,80},{-93,80},{-93,70.9882}},             color={0,
                0,127}));
        connect(tESNetworkControl3_1.Tstorage_top, sF1_1.TTop) annotation (Line(
              points={{-75.92,117.92},{-75.92,124},{-68,124},{-68,173.258},{
                -75.3357,173.258}},  color={0,0,127}));
        connect(tESNetworkControl3_1.Tstorage_middle, sF1_1.TMiddle) annotation (
            Line(points={{-84.32,117.92},{-84.32,122},{-84,122},{-84,128},{-70,
                128},{-70,172},{-75.2952,172}},                         color={0,
                0,127}));
        connect(sF1_1.TBottom, tESNetworkControl3_1.Tstorage_bottom) annotation (
            Line(points={{-75.3357,171},{-75.3357,170},{-72,170},{-72,132},{
                -92.72,132},{-92.72,117.92}},
                                       color={0,0,127}));
        connect(sF4_1.TTop, tESNetworkControl3_2.Tstorage_top) annotation (Line(
              points={{46.5857,175.703},{46.5857,176},{54,176},{54,124},{44.36,
                124},{44.36,115.64}},
              color={0,0,127}));
        connect(sF4_1.TMiddle, tESNetworkControl3_2.Tstorage_middle) annotation (
            Line(points={{46.6286,174.273},{46.6286,178},{52,178},{52,126},{
                36.56,126},{36.56,115.64}},             color={0,0,127}));
        connect(tESNetworkControl3_2.Tstorage_bottom, sF4_1.TBottom) annotation (
            Line(points={{28.76,115.64},{28.76,136},{50,136},{50,180},{46.5857,
                180},{46.5857,173.137}},
                           color={0,0,127}));
        connect(tESNetworkControl3_2.P, Ctrl2.Q_dot_set) annotation (Line(points={{30.58,
                87.56},{30.58,70},{27,70},{27,66.9412}},
                                                       color={0,0,127}));
        connect(tESNetworkControl3_2.Tout, Ctrl2.T_sec_in_is) annotation (Line(
              points={{43.06,87.56},{43.06,70},{41,70},{41,67.1765}},
                                                          color={0,0,127}));
        connect(mF5_1.TTop, tESNetworkControl3_3.Tstorage_top) annotation (Line(
              points={{160.429,173.654},{170,173.654},{170,122},{156.36,122},{
                156.36,117.64}},       color={0,0,127}));
        connect(tESNetworkControl3_3.Tstorage_middle, mF5_1.TMiddle) annotation (
            Line(points={{148.56,117.64},{148.56,124},{168,124},{168,171.941},{
                160.476,171.941}},                                         color=
                {0,0,127}));
        connect(mF5_1.TBottom, tESNetworkControl3_3.Tstorage_bottom) annotation (
            Line(points={{160.429,170.58},{166,170.58},{166,126},{140,126},{140,
                122},{140.76,122},{140.76,117.64}},
                               color={0,0,127}));
        connect(tESNetworkControl3_3.P, Ctrl3.Q_dot_set) annotation (Line(points={{142.58,
                89.56},{142.58,80},{140,80},{140,64.8}},       color={0,0,127}));
        connect(tESNetworkControl3_3.Tout, Ctrl3.T_sec_in_is) annotation (Line(
              points={{155.06,89.56},{154,89.56},{154,78},{152,78},{152,65}},
                                                     color={0,0,127}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -120},{200,200}})),                                  Diagram(
              coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                  200,200}})),
          experiment(
            StopTime=25200,
            Interval=1,
            __Dymola_Algorithm="Dassl"));
      end B2a_Afshoun_crossover_noheat_noweight_alpha0;
    end Combined_model;

    package ideal_network
      model C1a_Afshoun_crossover_noheat_noweight_alpha0
        BidirectionalSubstation_idealNet.New_Substation_IdealNet.HTS_idealNetwork
          B1(
          n=0.5,
          redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={-86,0})));
        Fluid.Pipes.InsulatedPipe_plug pipe_hot12(R_ins=100000,  length=100)
          annotation (Placement(transformation(extent={{-36,-58},{-10,-32}})));
        BidirectionalSubstation_idealNet.New_Substation_IdealNet.HTS_idealNetwork
          B2(
          n=0.5,
          redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={34,0})));
        BidirectionalSubstation_idealNet.New_Substation_IdealNet.HTS_idealNetwork
          B3(
          n=0.5,
          redeclare Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer,
          R_ins_transferpipe=100000) annotation (Placement(transformation(
              extent={{20,-18},{-20,18}},
              rotation=0,
              origin={146,-2})));
        Fluid.Pipes.InsulatedPipe_plug pipe_hot23(R_ins=100000,  length=100)
          annotation (Placement(transformation(extent={{88,-58},{114,-32}})));
        Fluid.Pipes.InsulatedPipe_plug pipe_cold23(R_ins=100000,  length=100)
          annotation (Placement(transformation(extent={{114,-103},{88,-77}})));
        Fluid.Pipes.InsulatedPipe_plug pipe_cold12(R_ins=100000,  length=100)
          annotation (Placement(transformation(extent={{-10,-103},{-36,-77}})));
        Modelica.Fluid.Sources.Boundary_pT boundary(
          redeclare package Medium = Media.Water,
          use_p_in=false,
          T=325.4,
          nPorts=1) annotation (Placement(transformation(extent={{-160,-55},{-140,
                  -35}})));
        inner Modelica.Fluid.System system(T_ambient=285.15)
          annotation (Placement(transformation(extent={{-152,-112},{-132,-92}})));

        Real Losses;

        BidirectionalSubstation_idealNet.Controller_PID_based.PID_Q_T_weighted_crossover_idealNet
          Ctrl1(
          alpha_prim_prod=0,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=0)
          annotation (Placement(transformation(extent={{-100,28},{-72,70}})));
        BidirectionalSubstation_idealNet.Controller_PID_based.PID_Q_T_weighted_crossover_idealNet
          Ctrl2(
          alpha_prim_prod=0,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=0)
          annotation (Placement(transformation(extent={{20,26},{48,66}})));
        BidirectionalSubstation_idealNet.Controller_PID_based.PID_Q_T_weighted_crossover_idealNet
          Ctrl3(
          alpha_prim_prod=0,
          alpha_sec_prod=0,
          alpha_prim_cons=0,
          alpha_sec_cons=0)
          annotation (Placement(transformation(extent={{134,30},{158,64}})));
        Prosumers.SF1 sF1_1
          annotation (Placement(transformation(extent={{-108,150},{-74,170}})));
        Prosumers.SF4 sF4_1
          annotation (Placement(transformation(extent={{12,150},{48,172}})));
        Prosumers.MF5 mF5_1
          annotation (Placement(transformation(extent={{122,142},{162,178}})));
        Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
          tESNetworkControl3_1(deltaT=0) annotation (Placement(transformation(
              extent={{-14,-14},{14,14}},
              rotation=270,
              origin={-86,100})));
        Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
          tESNetworkControl3_2(deltaT=0) annotation (Placement(transformation(
              extent={{-13,-13},{13,13}},
              rotation=270,
              origin={35,99})));
        Controls.GeneratorControlPackage.ControlGenerator.TESNetworkControl3
          tESNetworkControl3_3(deltaT=0) annotation (Placement(transformation(
              extent={{-13,-13},{13,13}},
              rotation=270,
              origin={147,101})));
      equation
        connect(B1.hot_prim, pipe_hot12.port_a)
          annotation (Line(points={{-72,-18.2},{-72,-45},{-36,-45}},color={0,127,255}));
        connect(pipe_hot12.port_b, B2.hot_prim)
          annotation (Line(points={{-10,-45},{-10,-46},{48,-46},{48,-18.2}},
                                                                  color={0,127,255}));
        connect(pipe_hot23.port_a, B2.hot_prim)
          annotation (Line(points={{88,-45},{88,-46},{48,-46},{48,-18.2}},
                                                                  color={0,127,255}));
        connect(pipe_hot23.port_b, B3.hot_prim) annotation (Line(points={{114,-45},
                {114,-46},{160,-46},{160,-20.2}}, color={0,127,255}));
        connect(B1.cold_prim, pipe_cold12.port_b)
          annotation (Line(points={{-100,-18},{-100,-90},{-36,-90}},
                                                                  color={0,127,255}));
        connect(pipe_cold12.port_a, B2.cold_prim)
          annotation (Line(points={{-10,-90},{20,-90},{20,-18}},color={0,127,255}));
        connect(B2.cold_prim, pipe_cold23.port_b)
          annotation (Line(points={{20,-18},{20,-90},{88,-90}}, color={0,127,255}));
        connect(pipe_cold23.port_a, B3.cold_prim) annotation (Line(points={{114,-90},
                {132,-90},{132,-20}},                color={0,127,255}));
        connect(pipe_hot12.port_a, boundary.ports[1])
          annotation (Line(points={{-36,-45},{-140,-45}},
                                                        color={0,127,255}));
            Losses = Ctrl1.Q_dot_is + Ctrl2.Q_dot_is + Ctrl3.Q_dot_is;

        connect(Ctrl1.states, B1.states)
          annotation (Line(points={{-100,47.7647},{-116,47.7647},{-116,0},{-106,0}},
                                                                       color={0,0,127}));
        connect(Ctrl1.contr_vars_real, B1.contr_vars_real)
          annotation (Line(points={{-72,47.7647},{-56,47.7647},{-56,0},{-65.8,0}},
                                                                         color={0,0,127}));
        connect(Ctrl2.contr_vars_real, B2.contr_vars_real)
          annotation (Line(points={{48,44.8235},{64,44.8235},{64,0},{54.2,0}},
                                                                     color={0,0,127}));
        connect(Ctrl2.states, B2.states)
          annotation (Line(points={{20,44.8235},{4,44.8235},{4,0},{14,0}},
                                                                   color={0,0,127}));
        connect(Ctrl3.states, B3.states)
          annotation (Line(points={{134,46},{116,46},{116,-2},{126,-2}},
                                                                       color={0,0,127}));
        connect(Ctrl3.contr_vars_real, B3.contr_vars_real)
          annotation (Line(points={{158,46},{176,46},{176,-2},{166.2,-2}},
                                                                         color={0,0,127}));
        connect(sF4_1.port_a1, B2.port_a1) annotation (Line(points={{20.8286,
                172.037},{20.8286,182},{-4,182},{-4,16},{10,16},{10,17},{24.8,
                17}},                                     color={0,127,255}));
        connect(sF4_1.port_b1, B2.port_b1) annotation (Line(points={{36.1714,
                174.603},{36.1714,182},{70,182},{70,16},{54,16},{54,17},{43,17}},
                                                                color={0,127,255}));
        connect(B1.port_a1, sF1_1.port_a1) annotation (Line(points={{-95.2,17},
                {-110,17},{-110,18},{-128,18},{-128,184},{-98.8119,184},{
                -98.8119,170.742}},
              color={0,127,255}));
        connect(sF1_1.port_b1, B1.port_b1) annotation (Line(points={{-83.1881,
                170.645},{-83.1881,184},{-46,184},{-46,18},{-60,18},{-60,17},{
                -77,17}},
                      color={0,127,255}));
        connect(B3.port_a1, mF5_1.port_a1) annotation (Line(points={{136.8,15},
                {136.8,14},{108,14},{108,182},{133.952,182},{133.952,174.839}},
              color={0,127,255}));
        connect(B3.port_b1, mF5_1.port_b1) annotation (Line(points={{155,15},{
                156,15},{156,14},{186,14},{186,182},{150.619,182},{150.619,
                174.444}},                                             color={0,
                127,255}));
        connect(tESNetworkControl3_1.Tout, Ctrl1.T_sec_in_is) annotation (Line(
              points={{-77.32,87.68},{-77.32,78},{-79,78},{-79,71.2353}},  color=
                {0,0,127}));
        connect(tESNetworkControl3_1.P, Ctrl1.Q_dot_set) annotation (Line(points={{-90.76,
                87.68},{-90.76,80},{-93,80},{-93,70.9882}},             color={0,
                0,127}));
        connect(tESNetworkControl3_1.Tstorage_top, sF1_1.TTop) annotation (Line(
              points={{-75.92,117.92},{-75.92,124},{-68,124},{-68,173.258},{
                -75.3357,173.258}},  color={0,0,127}));
        connect(tESNetworkControl3_1.Tstorage_middle, sF1_1.TMiddle) annotation (
            Line(points={{-84.32,117.92},{-84.32,122},{-84,122},{-84,128},{-70,
                128},{-70,172},{-75.2952,172}},                         color={0,
                0,127}));
        connect(sF1_1.TBottom, tESNetworkControl3_1.Tstorage_bottom) annotation (
            Line(points={{-75.3357,171},{-75.3357,170},{-72,170},{-72,132},{
                -92.72,132},{-92.72,117.92}},
                                       color={0,0,127}));
        connect(sF4_1.TTop, tESNetworkControl3_2.Tstorage_top) annotation (Line(
              points={{46.5857,175.703},{46.5857,176},{54,176},{54,124},{44.36,
                124},{44.36,115.64}},
              color={0,0,127}));
        connect(sF4_1.TMiddle, tESNetworkControl3_2.Tstorage_middle) annotation (
            Line(points={{46.6286,174.273},{46.6286,178},{52,178},{52,126},{
                36.56,126},{36.56,115.64}},             color={0,0,127}));
        connect(tESNetworkControl3_2.Tstorage_bottom, sF4_1.TBottom) annotation (
            Line(points={{28.76,115.64},{28.76,136},{50,136},{50,180},{46.5857,
                180},{46.5857,173.137}},
                           color={0,0,127}));
        connect(tESNetworkControl3_2.P, Ctrl2.Q_dot_set) annotation (Line(points={{30.58,
                87.56},{30.58,70},{27,70},{27,66.9412}},
                                                       color={0,0,127}));
        connect(tESNetworkControl3_2.Tout, Ctrl2.T_sec_in_is) annotation (Line(
              points={{43.06,87.56},{43.06,70},{41,70},{41,67.1765}},
                                                          color={0,0,127}));
        connect(mF5_1.TTop, tESNetworkControl3_3.Tstorage_top) annotation (Line(
              points={{160.429,173.654},{170,173.654},{170,122},{156.36,122},{
                156.36,117.64}},       color={0,0,127}));
        connect(tESNetworkControl3_3.Tstorage_middle, mF5_1.TMiddle) annotation (
            Line(points={{148.56,117.64},{148.56,124},{168,124},{168,171.941},{
                160.476,171.941}},                                         color=
                {0,0,127}));
        connect(mF5_1.TBottom, tESNetworkControl3_3.Tstorage_bottom) annotation (
            Line(points={{160.429,170.58},{166,170.58},{166,126},{140,126},{140,
                122},{140.76,122},{140.76,117.64}},
                               color={0,0,127}));
        connect(tESNetworkControl3_3.P, Ctrl3.Q_dot_set) annotation (Line(points={{142.58,
                89.56},{142.58,80},{140,80},{140,64.8}},       color={0,0,127}));
        connect(tESNetworkControl3_3.Tout, Ctrl3.T_sec_in_is) annotation (Line(
              points={{155.06,89.56},{154,89.56},{154,78},{152,78},{152,65}},
                                                     color={0,0,127}));
        annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                  -120},{200,200}})),                                  Diagram(
              coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                  200,200}})),
          experiment(
            StopTime=25200,
            Interval=1,
            __Dymola_Algorithm="Dassl"));
      end C1a_Afshoun_crossover_noheat_noweight_alpha0;

      package BidirectionalSubstation_idealNet
        "Models that are currently under development"
        package New_Substation_IdealNet

          model GeneralHouse

            extends
              ProsNet.Prosumers.SecondarySides.BaseClasses.ControlVolumeDynParam;

            Modelica.Fluid.Interfaces.FluidPort_a port_hot(redeclare package
                Medium =
                  Media.Water)
              annotation (Placement(transformation(extent={{-70,-110},{-50,-90}})));
            Modelica.Fluid.Interfaces.FluidPort_b port_cold(redeclare package
                Medium =
                  Media.Water)
              annotation (Placement(transformation(extent={{50,-110},{70,-90}})));
            Modelica.Blocks.Interfaces.RealOutput m_dot_sec_is "kg/s" annotation (
                Placement(transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=-90,
                  origin={0,-98})));
            Modelica.Blocks.Interfaces.RealOutput T_sec_hot annotation (Placement(
                  transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=-90,
                  origin={-80,-100})));
            Modelica.Blocks.Interfaces.RealOutput T_sec_cold annotation (Placement(
                  transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=-90,
                  origin={80,-100})));
            Modelica.Fluid.Sensors.TemperatureTwoPort T_sens_hot(redeclare
                package Medium =
                  Media.Water) annotation (Placement(transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=90,
                  origin={-60,-50})));
            Modelica.Fluid.Sensors.TemperatureTwoPort T_sens_cold(redeclare
                package Medium =
                         Media.Water) annotation (Placement(transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=-90,
                  origin={60,-50})));
            Modelica.Fluid.Sensors.MassFlowRate massFlowRate(redeclare package
                Medium = Media.Water) annotation (Placement(
                  transformation(
                  extent={{-10,10},{10,-10}},
                  rotation=90,
                  origin={-58,-16})));
            Prosumers.SF1 sF1_1
              annotation (Placement(transformation(extent={{-28,-24},{56,38}})));
          equation
            connect(T_sens_hot.port_a, port_hot)
              annotation (Line(points={{-60,-60},{-60,-100}}, color={0,127,255}));
            connect(T_sens_hot.T, T_sec_hot) annotation (Line(points={{-71,-50},{-80,-50},
                    {-80,-100}}, color={0,0,127}));
            connect(T_sens_cold.port_b, port_cold)
              annotation (Line(points={{60,-60},{60,-100}}, color={0,127,255}));
            connect(T_sens_cold.T, T_sec_cold)
              annotation (Line(points={{71,-50},{80,-50},{80,-100}}, color={0,0,127}));
            connect(massFlowRate.port_a, T_sens_hot.port_b)
              annotation (Line(points={{-58,-26},{-58,-34},{-60,-34},{-60,-40}},
                                                             color={0,127,255}));
            connect(massFlowRate.m_flow, m_dot_sec_is) annotation (Line(points={{-47,-16},
                    {-34,-16},{-34,-84},{0,-84},{0,-98}}, color={0,0,127}));
            connect(massFlowRate.port_b, sF1_1.port_a1) annotation (Line(points={{-58,
                    -6},{-58,53.4},{20.8,53.4}}, color={0,127,255}));
            connect(T_sens_cold.port_a, sF1_1.port_b1) annotation (Line(points={{60,
                    -40},{60,52.8},{25.2,52.8}}, color={0,127,255}));
            annotation (Icon(coordinateSystem(preserveAspectRatio=false), graphics={
                  Rectangle(
                    extent={{-100,40},{100,-100}},
                    lineColor={0,0,0},
                    lineThickness=1),
                  Polygon(
                    points={{100,40},{8,100},{-8,100},{-100,40},{100,40}},
                    lineColor={0,0,0},
                    lineThickness=1)}),
                Diagram(coordinateSystem(preserveAspectRatio=false)));
          end GeneralHouse;

          model HTS_idealNetwork

            replaceable package Medium_prim = ProsNet.Media.Water;
            replaceable package Medium_sec = ProsNet.Media.Water;

            extends ProsNet.Prosumers.BaseClasses.PrimarySideParameters;
            extends
              ProsNet.Prosumers.SecondarySides.BaseClasses.PumpsPairDynParam;
            extends
              ProsNet.Prosumers.SecondarySides.BaseClasses.ControlVolumeDynParam;

            Modelica.Blocks.Interfaces.RealVectorInput contr_vars_real[6]
          annotation (Placement(transformation(extent={{-222,-20},{-182,20}})));

            Modelica.Blocks.Interfaces.RealVectorOutput states[8]
          annotation (Placement(transformation(extent={{180,-20},{220,20}})));

            Real pi
          annotation (Placement(transformation(extent={{-180,0},{-140,40}})));
            Real mu
          annotation (Placement(transformation(extent={{-180,-40},{-140,0}})));
            Real u_set_prim_prod
          annotation (Placement(transformation(extent={{-180,-80},{-140,-40}})));
            Real u_set_prim_cons
          annotation (Placement(transformation(extent={{-180,-120},{-140,-80}})));

          Real T_prim_hot(unit="K", displayUnit="degC")                                 "K"
                                                         annotation (Placement(
              transformation(
              extent={{-20,-20},{20,20}},
              rotation=180,
              origin={160,60})));

           Real T_prim_cold(unit="K", displayUnit="degC") "K"
                                                          annotation (Placement(
              transformation(
              extent={{-20,-20},{20,20}},
              rotation=180,
              origin={160,20})));

           Real V_dot_prim(unit="l/min", displayUnit="l/min") "l/min"
                                                         annotation (Placement(
              transformation(
              extent={{-20,-20},{20,20}},
              rotation=180,
              origin={160,-20})));

           Real V_dot_sec(unit="l/min", displayUnit="l/min") "l/min"
                                                        annotation (Placement(
              transformation(
              extent={{20,-20},{-20,20}},
              rotation=0,
              origin={160,-60})));

            Real Q_dot_is(unit="kW", displayUnit="kW")
          "kW" annotation (Placement(transformation(
              extent={{20,-20},{-20,20}},
              rotation=0,
              origin={160,-100})));

            Real Delta_p_prim(unit="Pa", displayUnit="bar") annotation (
            Placement(transformation(
              extent={{-20,-20},{20,20}},
              rotation=180,
              origin={160,-140})));

            Real cp_prim;

            Fluid.HeatExchangers.LiquidToLiquid heat_exchanger(
          redeclare package Medium2 = Medium_sec,
          redeclare package Medium1 = Medium_prim,
          m1_flow_nominal=m_flow_nominal_1,
          m2_flow_nominal=m_flow_nominal_2,
          show_T=true,
          dp1_nominal=dp1_nominal,
          dp2_nominal=dp2_nominal,
          Q_flow_nominal=Q_flow_nominal,
          T_a1_nominal=338.15,
          T_a2_nominal=313.15)
          annotation (Placement(transformation(extent={{30,12},{50,-8}})));

            Fluid.FixedResistances.CheckValve cheVa_sec_cons(
          m_flow_nominal=m_flow_nominal_2,
          redeclare final package Medium = Medium_sec,
          final CvData=ProsNet.Fluid.Types.CvTypes.Kv,
          final Kv=Kv_cheVal,
          final l=l_cheVal) annotation (Placement(transformation(
              extent={{-10,10},{10,-10}},
              rotation=270,
              origin={60,42})));
            Fluid.FixedResistances.CheckValve cheVal_sec_prod(
          m_flow_nominal=m_flow_nominal_2,
          redeclare final package Medium = Medium_sec,
          final CvData=ProsNet.Fluid.Types.CvTypes.Kv,
          final Kv=Kv_cheVal,
          final l=l_cheVal) annotation (Placement(transformation(
              extent={{10,-10},{-10,10}},
              rotation=270,
              origin={100,70})));
            Fluid.Valves.TwoWayEqualPercentage valve_prim_cons(
          m_flow_nominal=m_flow_nominal_1,
          redeclare final package Medium = Medium_prim,
          final CvData=ProsNet.Fluid.Types.CvTypes.Kv,
          final Kv=Kv_conVal,
          final use_inputFilter=use_inputFilter_conVal,
          final riseTime=riseTime_conVal,
          final init=init_conVal,
          final y_start=y_start_conVal,
          final l=l_conVal) annotation (Placement(transformation(
              extent={{10,10},{-10,-10}},
              rotation=-90,
              origin={60,-40})));
            Fluid.FixedResistances.CheckValve cheVal_prim_prod(
          m_flow_nominal=m_flow_nominal_1,
          redeclare final package Medium = Medium_prim,
          final CvData=ProsNet.Fluid.Types.CvTypes.Kv,
          final Kv=Kv_cheVal,
          final l=l_cheVal) annotation (Placement(transformation(
              extent={{10,10},{-10,-10}},
              rotation=-90,
              origin={100,-40})));
            Fluid.FixedResistances.CheckValve cheVal_prim_cons(
          m_flow_nominal=m_flow_nominal_1,
          redeclare final package Medium = Medium_prim,
          final CvData=ProsNet.Fluid.Types.CvTypes.Kv,
          final Kv=Kv_cheVal,
          final l=l_cheVal) annotation (Placement(transformation(
              extent={{10,-10},{-10,10}},
              rotation=90,
              origin={62,-70})));
            Modelica.Fluid.Interfaces.FluidPort_b cold_prim(redeclare final
                package Medium =
                  Medium_prim)
          annotation (Placement(transformation(extent={{130,-190},{150,-170}})));
            Modelica.Fluid.Interfaces.FluidPort_a hot_prim(redeclare final
                package Medium =
                  Medium_prim)
          annotation (Placement(transformation(extent={{-150,-192},{-130,-172}})));
            Conversion conversion
          annotation (Placement(transformation(extent={{-100,-4},{-52,66}})));
            Modelica.Fluid.Sensors.MassFlowRate m_dot_sens_prim(
          redeclare package Medium = Medium_prim, allowFlowReversal=true)
                                                  annotation (Placement(
              transformation(
              extent={{10,-10},{-10,10}},
              rotation=90,
              origin={-20,-72})));
            Modelica.Fluid.Sensors.TemperatureTwoPort T_sens_prim_hot(
          redeclare package Medium = Medium_prim, allowFlowReversal=true) annotation (
            Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=90,
              origin={-20,-110})));
            Modelica.Fluid.Sensors.TemperatureTwoPort T_sens_prim_cold(
          redeclare package Medium = Medium_prim, allowFlowReversal=true)
                                                  annotation (
            Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=-90,
              origin={80,-110})));
            Fluid.Sources.Boundary_pT bou(
              redeclare package Medium = Medium_sec,
          T=313.15,
            nPorts=1)
          annotation (Placement(transformation(extent={{128,118},{108,138}})));

            Fluid.Sensors.RelativePressure pressureDifference_prim(redeclare
                package Medium = Medium_prim) annotation (Placement(
                  transformation(extent={{4,-178},{24,-158}})));

            Fluid.Pipes.InsulatedPipe_plug pipe_prim_hot(
          T_amb=ambient_temperature,
          R_ins=R_ins_transferpipe,
          length=length_transfer_pipe_tot/2,
              diameter=d_transferpipe/2,
          zeta=zeta_transferstation/2)  annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=90,
              origin={-20,-138})));
            Fluid.Pipes.InsulatedPipe_plug pipe_prim_cold(
          T_amb=ambient_temperature,
          R_ins=R_ins_transferpipe,
          length=length_transfer_pipe_tot/2,
              diameter=d_transferpipe/2,
          zeta=zeta_transferstation/2)  annotation (Placement(transformation(
              extent={{-10,-10},{10,10}},
              rotation=-90,
              origin={80,-140})));
            Fluid.Pumps.SpeedControlled_y pump_sec_prod(
              redeclare final package Medium = Medium_prim,
              final energyDynamics=energyDynamics_feedPump,
              T_start=313.15,
              final tau=tau_feedPump,
              final per=feedinPer,
              final use_inputFilter=use_inputFilter_feedPump,
              final riseTime=riseTime_feedPump,
              final init=init_feedPump,
              final y_start=y_start_feedPump) annotation (Placement(transformation(
                  extent={{10,10},{-10,-10}},
                  rotation=-90,
                  origin={100,28})));
            Fluid.Pumps.SpeedControlled_y pump_sec_cons(
              redeclare final package Medium = Medium_prim,
              final energyDynamics=energyDynamics_feedPump,
              T_start=313.15,
              final tau=tau_feedPump,
              final per=feedinPer,
              final use_inputFilter=use_inputFilter_feedPump,
              final riseTime=riseTime_feedPump,
              final init=init_feedPump,
              final y_start=y_start_feedPump) annotation (Placement(transformation(
                  extent={{10,10},{-10,-10}},
                  rotation=90,
                  origin={60,74})));
            Real u_set_sec_cons
          annotation (Placement(transformation(extent={{-180,40},{-140,80}})));
            Real u_set_sec_prod
          annotation (Placement(transformation(extent={{-180,80},{-140,120}})));
            Modelica.Fluid.Sensors.TemperatureTwoPort T_sens_sec_hot(redeclare
                package Medium =
                         Medium_prim, allowFlowReversal=true) annotation (Placement(
                  transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=90,
                  origin={-40,152})));
            Modelica.Fluid.Sensors.TemperatureTwoPort T_sens_sec_cold(redeclare
                package Medium =
                         Medium_prim, allowFlowReversal=true) annotation (Placement(
                  transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=-90,
                  origin={52,106})));
            Modelica.Fluid.Sensors.MassFlowRate massFlowRate(redeclare package
                Medium =
                  Media.Water)        annotation (Placement(
                  transformation(
                  extent={{-10,10},{10,-10}},
                  rotation=270,
                  origin={-14,116})));
            Modelica.Fluid.Interfaces.FluidPort_a port_a1
              "Fluid connector a (positive design flow direction is from port_a to port_b)"
              annotation (Placement(transformation(extent={{82,160},{102,180}})));
            Modelica.Fluid.Interfaces.FluidPort_b port_b1
              "Fluid connector b (positive design flow direction is from port_a to port_b)"
              annotation (Placement(transformation(extent={{-100,160},{-80,180}})));
            Fluid.Pumps.FlowControlled_m_flow         pump_prim_prod(
              redeclare package Medium = Medium_sec,
              final energyDynamics=energyDynamics_pumpsSec,
              T_start=313.15,
              final tau=tau_pumpsSec,
              final m_flow_nominal=m_flow_nominal_2,
              final use_inputFilter=use_inputFilter_pumpsSec,
              final riseTime=riseTime_pumpsSec,
              final dp_nominal=dp2_nominal,
              final m_flow_start=m_flow_start_pumpsSec,
              final y_start=y_start_pumpsSec) annotation (Placement(transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=90,
                  origin={100,-74})));
            Fluid.Sensors.RelativePressure pressureDifference_sec(redeclare
                package Medium = Medium_prim) annotation (Placement(
                  transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=180,
                  origin={26,150})));
          equation

            connect(
                contr_vars_real[3], conversion.pi);
            connect(
                contr_vars_real[4], conversion.mu);
            connect(contr_vars_real[5], conversion.u_set_prim_prod);
            connect(
                contr_vars_real[6], conversion.u_set_prim_cons);

            u_set_sec_cons = contr_vars_real[1];
            u_set_sec_prod = contr_vars_real[2];
            pi = contr_vars_real[3];
            mu = contr_vars_real[4];
            u_set_prim_prod = contr_vars_real[5];
            u_set_prim_cons = contr_vars_real[6];

            cp_prim = 4200;
            states[7] = m_dot_sens_prim.port_a.m_flow*cp_prim*(T_sens_prim_hot.T -
              T_sens_prim_cold.T)/1000;

            connect(
                heat_exchanger.port_b1, valve_prim_cons.port_b)
          annotation (Line(points={{50,-4},{60,-4},{60,-30}}, color={0,127,255}));
            connect(
                cheVal_prim_prod.port_b,heat_exchanger. port_b1)
          annotation (Line(points={{100,-30},{100,-4},{50,-4}},
                                                              color={0,127,255}));
            connect(
                cheVa_sec_cons.port_b,heat_exchanger. port_a2)
          annotation (Line(points={{60,32},{60,8},{50,8}}, color={0,127,255}));
            connect(
                valve_prim_cons.port_a, cheVal_prim_cons.port_a)
          annotation (Line(points={{60,-50},{60,-60},{62,-60}},
                                                       color={0,127,255}));
            connect(
                conversion.valve_contr, valve_prim_cons.y) annotation (Line(points={{-52,
                    14.2778},{-42,14.2778},{-42,12},{-32,12},{-32,-40},{48,-40}},
                                                                             color={0,
                0,127}));

            connect(
                m_dot_sens_prim.m_flow, conversion.m_dot_prim_is);
            connect(
                cheVal_prim_cons.port_b, T_sens_prim_cold.port_a) annotation (Line(
              points={{62,-80},{62,-90},{80,-90},{80,-100}}, color={0,127,255}));

            connect(
                bou.ports[1], cheVal_sec_prod.port_b)
          annotation (Line(points={{108,128},{100,128},{100,80}},
                                                               color={0,127,255}));
            connect(hot_prim, pressureDifference_prim.port_a) annotation (Line(
                  points={{-140,-182},{-140,-168},{4,-168}}, color={0,127,255}));
            connect(pressureDifference_prim.port_b, cold_prim) annotation (Line(
                  points={{24,-168},{140,-168},{140,-180}}, color={0,127,255}));
            connect(
                heat_exchanger.port_a1, m_dot_sens_prim.port_a)
          annotation (Line(points={{30,-4},{-20,-4},{-20,-62}},  color={0,127,255}));
            connect(
                m_dot_sens_prim.port_b, T_sens_prim_hot.port_b)
          annotation (Line(points={{-20,-82},{-20,-100}}, color={0,127,255}));

            connect(
                T_sens_prim_hot.T, states[1]);
            connect(
                T_sens_prim_cold.T, states[2]);
            connect(
                 T_sens_sec_hot.T, states[3]);
            connect(
                T_sens_sec_cold.T, states[4]);
            connect(
                conversion.V_dot_prim_is, states[5]);
            connect(
                conversion.V_dot_sec_is, states[6]);
            connect(pressureDifference_prim.p_rel, states[8]);

            T_prim_hot = T_sens_prim_hot.T;
            T_prim_cold = T_sens_prim_cold.T;
            V_dot_prim = conversion.V_dot_prim_is;
            V_dot_sec = conversion.V_dot_sec_is;
            Q_dot_is = states[7];
            Delta_p_prim =pressureDifference_prim.p_rel;

            connect(
                pipe_prim_hot.port_b, T_sens_prim_hot.port_a)
          annotation (Line(points={{-20,-128},{-20,-120}}, color={0,127,255}));
            connect(
                pipe_prim_hot.port_a, hot_prim) annotation (Line(points={{-20,-148},{-20,-154},
                {-140,-154},{-140,-182}}, color={0,127,255}));
            connect(
                T_sens_prim_cold.port_b, pipe_prim_cold.port_a)
          annotation (Line(points={{80,-120},{80,-130}}, color={0,127,255}));
            connect(
                pipe_prim_cold.port_b, cold_prim) annotation (Line(points={{80,-150},{80,-166},
                {140,-166},{140,-180}}, color={0,127,255}));
            connect(pump_sec_prod.port_a, heat_exchanger.port_a2)
              annotation (Line(points={{100,18},{100,8},{50,8}}, color={0,127,255}));
            connect(pump_sec_prod.port_b, cheVal_sec_prod.port_a)
              annotation (Line(points={{100,38},{100,60}}, color={0,127,255}));
            connect(conversion.u_set_sec_cons, contr_vars_real[1]) annotation (Line(
                  points={{-99.04,57.8333},{-134,57.8333},{-134,-8.33333},{-202,
                    -8.33333}},
                  color={0,0,127}));
            connect(conversion.u_set_sec_prod, contr_vars_real[2]) annotation (Line(
                  points={{-99.04,50.0556},{-134,50.0556},{-134,-5},{-202,-5}}, color={0,0,
                    127}));
            connect(conversion.pump_y2, pump_sec_cons.y) annotation (Line(points={{-50.08,
                    57.4444},{38,57.4444},{38,74},{72,74}},        color={0,0,127}));
            connect(conversion.pump_y1, pump_sec_prod.y) annotation (Line(points={{-50.56,
                    62.1111},{2,62.1111},{2,56},{80,56},{80,28},{88,28}},
                  color={0,0,127}));
            connect(pump_sec_cons.port_b, cheVa_sec_cons.port_a)
              annotation (Line(points={{60,64},{60,52}}, color={0,127,255}));
            connect(T_sens_sec_cold.port_b, pump_sec_cons.port_a) annotation (Line(
                  points={{52,96},{52,90},{60,90},{60,84}}, color={0,127,255}));
            connect(T_sens_sec_cold.port_b, cheVal_sec_prod.port_b) annotation (Line(
                  points={{52,96},{52,90},{100,90},{100,80}}, color={0,127,255}));
            connect(massFlowRate.port_a, T_sens_sec_hot.port_a) annotation (Line(
                  points={{-14,126},{-14,136},{-40,136},{-40,142}}, color={0,127,255}));
            connect(massFlowRate.port_b, heat_exchanger.port_b2) annotation (Line(
                  points={{-14,106},{-14,8},{30,8}}, color={0,127,255}));
            connect(massFlowRate.m_flow, conversion.m_dot_sec_is) annotation (Line(
                  points={{-25,116},{-30,116},{-30,50.8333},{-52,50.8333}}, color={0,
                    0,127}));
            connect(T_sens_sec_cold.port_a, port_a1) annotation (Line(points={{52,116},
                    {72,116},{72,170},{92,170}}, color={0,127,255}));
            connect(T_sens_sec_hot.port_b, port_b1) annotation (Line(points={{-40,162},
                    {-66,162},{-66,170},{-90,170}}, color={0,127,255}));
            connect(pump_prim_prod.port_a, T_sens_prim_cold.port_a) annotation
              (Line(points={{100,-84},{100,-86},{80,-86},{80,-100}}, color={0,
                    127,255}));
            connect(pump_prim_prod.port_b, cheVal_prim_prod.port_a) annotation
              (Line(points={{100,-64},{100,-50}}, color={0,127,255}));
            connect(conversion.pump_contr_mflow, pump_prim_prod.m_flow_in)
              annotation (Line(points={{-52,19.3333},{84,19.3333},{84,-66},{80,
                    -66},{80,-74},{88,-74}}, color={0,0,127}));
            connect(pressureDifference_sec.port_a, port_a1) annotation (Line(
                  points={{36,150},{54,150},{54,148},{72,148},{72,170},{92,170}},
                  color={0,127,255}));
            connect(pressureDifference_sec.port_b, T_sens_sec_hot.port_b)
              annotation (Line(points={{16,150},{-24,150},{-24,168},{-40,168},{
                    -40,162}}, color={0,127,255}));
            annotation (Diagram(coordinateSystem(extent={{-200,-180},{200,180}})), Icon(
              coordinateSystem(extent={{-200,-180},{200,180}}), graphics={
              Line(
                points={{-140,-98},{-140,-170}},
                color={238,46,47},
                thickness=0.5),
              Line(
                points={{138,-100},{138,-168}},
                color={28,108,200},
                thickness=0.5),
              Rectangle(
                extent={{-38,30},{48,-48}},
                lineColor={0,0,0},
                lineThickness=1),
              Bitmap(extent={{-106,88},{108,176}}, fileName=
                    "modelica://ProsNet/../../../../Downloads/noun-home-121812.svg"),
              Line(
                points={{32,86},{32,28}},
                color={28,108,200},
                thickness=0.5),
              Line(
                points={{-22,86},{-22,28}},
                color={238,46,47},
                thickness=0.5),
              Line(
                points={{138,-100},{38,-100}},
                color={28,108,200},
                thickness=0.5),
              Line(
                points={{-142,-100},{-24,-100}},
                color={238,46,47},
                thickness=0.5),
              Line(
                points={{-24,-52},{-24,-102}},
                color={238,46,47},
                thickness=0.5),
              Line(
                points={{36,-50},{36,-102}},
                color={28,108,200},
                thickness=0.5),
              Rectangle(extent={{-200,180},{200,-180}}, lineColor={0,0,0})}));
          end HTS_idealNetwork;

          model Conversion

          package Medium = Modelica.Media.Water.ConstantPropertyLiquidWater;

            Modelica.Blocks.Sources.Constant factor1(k=(1/60000)*Medium.d_const)
              annotation (Placement(transformation(extent={{-52,40},{-32,60}})));
            Modelica.Blocks.Math.Product volume2mass_flow
              annotation (Placement(transformation(extent={{-10,22},{10,42}})));
            Controls.SecondaryFlowControl secFlowCon
              annotation (Placement(transformation(extent={{30,4},{50,24}})));
            Controls.PrimaryFlowControl priFlowCon
              annotation (Placement(transformation(extent={{-8,-26},{12,-46}})));
            Controls.Linearizer         lin(redeclare final
                Controls.Data.Linearizer.EqualPercentage cha)
             annotation (Placement(transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=0,
                  origin={-30,-70})));
            Modelica.Blocks.Interfaces.RealInput pi "{0;1}"
              annotation (Placement(transformation(extent={{-120,-20},{-80,20}})));
            Modelica.Blocks.Interfaces.RealInput mu "{-1;0;1}"
              annotation (Placement(transformation(extent={{-120,-62},{-80,-22}})));
            Modelica.Blocks.Interfaces.RealInput u_set_prim_cons "[0;1]"
              annotation (Placement(transformation(extent={{-120,-140},{-80,-100}})));
            Modelica.Blocks.Interfaces.RealInput u_set_prim_prod "[0;1]"
              annotation (Placement(transformation(extent={{-120,-100},{-80,-60}})));
            Modelica.Blocks.Interfaces.RealOutput pump_contr_mflow "[0;2]"
              annotation (Placement(transformation(extent={{90,-50},{110,-30}})));
            Modelica.Blocks.Interfaces.RealOutput valve_contr "[0;1]"
              annotation (Placement(transformation(extent={{90,-76},{110,-56}})));
            Modelica.Blocks.Interfaces.RealInput m_dot_prim_is "kg/s"
              annotation (Placement(transformation(extent={{120,-140},{80,-100}})));
            Modelica.Blocks.Interfaces.RealOutput V_dot_prim_is annotation (Placement(
                  transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=-90,
                  origin={0,-160})));
            Modelica.Blocks.Math.Product mass2volume_flow1
              annotation (Placement(transformation(extent={{48,-132},{28,-112}})));
            Modelica.Blocks.Sources.Constant factor3(k=(60000)*(1/Medium.d_const))
              annotation (Placement(transformation(extent={{82,-108},{62,-88}})));
            Modelica.Blocks.Math.RealToInteger realToInteger
              annotation (Placement(transformation(extent={{-72,-10},{-52,10}})));
            Modelica.Blocks.Math.RealToInteger realToInteger1
              annotation (Placement(transformation(extent={{-72,-52},{-52,-32}})));
            Controls.PrimaryFlowControl priFlowCon1
              annotation (Placement(transformation(extent={{-32,246},{-12,226}})));
            Modelica.Blocks.Interfaces.RealInput u_set_sec_cons "[0;1]" annotation (
                Placement(transformation(extent={{-116,138},{-76,178}}),
                  iconTransformation(extent={{-116,138},{-76,178}})));
            Modelica.Blocks.Interfaces.RealInput u_set_sec_prod "[0;1]" annotation (
                Placement(transformation(extent={{-116,98},{-76,138}}),
                  iconTransformation(extent={{-116,98},{-76,138}})));
            Modelica.Blocks.Interfaces.RealOutput pump_y1
              "0-1 voltage for production pump"
              annotation (Placement(transformation(extent={{96,170},{116,190}}),
                  iconTransformation(extent={{96,170},{116,190}})));
            Modelica.Blocks.Interfaces.RealOutput pump_y2
              "0-1 voltage for consumption pump"
              annotation (Placement(transformation(extent={{98,146},{118,166}}),
                  iconTransformation(extent={{98,146},{118,166}})));
            Modelica.Blocks.Math.Product mass2volume_flow
              annotation (Placement(transformation(extent={{26,76},{6,96}})));
            Modelica.Blocks.Sources.Constant factor2(k=(60000)*(1/Medium.d_const))
              annotation (Placement(transformation(extent={{60,64},{40,84}})));
            Modelica.Blocks.Interfaces.RealInput m_dot_sec_is "kg/s"
              annotation (Placement(transformation(extent={{120,102},{80,142}})));
            Modelica.Blocks.Interfaces.RealOutput V_dot_sec_is annotation (Placement(
                  transformation(
                  extent={{-10,-10},{10,10}},
                  rotation=90,
                  origin={44,270}), iconTransformation(
                  extent={{-10,-10},{10,10}},
                  rotation=90,
                  origin={2,190})));
          equation
            connect(factor1.y, volume2mass_flow.u1) annotation (Line(points={{-31,50},{-18,
                    50},{-18,38},{-12,38}}, color={0,0,127}));
            connect(volume2mass_flow.y, secFlowCon.m_flow_set)
              annotation (Line(points={{11,32},{40,32},{40,26}}, color={0,0,127}));
            connect(priFlowCon.pump_y, pump_contr_mflow) annotation (Line(
                  points={{13,-30.9},{84,-30.9},{84,-40},{100,-40}}, color={0,0,
                    127}));
            connect(priFlowCon.valve_op, valve_contr) annotation (Line(points={{13,
                    -41.1},{84,-41.1},{84,-66},{100,-66}},
                                                    color={0,0,127}));
            connect(lin.op, priFlowCon.valve_op_set)
              annotation (Line(points={{-19,-70},{6,-70},{6,-48}}, color={0,0,127}));
            connect(u_set_prim_cons, lin.kappa) annotation (Line(points={{-100,-120},{-52,-120},
                    {-52,-70},{-42,-70}}, color={0,0,127}));
            connect(u_set_prim_prod, priFlowCon.pump_y_set) annotation (Line(points={{-100,
                    -80},{-54,-80},{-54,-54},{-10,-54},{-10,-56},{-2,-56},{-2,-48}},
                  color={0,0,127}));
            connect(factor3.y, mass2volume_flow1.u1) annotation (Line(points={{61,-98},
                    {60,-98},{60,-116},{50,-116}},
                                               color={0,0,127}));
            connect(m_dot_prim_is, mass2volume_flow1.u2) annotation (Line(points={{100,
                    -120},{58,-120},{58,-128},{50,-128}},
                                                    color={0,0,127}));
            connect(mass2volume_flow1.y, V_dot_prim_is)
              annotation (Line(points={{27,-122},{0,-122},{0,-160}}, color={0,0,127}));
            connect(realToInteger.y, secFlowCon.pi)
              annotation (Line(points={{-51,0},{20,0},{20,8},{28,8}}, color={255,127,0}));
            connect(realToInteger.y, priFlowCon.pi)
              annotation (Line(points={{-51,0},{-28,0},{-28,-30},{-10,-30}}, color={255,127,0}));
            connect(realToInteger.u, pi)
              annotation (Line(points={{-74,0},{-100,0}}, color={0,0,127}));
            connect(mu, realToInteger1.u)
              annotation (Line(points={{-100,-42},{-74,-42}}, color={0,0,127}));
            connect(realToInteger1.y, priFlowCon.mu)
              annotation (Line(points={{-51,-42},{-10,-42}}, color={255,127,0}));
            connect(realToInteger1.y, secFlowCon.mu) annotation (Line(points={{-51,-42},{-32,-42},
                    {-32,14},{2,14},{2,20},{28,20}}, color={255,127,0}));
            connect(realToInteger.y, priFlowCon1.pi) annotation (Line(points={{-51,0},
                    {-26,0},{-26,150},{-44,150},{-44,242},{-34,242}}, color={255,127,
                    0}));
            connect(priFlowCon.mu, priFlowCon1.mu) annotation (Line(points={{-10,-42},
                    {-36,-42},{-36,0},{-24,0},{-24,216},{-40,216},{-40,222},{-42,222},
                    {-42,230},{-34,230}}, color={255,127,0}));
            connect(u_set_sec_cons, priFlowCon1.pump_y_set) annotation (Line(points={
                    {-96,158},{-42,158},{-42,214},{-26,214},{-26,224}}, color={0,0,
                    127}));
            connect(u_set_sec_prod, priFlowCon1.valve_op_set) annotation (Line(points
                  ={{-96,118},{-18,118},{-18,224}}, color={0,0,127}));
            connect(priFlowCon1.pump_y, pump_y1) annotation (Line(points={{-11,241.1},
                    {12.5,241.1},{12.5,180},{106,180}},color={0,0,127}));
            connect(priFlowCon1.valve_op, pump_y2) annotation (Line(points={{-11,
                    230.9},{18,230.9},{18,156},{108,156}},color={0,0,127}));
            connect(u_set_sec_prod, volume2mass_flow.u2) annotation (Line(points={{-96,
                    118},{-22,118},{-22,26},{-12,26}}, color={0,0,127}));
            connect(factor2.y,mass2volume_flow. u2) annotation (Line(points={{39,74},
                    {28,74},{28,80}}, color={0,0,127}));
            connect(m_dot_sec_is,mass2volume_flow. u1) annotation (Line(points={{100,122},
                    {38,122},{38,92},{28,92}}, color={0,0,127}));
            connect(mass2volume_flow.y, V_dot_sec_is) annotation (Line(points={{5,86},{
                    0,86},{0,250},{44,250},{44,270}},  color={0,0,127}));
            annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,
                      -160},{100,200}}),
                                   graphics={Rectangle(
                    extent={{-100,180},{100,-160}},
                    lineColor={28,108,200},
                    fillColor={171,171,171},
                    fillPattern=FillPattern.Solid), Text(
                    extent={{-137,35},{137,-35}},
                    textColor={0,0,0},
                    origin={-1,1},
                    rotation=90,
                    textString="Conversion",
                    textStyle={TextStyle.Bold})}),
                                    Diagram(coordinateSystem(preserveAspectRatio=false,
                    extent={{-100,-160},{100,200}})));
          end Conversion;

          package Validation

            model Test_heat_transfer_station_production
              ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.New_Substation_IdealNet.HTS_idealNetwork
                B1(
                n=0.5,
                redeclare
                  ProsNet.Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180
                  feedinPer,
                R_ins_transferpipe=100000) annotation (Placement(transformation(
                    extent={{20,-18},{-20,18}},
                    rotation=0,
                    origin={-18,-54})));
              Modelica.Blocks.Math.Add add annotation (Placement(transformation(
                    extent={{-5,-5},{5,5}},
                    rotation=-90,
                    origin={-1,41})));
              Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (
                  Placement(transformation(
                    extent={{-5,-6},{5,6}},
                    rotation=270,
                    origin={22,55})));
              ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                power_set1(table=[0,4; 3600,-4; 7200,10; 10800,-10; 14400,-6;
                    18000,6; 21600,10; 25200,10]) annotation (Placement(
                    transformation(
                    extent={{-10,-10},{10,10}},
                    rotation=-90,
                    origin={-36,76})));
              ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                temp_sec_in1(table=[0,55; 3600,30; 7200,55; 10800,30; 14400,30;
                    18000,55; 21600,55; 25200,55]) annotation (Placement(
                    transformation(
                    extent={{-10,-10},{10,10}},
                    rotation=-90,
                    origin={6,76})));
              Modelica.Blocks.Sources.Ramp ramp(
                height=1,
                duration=600,
                offset=0,
                startTime=200)
                annotation (Placement(transformation(extent={{-70,-144},{-50,-124}})));
              Modelica.Fluid.Vessels.ClosedVolume volume(
                T_start=318.15,
                use_portsData=false,
                V=1,
                nPorts=2,
                redeclare final package Medium = ProsNet.Media.Water)
                annotation (Placement(transformation(extent={{24,-136},{44,-156}})));
              ProsNet.Fluid.Valves.TwoWayEqualPercentage
                                                 valve_for_test(
                m_flow_nominal=30.074213*0.001/60,
                redeclare final package Medium = ProsNet.Media.Water,
                final CvData=ProsNet.Fluid.Types.CvTypes.Kv,
                final Kv=2.5,
                final use_inputFilter=true,
                final riseTime=5,
                final init=Modelica.Blocks.Types.Init.InitialOutput,
                final y_start=0,
                final l=2e-3) annotation (Placement(transformation(
                    extent={{10,10},{-10,-10}},
                    rotation=-90,
                    origin={58,-116})));
              ProsNet.Fluid.Sources.Boundary_pT
                                        bou(nPorts=1, redeclare final package
                  Medium =
                    ProsNet.Media.Water)
                annotation (Placement(transformation(extent={{128,-110},{108,-90}})));
              Controller_PID_based.PID_Q_T_weighted_crossover_new
                pID_Q_T_weighted_crossover_new annotation (Placement(
                    transformation(extent={{-30,-18},{-6,16}})));
              Prosumers.SF1_HouseNew sF1_HouseNew
                annotation (Placement(transformation(extent={{-102,-46},{-84,-32}})));
            equation
              connect(add.u1,realExpression. y) annotation (Line(points={{2,47},{2,49.5},
                      {22,49.5}},                color={0,0,127}));
              connect(temp_sec_in1.y,add. u2) annotation (Line(points={{6,65},{6,47},{
                      -4,47}},         color={0,0,127}));
              connect(valve_for_test.port_a,volume. ports[1])
                annotation (Line(points={{58,-126},{58,-128},{33,-128},{33,-136}},
                                                                      color={0,127,255}));
              connect(ramp.y,valve_for_test. y) annotation (Line(points={{-49,-134},{
                      20,-134},{20,-116},{46,-116}},
                                      color={0,0,127}));
              connect(bou.ports[1],valve_for_test. port_b)
                annotation (Line(points={{108,-100},{58,-100},{58,-106}},
                                                                  color={0,127,255}));
              connect(B1.hot_prim, valve_for_test.port_b) annotation (Line(points={{-4,
                      -72.2},{-4,-100},{58,-100},{58,-106}}, color={0,127,255}));
              connect(B1.cold_prim, volume.ports[2]) annotation (Line(points={{-32,-72},
                      {-32,-130},{35,-130},{35,-136}}, color={0,127,255}));
              connect(power_set1.y, pID_Q_T_weighted_crossover_new.Q_dot_set)
                annotation (Line(points={{-36,65},{-36,26},{-24,26},{-24,16.8}},
                    color={0,0,127}));
              connect(add.y, pID_Q_T_weighted_crossover_new.T_sec_in_is)
                annotation (Line(points={{-1,35.5},{-2,35.5},{-2,26},{-12,26},{
                      -12,17}}, color={0,0,127}));
              connect(B1.contr_vars_real, pID_Q_T_weighted_crossover_new.contr_vars_real)
                annotation (Line(points={{2.2,-54},{10,-54},{10,-2},{-6,-2}},
                    color={0,0,127}));
              connect(B1.states, pID_Q_T_weighted_crossover_new.states)
                annotation (Line(points={{-38,-54},{-46,-54},{-46,-2},{-30,-2}},
                    color={0,0,127}));
              connect(B1.port_a1, sF1_HouseNew.port_a1) annotation (Line(points={{-27.2,
                      -37},{-27.2,-26},{-98,-26},{-98,-31.4806},{-97.1357,-31.4806}},
                                  color={0,127,255}));
              connect(B1.port_b1, sF1_HouseNew.port_b1) annotation (Line(points={{-9,-37},
                      {-10,-37},{-10,-28},{-88.8643,-28},{-88.8643,-31.5484}},
                    color={0,127,255}));
              annotation (Diagram(graphics={                               Rectangle(extent={{-62,92},
                          {28,-82}},      lineColor={28,108,200})}));
            end Test_heat_transfer_station_production;

            model Test_heat_transfer_station_Consumption
              ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.New_Substation_IdealNet.HTS_idealNetwork
                B2(
                n=0.5,
                redeclare
                  ProsNet.Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180
                  feedinPer,
                R_ins_transferpipe=100000) annotation (Placement(transformation(
                    extent={{20,-18},{-20,18}},
                    rotation=0,
                    origin={-8,-54})));
              Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
                  Placement(transformation(
                    extent={{-5,-6},{5,6}},
                    rotation=270,
                    origin={24,53})));
              Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
                    extent={{-5,-5},{5,5}},
                    rotation=-90,
                    origin={1,39})));
              ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                power_set2(table=[0,-10; 3600,10; 7200,-4; 10800,4; 14400,10;
                    18000,-10; 21600,-4; 25200,-4]) annotation (Placement(
                    transformation(
                    extent={{-10,-10},{10,10}},
                    rotation=-90,
                    origin={-26,76})));
              ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                temp_sec_in2(table=[0,30; 3600,55; 7200,30; 10800,55; 14400,55;
                    18000,30; 21600,30; 25200,30]) annotation (Placement(
                    transformation(
                    extent={{-10,-10},{10,10}},
                    rotation=-90,
                    origin={16,76})));
              Modelica.Blocks.Sources.Ramp ramp(
                height=1,
                duration=600,
                offset=0,
                startTime=200)
                annotation (Placement(transformation(extent={{-90,-178},{-70,-158}})));
              Modelica.Fluid.Vessels.ClosedVolume volume(
                T_start=338.15,
                use_portsData=false,
                V=1,
                nPorts=2,
                redeclare final package Medium = ProsNet.Media.Water)
                annotation (Placement(transformation(extent={{4,-176},{24,-196}})));
              ProsNet.Fluid.Sources.Boundary_pT
                                        bou(redeclare final package Medium =
                    ProsNet.Media.Water, nPorts=1)
                annotation (Placement(transformation(extent={{108,-142},{88,-122}})));
              ProsNet.Fluid.Pumps.SpeedControlled_y
                                            pump_prim_prod(
                redeclare final package Medium = ProsNet.Media.Water,
                final energyDynamics=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial,
                final tau=1,
                redeclare final ProsNet.Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40
                  per,
                final use_inputFilter=true,
                final riseTime=5,
                final init=Modelica.Blocks.Types.Init.InitialOutput,
                final y_start=0)                annotation (Placement(transformation(
                    extent={{10,10},{-10,-10}},
                    rotation=-90,
                    origin={42,-144})));
              Controller_PID_based.PID_Q_T_weighted_crossover_new
                pID_Q_T_weighted_crossover_new(alpha_sec_cons=1) annotation (
                  Placement(transformation(extent={{-10,-16},{14,18}})));
              Prosumers.SF1_HouseNew sF1_HouseNew
                annotation (Placement(transformation(extent={{-150,-88},{-66,-26}})));
            equation
              connect(realExpression1.y,add1. u1) annotation (Line(points={{24,47.5},{
                      24,45},{4,45}},             color={0,0,127}));
              connect(temp_sec_in2.y,add1. u2)
                annotation (Line(points={{16,65},{16,64},{-2,64},{-2,45}},
                                                                      color={0,0,127}));
              connect(volume.ports[1],pump_prim_prod. port_a) annotation (Line(points={{13,-176},
                      {13,-160},{42,-160},{42,-154}},      color={0,127,255}));
              connect(ramp.y,pump_prim_prod. y) annotation (Line(points={{-69,-168},{20,
                      -168},{20,-144},{30,-144}},
                                      color={0,0,127}));
              connect(B2.cold_prim, volume.ports[2]) annotation (Line(points={{-22,-72},
                      {-22,-166},{15,-166},{15,-176}}, color={0,127,255}));
              connect(pump_prim_prod.port_b, B2.hot_prim) annotation (Line(points={{42,
                      -134},{42,-78},{6,-78},{6,-72.2}}, color={0,127,255}));
              connect(pump_prim_prod.port_b, bou.ports[1]) annotation (Line(points={{42,
                      -134},{42,-132},{88,-132}}, color={0,127,255}));
              connect(pID_Q_T_weighted_crossover_new.Q_dot_set, power_set2.y)
                annotation (Line(points={{-4,18.8},{-4,30},{-26,30},{-26,65}},
                    color={0,0,127}));
              connect(pID_Q_T_weighted_crossover_new.T_sec_in_is, add1.y)
                annotation (Line(points={{8,19},{1,19},{1,33.5}}, color={0,0,127}));
              connect(pID_Q_T_weighted_crossover_new.states, B2.states)
                annotation (Line(points={{-10,0},{-38,0},{-38,-54},{-28,-54}},
                    color={0,0,127}));
              connect(pID_Q_T_weighted_crossover_new.contr_vars_real, B2.contr_vars_real)
                annotation (Line(points={{14,0},{22,0},{22,-54},{12.2,-54}},
                    color={0,0,127}));
              connect(B2.port_a1, sF1_HouseNew.port_a1) annotation (Line(points={{
                      -17.2,-37},{-17.2,-30},{-60,-30},{-60,-10},{-127.3,-10},{-127.3,
                      -23.7}}, color={0,127,255}));
              connect(B2.port_b1, sF1_HouseNew.port_b1) annotation (Line(points={{1,
                      -37},{1,-26},{-62,-26},{-62,-14},{-76,-14},{-76,-12},{-88.7,-12},
                      {-88.7,-24}}, color={0,127,255}));
              annotation (Diagram(graphics={                               Rectangle(extent={{-52,92},
                          {38,-82}},      lineColor={28,108,200})}));
            end Test_heat_transfer_station_Consumption;

            model Test_Conversion
              Conversion conversion
                annotation (Placement(transformation(extent={{-6,-2},{14,32}})));
              Modelica.Blocks.Sources.RealExpression T_sec_in(y=65)
                annotation (Placement(transformation(extent={{-86,38},{-66,58}})));
              Modelica.Blocks.Sources.IntegerExpression pi(y=0)
                annotation (Placement(transformation(extent={{-86,-2},{-66,18}})));
              Modelica.Blocks.Sources.RealExpression V_dot_sec_set(y=5)
                annotation (Placement(transformation(extent={{-86,18},{-66,38}})));
              Modelica.Blocks.Sources.IntegerExpression mu(y=-1)
                annotation (Placement(transformation(extent={{-86,-24},{-66,-4}})));
              Modelica.Blocks.Sources.RealExpression u_set(y=0.5)
                annotation (Placement(transformation(extent={{-86,-48},{-66,-28}})));
              Modelica.Blocks.Sources.RealExpression kappa_set(y=0.8)
                annotation (Placement(transformation(extent={{-86,-66},{-66,-46}})));
              Modelica.Blocks.Sources.RealExpression m_dot_sec_is(y=0.2)
                annotation (Placement(transformation(extent={{76,16},{56,36}})));
              Modelica.Blocks.Sources.RealExpression m_dot_prim_is(y=0.02)
                annotation (Placement(transformation(extent={{76,-10},{56,10}})));
            equation
              connect(kappa_set.y, conversion.kappa_set) annotation (Line(points={{-65,-56},
                      {-12,-56},{-12,1.77778},{-6,1.77778}},
                                                      color={0,0,127}));
              connect(u_set.y, conversion.u_set_prim) annotation (Line(points={{-65,-38},
                      {-14,-38},{-14,5.55556},{-6,5.55556}},
                                                 color={0,0,127}));
              connect(mu.y, conversion.mu) annotation (Line(points={{-65,-14},{-16,
                      -14},{-16,9.14444},{-6,9.14444}},
                                          color={255,127,0}));
              connect(pi.y, conversion.pi) annotation (Line(points={{-65,8},{-18,8},{
                      -18,13.1111},{-6,13.1111}},
                                    color={255,127,0}));
              connect(V_dot_sec_set.y, conversion.V_dot_sec_set) annotation (Line(points=
                      {{-65,28},{-14,28},{-14,24},{-6,24}}, color={0,0,127}));
              connect(T_sec_in.y, conversion.T_sec_in_set) annotation (Line(points={{-65,
                      48},{-12,48},{-12,28},{-6,28}}, color={0,0,127}));
              connect(conversion.m_dot_sec_is, m_dot_sec_is.y)
                annotation (Line(points={{14,25.2},{34,25.2},{34,26},{55,26}},
                                                           color={0,0,127}));
              connect(conversion.m_dot_prim_is, m_dot_prim_is.y)
                annotation (Line(points={{14,1.77778},{50,1.77778},{50,0},{55,0}},
                                                                       color={0,0,127}));
              annotation (Icon(coordinateSystem(preserveAspectRatio=false), graphics={
                    Ellipse(lineColor = {75,138,73},
                            fillColor={255,255,255},
                            fillPattern = FillPattern.Solid,
                            extent={{-100,-100},{100,100}}),
                    Polygon(lineColor = {0,0,255},
                            fillColor = {75,138,73},
                            pattern = LinePattern.None,
                            fillPattern = FillPattern.Solid,
                            points={{-36,60},{64,0},{-36,-60},{-36,60}})}),  Diagram(
                    coordinateSystem(preserveAspectRatio=false)));
            end Test_Conversion;

            package Test_Validation

              package components "Testing the new models and especially controllers"

                model Test_heat_exchanger

                  replaceable package Medium1 = ProsNet.Media.Water;
                  replaceable package Medium2 = ProsNet.Media.Water;

                  extends ProsNet.Prosumers.BaseClasses.PrimarySideParameters;
                  extends
                    ProsNet.Prosumers.SecondarySides.BaseClasses.PumpsPairDynParam;
                  extends
                    ProsNet.Prosumers.SecondarySides.BaseClasses.ControlVolumeDynParam;

                  inner Modelica.Fluid.System system
                    annotation (Placement(transformation(extent={{-30,54},{-10,74}})));
                  Modelica.Fluid.Sources.MassFlowSource_T boundary(
                    redeclare package Medium = Media.Water,
                    m_flow=0.1,
                    T=333.15,
                    nPorts=1) annotation (Placement(transformation(extent={{-84,14},{-64,34}})));
                  Modelica.Fluid.Sources.FixedBoundary boundary1(redeclare
                      package Medium =
                        Media.Water, nPorts=1)
                    annotation (Placement(transformation(extent={{-88,-90},{-68,-70}})));
                  Modelica.Fluid.Sources.MassFlowSource_T boundary2(
                    redeclare package Medium = Media.Water,
                    use_m_flow_in=true,
                    m_flow=1,
                    T=313.15,
                    nPorts=1) annotation (Placement(transformation(extent={{70,-34},{50,-14}})));
                  Modelica.Fluid.Sources.FixedBoundary boundary3(redeclare
                      package Medium =
                        Media.Water, nPorts=1)
                    annotation (Placement(transformation(extent={{52,44},{32,64}})));
                  Modelica.Blocks.Sources.Ramp ramp(
                    height=0.1,
                    duration=900,
                    offset=0.1,
                    startTime=900)
                    annotation (Placement(transformation(extent={{50,-70},{70,-50}})));

                  Fluid.HeatExchangers.LiquidToLiquid liquidToLiquid(
                    redeclare package Medium1 = Medium1,
                    redeclare package Medium2 = Medium2,
                    m1_flow_nominal=1,
                    m2_flow_nominal=1,
                    dp1_nominal(displayUnit="bar") = 100000,
                    dp2_nominal(displayUnit="bar") = 100000,
                    use_Q_flow_nominal=true,
                    Q_flow_nominal(displayUnit="kW") = 30000,
                    T_a1_nominal=313.15,
                    T_a2_nominal=333.15,
                    eps_nominal=1)
                    annotation (Placement(transformation(extent={{-24,-18},{-4,2}})));
                  Fluid.Sensors.Temperature senTem2(redeclare package Medium = Medium1)
                    annotation (Placement(transformation(extent={{46,12},{66,32}})));
                  Fluid.Sensors.Temperature senTem1(redeclare package Medium = Medium2)
                    annotation (Placement(transformation(extent={{-46,-70},{-26,-50}})));

                  Real DeltaT1;
                  Real DeltaT2;
                equation
                  connect(ramp.y, boundary2.m_flow_in) annotation (Line(points={{71,-60},{76,-60},{76,
                          -16},{70,-16}},   color={0,0,127}));

                  DeltaT2 =senTem2.T - liquidToLiquid.T_in2;
                  DeltaT1 = senTem1.T - liquidToLiquid.T_in1;

                  connect(boundary.ports[1], liquidToLiquid.port_a1)
                    annotation (Line(points={{-64,24},{-62,24},{-62,-2},{-24,-2}}, color={0,127,255}));
                  connect(boundary1.ports[1], liquidToLiquid.port_b2) annotation (Line(points={{-68,-80},
                          {-50,-80},{-50,-54},{-48,-54},{-48,-14},{-24,-14}}, color={0,127,255}));
                  connect(liquidToLiquid.port_a2, boundary2.ports[1]) annotation (Line(points={{-4,-14},
                          {2,-14},{2,-18},{0,-18},{0,-24},{50,-24}}, color={0,127,255}));
                  connect(liquidToLiquid.port_b1, boundary3.ports[1])
                    annotation (Line(points={{-4,-2},{26,-2},{26,54},{32,54}}, color={0,127,255}));
                  connect(senTem1.port, liquidToLiquid.port_b2) annotation (Line(points={{-36,-70},{-36,
                          -74},{-50,-74},{-50,-54},{-48,-54},{-48,-14},{-24,-14}}, color={0,127,255}));
                  connect(senTem2.port, liquidToLiquid.port_b1)
                    annotation (Line(points={{56,12},{56,-2},{-4,-2}}, color={0,127,255}));
                  annotation (Icon(coordinateSystem(preserveAspectRatio=false)), Diagram(
                        coordinateSystem(preserveAspectRatio=false), graphics={Line(
                          points={{10,-34},{10,12}},
                          color={0,255,0},
                          thickness=1), Line(
                          points={{10,10},{14,4}},
                          color={0,255,0},
                          thickness=1)}),
                    experiment(
                      StopTime=2100,
                      Interval=1,
                      __Dymola_Algorithm="Dassl"));
                end Test_heat_exchanger;

                model Test_pipe_model
                  Modelica.Fluid.Sensors.VolumeFlowRate volumeFlowRate(redeclare
                      package Medium =
                        ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{-20,32},{0,52}})));
                  Modelica.Fluid.Sensors.RelativePressure relativePressure(redeclare
                      package Medium =
                               ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{20,64},{40,84}})));
                  Modelica.Fluid.Sensors.RelativeTemperature relativeTemperature(redeclare
                      package Medium = ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{20,4},{40,-16}})));
                  Modelica.Fluid.Sources.MassFlowSource_T mass_source(
                    redeclare package Medium = ProsNet.Media.Water,
                    use_m_flow_in=true,
                    use_T_in=true,
                    m_flow=1,
                    T(displayUnit="K"),
                    nPorts=1) annotation (Placement(transformation(extent={{-94,32},{-74,52}})));
                  inner Modelica.Fluid.System system(
                    T_ambient=285.15,
                    allowFlowReversal=true,
                    energyDynamics=Modelica.Fluid.Types.Dynamics.SteadyStateInitial)
                    annotation (Placement(transformation(extent={{132,76},{152,96}})));
                  Modelica.Fluid.Sources.Boundary_pT bou(redeclare package
                      Medium =
                        ProsNet.Media.Water, nPorts=1)
                    annotation (Placement(transformation(extent={{104,32},{84,52}})));
                  ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                    volume_flow(table=[0,1; 10,5; 20,10; 30,11.4; 40,15; 50,20;
                        60,1; 70,5; 80,10; 90,11.4; 100,15; 110,20; 120,1; 130,
                        5; 140,10; 150,11.4; 160,15; 170,20; 7470,20; 7480,0;
                        10980,20; 17580,20], timeScale=1) annotation (Placement(
                        transformation(extent={{-182,50},{-162,70}})));
                  ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                    temperatures(
                    table=[0,30; 10,30; 20,30; 30,30; 40,30; 50,30; 60,60; 70,
                        60; 80,60; 90,60; 100,60; 110,60; 120,90; 130,90; 140,
                        90; 150,90; 160,90; 170,90; 180,90; 7480,90; 10980,90;
                        17580,90],
                    timeScale=1,
                    y(unit="K")) annotation (Placement(transformation(extent={{
                            -182,16},{-162,36}})));
                  Modelica.Blocks.Math.Gain gain(k=1/60.266)
                    annotation (Placement(transformation(extent={{-138,50},{-118,70}})));
                  Modelica.Blocks.Math.UnitConversions.From_degC from_degC
                    annotation (Placement(transformation(extent={{-138,16},{-118,36}})));
                  ProsNet.Fluid.Sensors.TemperatureTwoPort Tem_in(
                    redeclare package Medium = ProsNet.Media.Water,
                    m_flow_nominal=1/6,
                    tau=0) annotation (Placement(transformation(extent={{-54,32},{-34,52}})));
                  ProsNet.Fluid.Sensors.TemperatureTwoPort Tem_out(
                    redeclare package Medium = ProsNet.Media.Water,
                    m_flow_nominal=1/6,
                    tau=0) annotation (Placement(transformation(extent={{54,32},{74,52}})));

                  Real DeltaT;
                  Modelica.Fluid.Sensors.VolumeFlowRate volumeFlowRate1(redeclare
                      package Medium =
                               ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{-18,-80},{2,-60}})));
                  Modelica.Fluid.Sensors.RelativePressure relativePressure1(redeclare
                      package Medium =
                               ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{22,-48},{42,-28}})));
                  Modelica.Fluid.Sensors.RelativeTemperature relativeTemperature1(redeclare
                      package Medium = ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{22,-108},{42,-128}})));
                  Modelica.Fluid.Sources.Boundary_pT bou1(redeclare package
                      Medium =
                        ProsNet.Media.Water, nPorts=1)
                    annotation (Placement(transformation(extent={{106,-80},{86,-60}})));
                  ProsNet.Fluid.Sensors.TemperatureTwoPort Tem_in1(
                    redeclare package Medium = ProsNet.Media.Water,
                    m_flow_nominal=1/6,
                    tau=0) annotation (Placement(transformation(extent={{-52,-80},{-32,-60}})));
                  ProsNet.Fluid.Sensors.TemperatureTwoPort Tem_out1(
                    redeclare package Medium = ProsNet.Media.Water,
                    m_flow_nominal=1/6,
                    tau=0) annotation (Placement(transformation(extent={{56,-80},{76,-60}})));
                  ProsNet.Fluid.Pipes.InsulatedPipe_plug pipe_new(
                    allowFlowReversal=true,
                    length=1000,
                    energyDynamics=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial)
                    annotation (Placement(transformation(extent={{18,-80},{38,-60}})));
                  Modelica.Fluid.Sources.MassFlowSource_T mass_source1(
                    redeclare package Medium = ProsNet.Media.Water,
                    use_m_flow_in=true,
                    use_T_in=true,
                    m_flow=1,
                    T(displayUnit="K"),
                    nPorts=1) annotation (Placement(transformation(extent={{-88,-80},{-68,-60}})));
                  ProsNet.Fluid.Pipes.InsulatedPipe pipe(
                    allowFlowReversal=true,
                    length=1000,
                    energyDynamics=Modelica.Fluid.Types.Dynamics.SteadyStateInitial)
                    annotation (Placement(transformation(extent={{18,30},{38,50}})));
                equation
                  connect(volume_flow.y, gain.u) annotation (Line(
                      points={{-161,60},{-161,60},{-142,60},{-140,60}},
                      color={0,0,127},
                      smooth=Smooth.Bezier));
                  connect(temperatures.y, from_degC.u) annotation (Line(
                      points={{-161,26},{-161,26},{-144,26},{-140,26}},
                      color={0,0,127},
                      smooth=Smooth.Bezier));
                  connect(mass_source.ports[1], Tem_in.port_a) annotation (Line(
                      points={{-74,42},{-54,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));
                  connect(Tem_in.port_b, volumeFlowRate.port_a) annotation (Line(
                      points={{-34,42},{-20,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));
                  connect(Tem_out.port_b, bou.ports[1]) annotation (Line(
                      points={{74,42},{84,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));

                  DeltaT = Tem_out.T - Tem_in.T;
                  connect(volumeFlowRate.port_b, relativePressure.port_a) annotation (Line(
                        points={{0,42},{8,42},{8,74},{20,74}}, color={0,127,255}));
                  connect(relativePressure.port_b, Tem_out.port_a) annotation (Line(points={{40,
                          74},{48,74},{48,42},{54,42}}, color={0,127,255}));
                  connect(relativeTemperature.port_b, Tem_out.port_a) annotation (Line(points={
                          {40,-6},{46,-6},{46,42},{54,42}}, color={0,127,255}));
                  connect(relativeTemperature.port_a, volumeFlowRate.port_b) annotation (Line(
                        points={{20,-6},{10,-6},{10,42},{0,42}}, color={0,127,255}));
                  connect(Tem_in1.port_b, volumeFlowRate1.port_a) annotation (Line(
                      points={{-32,-70},{-18,-70}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));
                  connect(Tem_out1.port_b, bou1.ports[1]) annotation (Line(
                      points={{76,-70},{86,-70}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));
                  connect(volumeFlowRate1.port_b, relativePressure1.port_a) annotation (Line(
                        points={{2,-70},{10,-70},{10,-38},{22,-38}}, color={0,127,255}));
                  connect(relativePressure1.port_b, Tem_out1.port_a) annotation (Line(points={{
                          42,-38},{50,-38},{50,-70},{56,-70}}, color={0,127,255}));
                  connect(relativeTemperature1.port_b, Tem_out1.port_a) annotation (Line(points=
                         {{42,-118},{50,-118},{50,-70},{56,-70}}, color={0,127,255}));
                  connect(relativeTemperature1.port_a, volumeFlowRate1.port_b) annotation (Line(
                        points={{22,-118},{10,-118},{10,-70},{2,-70}}, color={0,127,255}));
                  connect(volumeFlowRate1.port_b, pipe_new.port_a)
                    annotation (Line(points={{2,-70},{18,-70}}, color={0,127,255}));
                  connect(pipe_new.port_b, Tem_out1.port_a)
                    annotation (Line(points={{38,-70},{56,-70}}, color={0,127,255}));
                  connect(mass_source1.ports[1], Tem_in1.port_a)
                    annotation (Line(points={{-68,-70},{-52,-70}}, color={0,127,255}));
                  connect(gain.y, mass_source.m_flow_in)
                    annotation (Line(points={{-117,60},{-94,60},{-94,50}}, color={0,0,127}));
                  connect(gain.y, mass_source1.m_flow_in) annotation (Line(points={{-117,60},{
                          -104,60},{-104,-56},{-88,-56},{-88,-62}}, color={0,0,127}));
                  connect(from_degC.y, mass_source.T_in) annotation (Line(points={{-117,26},{
                          -102,26},{-102,46},{-96,46}}, color={0,0,127}));
                  connect(from_degC.y, mass_source1.T_in) annotation (Line(points={{-117,26},{
                          -106,26},{-106,-66},{-90,-66}}, color={0,0,127}));
                  connect(pipe.port_a, relativePressure.port_a) annotation (Line(points={{18,40},
                          {12,40},{12,42},{8,42},{8,74},{20,74}}, color={0,127,255}));
                  connect(pipe.port_b, Tem_out.port_a) annotation (Line(points={{38,40},{42,40},
                          {42,42},{54,42}}, color={0,127,255}));
                  annotation (                                                       experiment(
                      StopTime=17500,
                      Interval=0.1,
                      __Dymola_Algorithm="Dassl"));
                end Test_pipe_model;

                model Test_pump_curve

                  ProsNet.Fluid.Pumps.SpeedControlled_y
                                                pump_prim_prod(
                    redeclare final package Medium = ProsNet.Media.Water,
                    final energyDynamics=Modelica.Fluid.Types.Dynamics.SteadyStateInitial,
                    inputType=ProsNet.Fluid.Types.InputType.Continuous,
                    final tau=1,
                    redeclare final ProsNet.Fluid.Pumps.Data.Pumps.IMP.NMTPlus152025to40 per,
                    final use_inputFilter=true,
                    final riseTime=1,
                    final init=Modelica.Blocks.Types.Init.SteadyState,
                    final y_start=0)                annotation (Placement(transformation(
                        extent={{10,10},{-10,-10}},
                        rotation=-90,
                        origin={-44,-8})));
                  ProsNet.Fluid.Sources.Boundary_pT
                                            bou(redeclare package Medium =
                        ProsNet.Media.Water,
                      nPorts=1)
                    annotation (Placement(transformation(extent={{68,36},{48,56}})));
                  Modelica.Blocks.Sources.RealExpression realExpression(y=1)
                    annotation (Placement(transformation(extent={{-168,2},{-148,22}})));
                  Modelica.Blocks.Sources.Ramp ramp(
                    height=-1,
                    duration=1200,
                    offset=1,
                    startTime=5)
                    annotation (Placement(transformation(extent={{140,-42},{120,-22}})));
                  Modelica.Fluid.Valves.ValveLinear valveLinear(
                    redeclare package Medium = ProsNet.Media.Water,
                    dp_start=0,
                    dp_nominal=70000,
                    m_flow_nominal=0.55)
                    annotation (Placement(transformation(extent={{42,-20},{62,0}})));
                equation
                  connect(realExpression.y, pump_prim_prod.y) annotation (Line(points={{-147,12},
                          {-64,12},{-64,-8},{-56,-8}}, color={0,0,127}));
                  connect(pump_prim_prod.port_b, bou.ports[1]) annotation (Line(points={{-44,2},
                          {-44,20},{42,20},{42,46},{48,46}}, color={0,127,255}));
                  connect(pump_prim_prod.port_b, valveLinear.port_a) annotation (Line(points={{-44,2},
                          {-44,20},{42,20},{42,2},{32,2},{32,-10},{42,-10}},        color={0,
                          127,255}));
                  connect(valveLinear.port_b, pump_prim_prod.port_a) annotation (Line(points={{62,-10},
                          {64,-10},{64,-26},{-44,-26},{-44,-18}},         color={0,127,255}));
                  connect(ramp.y, valveLinear.opening) annotation (Line(points={{119,-32},{66,
                          -32},{66,2},{52,2},{52,-2}}, color={0,0,127}));
                  annotation ();
                end Test_pump_curve;

                model Test_check_valve_model
                  Modelica.Fluid.Sensors.VolumeFlowRate volumeFlowRate(redeclare
                      package Medium =
                        ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{-20,32},{0,52}})));
                  Modelica.Fluid.Sensors.RelativePressure relativePressure(redeclare
                      package Medium =
                               ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{20,64},{40,84}})));
                  Modelica.Fluid.Sources.MassFlowSource_T mass_source(
                    redeclare package Medium = ProsNet.Media.Water,
                    use_m_flow_in=true,
                    use_T_in=true,
                    m_flow=1,
                    T(displayUnit="K"),
                    nPorts=1) annotation (Placement(transformation(extent={{-94,32},{-74,52}})));
                  inner Modelica.Fluid.System system(
                    T_ambient=285.15,
                    allowFlowReversal=true,
                    energyDynamics=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial)
                    annotation (Placement(transformation(extent={{64,-52},{84,-32}})));
                  Modelica.Fluid.Sources.Boundary_pT bou(redeclare package
                      Medium =
                        ProsNet.Media.Water,
                    T=309.9,                 nPorts=1)
                    annotation (Placement(transformation(extent={{104,32},{84,52}})));
                  ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                    mass_flow_kg_s(table=[0,0; 900,0.1; 1800,0.2; 2700,0.3;
                        3600,0.4; 4500,0.5; 5400,0.6; 6300,0.7; 7200,0.8; 8100,
                        0.9; 9000,1; 9900,1.1; 10800,1.2; 11700,1.3; 12600,1.4;
                        13500,1.5; 14400,1.6; 15300,1.7; 16200,1.8; 17100,1.9;
                        18000,2], timeScale=1) annotation (Placement(
                        transformation(extent={{-182,50},{-162,70}})));
                  ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                    temperatures(
                    table=[0,36.75; 900,36.75; 1800,36.75; 2700,36.75; 3600,
                        36.75; 4500,36.75; 5400,36.75; 6300,36.75; 7200,36.75;
                        8100,36.75; 9000,36.75; 9900,36.75; 10800,36.75; 11700,
                        36.75; 12600,36.75; 13500,36.75; 14400,36.75; 15300,
                        36.75; 16200,36.75; 17100,36.75; 18000,36.75],
                    timeScale=1,
                    y(unit="K")) annotation (Placement(transformation(extent={{
                            -182,16},{-162,36}})));
                  Modelica.Blocks.Math.UnitConversions.From_degC from_degC
                    annotation (Placement(transformation(extent={{-138,16},{-118,36}})));
                  ProsNet.Fluid.Sensors.TemperatureTwoPort Tem_in(
                    redeclare package Medium = ProsNet.Media.Water,
                    m_flow_nominal=1/6,
                    tau=1) annotation (Placement(transformation(extent={{-54,32},{-34,52}})));
                  ProsNet.Fluid.Sensors.TemperatureTwoPort Tem_out(
                    redeclare package Medium = ProsNet.Media.Water,
                    m_flow_nominal=1/6,
                    tau=1) annotation (Placement(transformation(extent={{54,32},{74,52}})));

                  Real DeltaT;
                  Modelica.Blocks.Sources.Constant const(k=1)
                    annotation (Placement(transformation(extent={{-20,66},{0,86}})));
                  ProsNet.Fluid.FixedResistances.CheckValve cheVal_prim_cons(
                    m_flow_nominal=1.25,
                    redeclare final package Medium = ProsNet.Media.Water,
                    final CvData=ProsNet.Fluid.Types.CvTypes.Kv,
                    final Kv=6.29,
                    final l=0.002) annotation (Placement(transformation(
                        extent={{10,-10},{-10,10}},
                        rotation=180,
                        origin={32,42})));
                equation
                  connect(temperatures.y, from_degC.u) annotation (Line(
                      points={{-161,26},{-161,26},{-144,26},{-140,26}},
                      color={0,0,127},
                      smooth=Smooth.Bezier));
                  connect(from_degC.y, mass_source.T_in) annotation (Line(
                      points={{-117,26},{-102,26},{-102,46},{-96,46}},
                      color={0,0,127},
                      smooth=Smooth.Bezier));
                  connect(mass_source.ports[1], Tem_in.port_a) annotation (Line(
                      points={{-74,42},{-54,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));
                  connect(Tem_in.port_b, volumeFlowRate.port_a) annotation (Line(
                      points={{-34,42},{-20,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));
                  connect(Tem_out.port_b, bou.ports[1]) annotation (Line(
                      points={{74,42},{84,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));

                  DeltaT = Tem_out.T - Tem_in.T;
                  connect(mass_flow_kg_s.y, mass_source.m_flow_in) annotation (Line(points=
                          {{-161,60},{-128,60},{-128,50},{-94,50}}, color={0,0,127}));
                  connect(cheVal_prim_cons.port_b, Tem_out.port_a)
                    annotation (Line(points={{42,42},{54,42}}, color={0,127,255}));
                  connect(volumeFlowRate.port_b, cheVal_prim_cons.port_a)
                    annotation (Line(points={{0,42},{22,42}}, color={0,127,255}));
                  connect(relativePressure.port_a, cheVal_prim_cons.port_a)
                    annotation (Line(points={{20,74},{22,74},{22,42}}, color={0,127,255}));
                  connect(relativePressure.port_b, cheVal_prim_cons.port_b) annotation (
                      Line(points={{40,74},{42,74},{42,42},{42,42}}, color={0,127,255}));
                  annotation (                                                       experiment(
                      StopTime=18000,
                      Interval=10,
                      __Dymola_Algorithm="Dassl"));
                end Test_check_valve_model;

                model Test_control_valve_model
                  Modelica.Fluid.Sensors.VolumeFlowRate volumeFlowRate(redeclare
                      package Medium =
                        ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{-20,32},{0,52}})));
                  Modelica.Fluid.Sensors.RelativePressure relativePressure(redeclare
                      package Medium =
                               ProsNet.Media.Water)
                    annotation (Placement(transformation(extent={{20,64},{40,84}})));
                  Modelica.Fluid.Sources.MassFlowSource_T mass_source(
                    redeclare package Medium = ProsNet.Media.Water,
                    use_m_flow_in=true,
                    use_T_in=true,
                    m_flow=1,
                    T(displayUnit="K"),
                    nPorts=1) annotation (Placement(transformation(extent={{-94,32},{-74,52}})));
                  inner Modelica.Fluid.System system(
                    T_ambient=285.15,
                    allowFlowReversal=true,
                    energyDynamics=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial)
                    annotation (Placement(transformation(extent={{64,-52},{84,-32}})));
                  Modelica.Fluid.Sources.Boundary_pT bou(redeclare package
                      Medium =
                        ProsNet.Media.Water,
                    T=309.9,                 nPorts=1)
                    annotation (Placement(transformation(extent={{104,32},{84,52}})));
                  ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                    mass_flow_kg_s(table=[0,0; 900,0.1; 1800,0.2; 2700,0.3;
                        3600,0.4; 4500,0.5; 5400,0.6; 6300,0.7; 7200,0.8; 8100,
                        0.9; 9000,1; 9900,1.1; 10800,1.2; 11700,1.3; 12600,1.4;
                        13500,1.5; 14400,1.6; 15300,1.7; 16200,1.8; 17100,1.9;
                        18000,2], timeScale=1) annotation (Placement(
                        transformation(extent={{-182,50},{-162,70}})));
                  ProsNet.Examples.Bidirectional_Substation.Scenarios.ideal_network.BidirectionalSubstation_idealNet.Controller_PID_based.auxiliary.TimeTable_noInterp
                    temperatures(
                    table=[0,36.75; 900,36.75; 1800,36.75; 2700,36.75; 3600,
                        36.75; 4500,36.75; 5400,36.75; 6300,36.75; 7200,36.75;
                        8100,36.75; 9000,36.75; 9900,36.75; 10800,36.75; 11700,
                        36.75; 12600,36.75; 13500,36.75; 14400,36.75; 15300,
                        36.75; 16200,36.75; 17100,36.75; 18000,36.75],
                    timeScale=1,
                    y(unit="K")) annotation (Placement(transformation(extent={{
                            -182,16},{-162,36}})));
                  Modelica.Blocks.Math.UnitConversions.From_degC from_degC
                    annotation (Placement(transformation(extent={{-138,16},{-118,36}})));
                  ProsNet.Fluid.Sensors.TemperatureTwoPort Tem_in(
                    redeclare package Medium = ProsNet.Media.Water,
                    m_flow_nominal=1/6,
                    tau=1) annotation (Placement(transformation(extent={{-54,32},{-34,52}})));
                  ProsNet.Fluid.Sensors.TemperatureTwoPort Tem_out(
                    redeclare package Medium = ProsNet.Media.Water,
                    m_flow_nominal=1/6,
                    tau=1) annotation (Placement(transformation(extent={{54,32},{74,52}})));

                  Real DeltaT;
                  ProsNet.Fluid.Valves.TwoWayEqualPercentage valve_prim_cons(
                    m_flow_nominal=1.25,
                    kFixed=0,
                    redeclare final package Medium = ProsNet.Media.Water,
                    final CvData=ProsNet.Fluid.Types.CvTypes.Kv,
                    final Kv=6.29,
                    final use_inputFilter=true,
                    final riseTime=35,
                    final init=Modelica.Blocks.Types.Init.InitialState,
                    final y_start=0,
                    final l=0.002) annotation (Placement(transformation(
                        extent={{-10,10},{10,-10}},
                        rotation=180,
                        origin={26,34})));
                  Modelica.Blocks.Sources.Constant const(k=1)
                    annotation (Placement(transformation(extent={{-20,66},{0,86}})));
                equation
                  connect(temperatures.y, from_degC.u) annotation (Line(
                      points={{-161,26},{-161,26},{-144,26},{-140,26}},
                      color={0,0,127},
                      smooth=Smooth.Bezier));
                  connect(from_degC.y, mass_source.T_in) annotation (Line(
                      points={{-117,26},{-102,26},{-102,46},{-96,46}},
                      color={0,0,127},
                      smooth=Smooth.Bezier));
                  connect(mass_source.ports[1], Tem_in.port_a) annotation (Line(
                      points={{-74,42},{-54,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));
                  connect(Tem_in.port_b, volumeFlowRate.port_a) annotation (Line(
                      points={{-34,42},{-20,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));
                  connect(Tem_out.port_b, bou.ports[1]) annotation (Line(
                      points={{74,42},{84,42}},
                      color={0,127,255},
                      smooth=Smooth.Bezier));

                  DeltaT = Tem_out.T - Tem_in.T;
                  connect(mass_flow_kg_s.y, mass_source.m_flow_in) annotation (Line(points=
                          {{-161,60},{-128,60},{-128,50},{-94,50}}, color={0,0,127}));
                  connect(const.y, valve_prim_cons.y) annotation (Line(points={{1,76},{14,
                          76},{14,46},{26,46}}, color={0,0,127}));
                  connect(volumeFlowRate.port_b, valve_prim_cons.port_b) annotation (Line(
                        points={{0,42},{10,42},{10,34},{16,34}}, color={0,127,255}));
                  connect(valve_prim_cons.port_a, Tem_out.port_a) annotation (Line(points={
                          {36,34},{46,34},{46,42},{54,42}}, color={0,127,255}));
                  connect(relativePressure.port_b, valve_prim_cons.port_a)
                    annotation (Line(points={{40,74},{40,34},{36,34}}, color={0,127,255}));
                  connect(valve_prim_cons.port_b, relativePressure.port_a) annotation (Line(
                        points={{16,34},{6,34},{6,74},{20,74}}, color={0,127,255}));
                  annotation (                                                       experiment(
                      StopTime=18000,
                      Interval=10,
                      __Dymola_Algorithm="Dassl"));
                end Test_control_valve_model;

                model Test_TwoProsumers
                  HTS_idealNetwork B1(n=0.5, redeclare
                      Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer)
                    annotation (Placement(transformation(
                        extent={{20,-18},{-20,18}},
                        rotation=0,
                        origin={-48,8})));
                  Controller_PID_based.PID_Q_T_weighted_sameside Ctrl1(alpha_prim_prod=0.35,
                      alpha_sec_cons=0.35) annotation (Placement(transformation(
                        extent={{-12,-17},{12,17}},
                        rotation=0,
                        origin={-44,73})));
                  Controller_PID_based.auxiliary.TimeTable_noInterp power_set1(table=[0,10; 900,10;
                        1800,10; 2700,10; 3600,-10; 4500,-4; 5400,4; 6300,4])  annotation (Placement(
                        transformation(
                        extent={{-10,-10},{10,10}},
                        rotation=-90,
                        origin={-70,134})));
                  Controller_PID_based.auxiliary.TimeTable_noInterp temp_sec_in1(table=[0,55; 900,55;
                        1800,55; 2700,55; 3600,30; 4500,30; 5400,55; 6300,55])   annotation (
                      Placement(transformation(
                        extent={{-10,-10},{10,10}},
                        rotation=-90,
                        origin={-28,134})));
                  Fluid.Pipes.InsulatedPipe_plug pipe_hot12
                    annotation (Placement(transformation(extent={{-8,-58},{18,-32}})));
                  HTS_idealNetwork B2(n=0.5, redeclare
                      Fluid.Pumps.Data.Pumps.IMP.NMTSmart25_120to180 feedinPer)
                    annotation (Placement(transformation(
                        extent={{20,-18},{-20,18}},
                        rotation=0,
                        origin={50,8})));
                  Controller_PID_based.PID_Q_T_weighted_sameside Ctrl2(alpha_prim_prod=0.35,
                      alpha_sec_cons=0.35) annotation (Placement(transformation(
                        extent={{-12,-17},{12,17}},
                        rotation=0,
                        origin={52,73})));
                  Controller_PID_based.auxiliary.TimeTable_noInterp power_set2(table=[0,-10; 900,-10;
                        1800,-10; 2700,-10; 3600,10; 4500,4; 5400,-4; 6300,-4])
                                                                               annotation (Placement(
                        transformation(
                        extent={{-10,-10},{10,10}},
                        rotation=-90,
                        origin={28,134})));
                  Controller_PID_based.auxiliary.TimeTable_noInterp temp_sec_in2(table=[0,30; 900,30;
                        1800,30; 2700,30; 3600,55; 4500,55; 5400,30; 6300,30])   annotation (
                      Placement(transformation(
                        extent={{-10,-10},{10,10}},
                        rotation=-90,
                        origin={70,134})));
                  Fluid.Pipes.InsulatedPipe_plug pipe_cold12
                    annotation (Placement(transformation(extent={{18,-103},{-8,-77}})));
                  Modelica.Fluid.Sources.Boundary_pT boundary(
                    redeclare package Medium = Media.Water,
                    use_p_in=false,
                    T=325.4,
                    nPorts=1) annotation (Placement(transformation(extent={{-92,-55},{-72,-35}})));
                  inner Modelica.Fluid.System system(T_ambient=285.15)
                    annotation (Placement(transformation(extent={{-92,-114},{-72,-94}})));
                  Modelica.Blocks.Math.Add add annotation (Placement(transformation(
                        extent={{-5,-5},{5,5}},
                        rotation=-90,
                        origin={-31,103})));
                  Modelica.Blocks.Sources.RealExpression realExpression(y=273.15) annotation (Placement(
                        transformation(
                        extent={{-5,-6},{5,6}},
                        rotation=270,
                        origin={-8,117})));
                  Modelica.Blocks.Sources.RealExpression realExpression1(y=273.15) annotation (
                      Placement(transformation(
                        extent={{-5,-6},{5,6}},
                        rotation=270,
                        origin={82,115})));
                  Modelica.Blocks.Math.Add add1 annotation (Placement(transformation(
                        extent={{-5,-5},{5,5}},
                        rotation=-90,
                        origin={59,101})));
                equation
                  connect(B1.contr_vars_real, Ctrl1.contr_vars_real)
                    annotation (Line(points={{-27.8,8},{-20,8},{-20,72},{-32,72}}, color={0,0,127}));
                  connect(Ctrl1.states, B1.states)
                    annotation (Line(points={{-56,72},{-74,72},{-74,8},{-68,8}}, color={0,0,127}));
                  connect(power_set1.y, Ctrl1.Q_dot_set) annotation (Line(points={{-70,123},{-70,118},{
                          -50,118},{-50,90.8}},  color={0,0,127}));
                  connect(B2.contr_vars_real,Ctrl2. contr_vars_real)
                    annotation (Line(points={{70.2,8},{78,8},{78,72},{64,72}},     color={0,0,127}));
                  connect(Ctrl2.states,B2. states)
                    annotation (Line(points={{40,72},{24,72},{24,8},{30,8}},     color={0,0,127}));
                  connect(power_set2.y,Ctrl2. Q_dot_set) annotation (Line(points={{28,123},{28,118},{
                          46,118},{46,90.8}},    color={0,0,127}));
                  connect(B1.hot_prim, pipe_hot12.port_a)
                    annotation (Line(points={{-34,-10.2},{-34,-45},{-8,-45}}, color={0,127,255}));
                  connect(pipe_hot12.port_b, B2.hot_prim)
                    annotation (Line(points={{18,-45},{64,-45},{64,-10.2}}, color={0,127,255}));
                  connect(B1.cold_prim, pipe_cold12.port_b)
                    annotation (Line(points={{-62,-10},{-62,-90},{-8,-90}}, color={0,127,255}));
                  connect(pipe_cold12.port_a, B2.cold_prim)
                    annotation (Line(points={{18,-90},{36,-90},{36,-10}}, color={0,127,255}));
                  connect(pipe_hot12.port_a, boundary.ports[1])
                    annotation (Line(points={{-8,-45},{-72,-45}}, color={0,127,255}));
                  connect(add.y, Ctrl1.T_sec_in_is)
                    annotation (Line(points={{-31,97.5},{-31,91},{-38,91}}, color={0,0,127}));
                  connect(temp_sec_in1.y, add.u2) annotation (Line(points={{-28,123},{-28,114},{-34,114},
                          {-34,109}}, color={0,0,127}));
                  connect(add.u1, realExpression.y) annotation (Line(points={{-28,109},{-12,109},{-12,
                          106},{-8,106},{-8,111.5}}, color={0,0,127}));
                  connect(temp_sec_in2.y, add1.u2)
                    annotation (Line(points={{70,123},{70,114},{56,114},{56,107}}, color={0,0,127}));
                  connect(add1.y, Ctrl2.T_sec_in_is)
                    annotation (Line(points={{59,95.5},{58,95.5},{58,91}}, color={0,0,127}));
                  connect(realExpression1.y, add1.u1) annotation (Line(points={{82,109.5},{82,104},{68,
                          104},{68,107},{62,107}}, color={0,0,127}));
                  annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{
                            200,160}})),                                         Diagram(
                        coordinateSystem(preserveAspectRatio=false, extent={{-100,-120},{200,160}}),
                                                                     graphics={Rectangle(extent={{-92,
                              154},{-2,-20}}, lineColor={28,108,200}),         Rectangle(extent={{6,
                              154},{96,-20}}, lineColor={28,108,200})}),
                    experiment(
                      StopTime=6300,
                      Interval=0.1,
                      __Dymola_Algorithm="Dassl"));
                end Test_TwoProsumers;
              end components;
            end Test_Validation;
          end Validation;

          annotation (conversion(noneFromVersion=""));
        end New_Substation_IdealNet;

        package Controller_PID_based

          model PID_Q_T_weighted_crossover_new

            import Modelica.Units.SI;
            import T_AbsZeroDegC = Modelica.Constants.T_zero;
            import Modelica.Blocks.Types.Init;
            import Modelica.Blocks.Types.SimpleController;

              // !!!!! parameters !!!!!
            parameter Real Delta_Qdot_norm = 1
                "Heat power value for normalizing the error (deviation) of the transferred heat.
      For alpha=0.5 a deviation of Delta_Qdot_norm in heat transfer is weigthed equal to a deviation of Delta_T_norm in temperature."
                annotation(Dialog(group="Normalizing values"));
            parameter SI.TemperatureDifference Delta_T_norm(min=0) = 3
                "Temperature difference for normalizing the error (deviation) of the temperature.
      For alpha=0.5 a deviation of Delta_T_norm in temperature is weighted equal to a deviation of Delta_Qdot_norm in heat transfer."
                annotation(Dialog(group="Normalizing values"));

            parameter SI.Temperature T_prim_hot_des(min=277)= - T_AbsZeroDegC + 53.5
                "desired temperature supply primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.Temperature T_sec_hot_des(min=277)= - T_AbsZeroDegC + 50
                "desired temperature supply secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_prim_des(min=1) =   20
                "desired temperature difference primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_sec_des(min=1) =   20
                "desired temperature difference secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter Real _prim_cons_sec_prod_max = 1
              "maximum secondary side volume flow in [l/min]"
              annotation(Dialog(group="General PID settings"));
            parameter Real k_prim_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Ti_prim_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Td_prim_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real alpha_prim_prod(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real k_sec_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Ti_sec_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Td_sec_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real alpha_sec_prod(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real k_prim_cons = 1
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Ti_prim_cons = 35
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Td_prim_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real alpha_prim_cons(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real k_sec_cons = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Ti_sec_cons = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Td_sec_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real alpha_sec_cons(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter .Modelica.Blocks.Types.SimpleController controllerType=
                   Modelica.Blocks.Types.SimpleController.PID "Type of controller"
                   annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Init initType = Modelica.Blocks.Types.Init.NoInit
              "Type of initialization (1: no init, 2: steady state, 3: initial state, 4: initial output)"
              annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Real tol = 0.1
              "tolerance [kW] for idle mode concerning heat transfer setpoint dotQ"
              annotation(Dialog(tab="Advanced", group="Miscellaneous"));

            // !!!!! variables !!!!!
            Real beta_prim_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_prim_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Integer  prosumer_mode
              "prosumer mode {-1;0;1}";
            Real T_prim_relev_des
                "desired value of relevant temperature (difference)
      for control of primary side";
            Real T_prim_relev_is
                "current value of relevant temperature (difference)
      for control of primary side";
            Real T_sec_relev_des
                "desired value of relevant temperature (difference)
      for control of secondary side";
            Real T_sec_relev_is
                "current value of relevant temperature (difference)
      for control of secondary side";

            Real PIDin_prim_cons_is_weighted
                "weighted input of is-values for PID_prim_cons";
            Real PIDin_prim_cons_des_weighted
                "weighted input of desired values for PID_prim_cons";
            Real PIDin_prim_prod_is_weighted
                "weighted input of is-values for PID_prim_prod";
            Real PIDin_prim_prod_des_weighted
                "weighted input of desired values for PID_prim_prod";
            Real PIDin_sec_cons_is_weighted
                "weighted input of is-values for PID_sec_cons";
            Real PIDin_sec_cons_des_weighted
                "weighted input of desired values for PID_sec_cons";
            Real PIDin_sec_prod_is_weighted
                "weighted input of is-values for PID_sec_prod";
            Real PIDin_sec_prod_des_weighted
                "weighted input of desired values for PID_sec_prod";

            Real error_prim_weighted
                "weighted overall error of primary side controller";

            Real error_sec_weighted
                "weighted overall error of primary side controller";

            Real error_T_prim_abs
                "temperature error of primary side controller";

            Real error_T_sec_abs
                "temperature error of primary side controller";

            Real error_Q_abs
                "temperature error of primary side controller";

            Real error_T_high_prio_abs
                "error of higher prioritized temperature objective";

            Real error_T_low_prio_abs
                "error of lower prioritized temperature objective";

            Real Delta_T_prim
                "weighted overall error of primary side controller";

            Real Delta_T_sec
                "weighted overall error of primary side controller";

            Real Q_dot_is_use;
            Real Q_dot_set_use;

             Real Delta_p_prim(unit="Pa", displayUnit="bar") annotation (
                Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=180,
                  origin={-80,-140})));

            // !!!!! ports !!!!!

            Modelica.Blocks.Interfaces.RealVectorInput states[8]
              annotation (Placement(transformation(extent={{-140,-20},{-100,20}})));

            Modelica.Blocks.Interfaces.RealVectorOutput contr_vars_real[6]
              annotation (Placement(transformation(extent={{100,-20},{140,20}})));

            Real u_set_prim_prod
              "Normalized velocity of feed-in pump"
                annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-60}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-60})));
            Real u_set_prim_cons
              "Normalized flow coefficient for control valve"
               annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-100}),iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-100})));
            Real pi_set
              "Participation" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,20}),    iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,20})));
            Real mu_set
              "Operating mode" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-20}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-20})));
            Real T_sec_hot(
              unit="K",
              displayUnit="degC",
              min=277) "current temperature hot level secondary side"      annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,60})));
            Real T_sec_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature cold  level secondary side"    annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,20})));
            Real T_prim_hot(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature hot level primary side"        annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,140})));
            Real T_prim_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                      "current temperature cold level primary side"       annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,100})));
            Modelica.Blocks.Interfaces.RealInput Q_dot_set(unit="kW", displayUnit="kW")
              "setpoint heat transfer (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-20,-20},{20,20}},
                  rotation=-90,
                  origin={-60,188})));
            Real V_dot_prim(unit="l/min", displayUnit="l/min")
              annotation (Placement(transformation(extent={{-100,-40},{-60,0}})));
            Real u2
              annotation (Placement(transformation(extent={{-100,-80},{-60,-40}})));

            Real Q_dot_is(unit="kW", displayUnit="kW")
              "currently transferred heat (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-100,-120},{-60,-80}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_cons(
              controllerType=controllerType,
              k=k_prim_cons,
              Ti=Ti_prim_cons,
              Td=Td_prim_cons,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_cons.yMax)
              annotation (Placement(transformation(extent={{-30,-32},{-10,-12}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_cons(
              controllerType=controllerType,
              k=k_sec_cons,
              Ti=Ti_sec_cons,
              Td=Td_sec_cons,
              yMax=1,
              yMin=0,
              initType=initType,
              y_start=PID_sec_cons.yMax)
              annotation (Placement(transformation(extent={{-34,28},{-14,48}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_prod(
              controllerType=controllerType,
              k=k_prim_prod,
              Ti=Ti_prim_prod,
              Td=Td_prim_prod,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_prod.yMax) annotation (Placement(transformation(extent={{12,-30},
                      {32,-10}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_prod(
              controllerType=controllerType,
              k=k_sec_prod,
              Ti=Ti_sec_prod,
              Td=Td_sec_prod,
              yMax=1,
              yMin=0,
              initType=initType,
              y_start=PID_sec_prod.yMax) annotation (Placement(transformation(extent={{10,28},
                      {30,48}})));
            Real u_set_sec_cons
               "Normalized velocity of the secondary side pump in production" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,100})));
            Real u_set_sec_prod
             "speed set for secondary side pupm in consumption mode" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,60})));
            Modelica.Blocks.Interfaces.RealInput T_sec_in_is(unit="K", displayUnit="degC")
              "Temperature on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=270,
                  origin={60,190})));

          equation

            // assign inputs
            T_prim_hot   = states[1];
            T_prim_cold  = states[2];
            T_sec_hot    = states[3];
            T_sec_cold   = states[4];
            V_dot_prim   = states[5];
            u2           = states[6];
            Q_dot_is     = states[7];
            Delta_p_prim = states[8];

            Delta_T_prim      = T_prim_hot -T_prim_cold;
            Delta_T_sec       = T_sec_hot  -T_sec_cold;

            beta_prim_prod = 1 - alpha_prim_prod;
            beta_sec_prod  = 1 - alpha_sec_prod;
            beta_prim_cons = 1 - alpha_prim_cons;
            beta_sec_cons  = 1 - alpha_sec_cons;

            // determine easy static values that just depend on prosumer mode
            // determine inputs for the four PIDs
            // four PIDs in order to be able to have different gains for each situation

            if  Q_dot_set <= 0-tol then // consumption mode
              prosumer_mode = -1;
            elseif Q_dot_set >= 0+tol then // production mode
              prosumer_mode = +1;
            else // idle mode
              prosumer_mode = 0;
            end if;

            Q_dot_is_use = abs(Q_dot_is);
            Q_dot_set_use = abs(Q_dot_set);

            if prosumer_mode == -1 then // consumption mode
              pi_set = 1;
              mu_set = -1;
              T_prim_relev_des = T_sec_hot_des;
              T_prim_relev_is = T_sec_hot;
              T_sec_relev_des = DeltaT_prim_des;
              T_sec_relev_is = T_prim_hot-T_prim_cold;

              PIDin_prim_cons_is_weighted    = alpha_prim_cons*Q_dot_is_use/Delta_Qdot_norm + beta_prim_cons*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_cons_des_weighted   = alpha_prim_cons*Q_dot_set_use/Delta_Qdot_norm + beta_prim_cons*T_prim_relev_des/Delta_T_norm;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = alpha_sec_cons*Q_dot_is_use/Delta_Qdot_norm + beta_sec_cons*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_cons_des_weighted    = alpha_sec_cons*Q_dot_set_use/Delta_Qdot_norm +
                beta_sec_cons*T_sec_relev_des/Delta_T_norm;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = PIDin_prim_cons_des_weighted - PIDin_prim_cons_is_weighted;
              error_sec_weighted             = PIDin_sec_cons_des_weighted - PIDin_sec_cons_is_weighted;

              error_T_prim_abs               = DeltaT_prim_des - Delta_T_prim;
              error_T_sec_abs                = T_sec_hot_des - T_sec_hot;

              error_T_high_prio_abs          = T_sec_hot_des - T_sec_hot; // T_sec_hot
              error_T_low_prio_abs           = DeltaT_prim_des - Delta_T_prim; // Delta_T_prim

            elseif prosumer_mode == 1 then // production mode
              pi_set = 1;
              mu_set = 1;
              T_prim_relev_des = DeltaT_sec_des;
              T_prim_relev_is = T_sec_hot-T_sec_cold;
              T_sec_relev_des = T_prim_hot_des;
              T_sec_relev_is = T_prim_hot;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = alpha_prim_prod*Q_dot_is_use/Delta_Qdot_norm + beta_prim_prod*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_prod_des_weighted   = alpha_prim_prod*Q_dot_set_use/Delta_Qdot_norm + beta_prim_prod*T_prim_relev_des/Delta_T_norm;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = alpha_sec_prod*Q_dot_is_use/Delta_Qdot_norm + beta_sec_prod*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_prod_des_weighted    = alpha_sec_prod*Q_dot_set_use/Delta_Qdot_norm + beta_sec_prod*T_sec_relev_des/Delta_T_norm;

              error_prim_weighted            = PIDin_prim_prod_des_weighted - PIDin_prim_prod_is_weighted;
              error_sec_weighted             = PIDin_sec_prod_des_weighted - PIDin_sec_prod_is_weighted;

              error_T_prim_abs               = T_prim_hot_des - T_prim_hot;
              error_T_sec_abs                = DeltaT_sec_des - Delta_T_sec;

              error_T_high_prio_abs          = T_prim_hot_des - T_prim_hot; // T_pim_hot
              error_T_low_prio_abs           = DeltaT_sec_des - Delta_T_sec; // Deltat_T_sec

            else // idle mode
              pi_set = 0;
              mu_set = -1;
              T_prim_relev_des = 0;
              T_prim_relev_is = 0;
              T_sec_relev_des = 0;
              T_sec_relev_is = 0;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = 0;
              error_sec_weighted             = 0;

              error_T_prim_abs               = 0;
              error_T_sec_abs                = 0;

              error_T_high_prio_abs          = 0;
              error_T_low_prio_abs           = 0;

            end if;

            // assign PID controller inputs
            PID_prim_cons.u_s    = PIDin_prim_cons_des_weighted;
            PID_prim_cons.u_m    = PIDin_prim_cons_is_weighted;
            PID_prim_prod.u_s    = PIDin_prim_prod_des_weighted;
            PID_prim_prod.u_m    = PIDin_prim_prod_is_weighted;
            PID_sec_cons.u_s     = PIDin_sec_cons_des_weighted;
            PID_sec_cons.u_m     = PIDin_sec_cons_is_weighted;
            PID_sec_prod.u_s     = PIDin_sec_prod_des_weighted;
            PID_sec_prod.u_m     = PIDin_sec_prod_is_weighted;

            // assign PID outputs to controller outputs
            if prosumer_mode == -1 then // consumption mode
              u_set_prim_prod = 0;
              u_set_prim_cons =PID_prim_cons.y;
              u_set_sec_cons = PID_sec_cons.y;
              u_set_sec_prod = 0;
            elseif prosumer_mode == 1 then // production mode
              u_set_prim_prod =PID_prim_prod.y;
              u_set_prim_cons = 0;
              u_set_sec_cons = 0;
              u_set_sec_prod = PID_sec_prod.y;
            else // idle mode
              u_set_sec_cons = 0;
              u_set_sec_prod = 0;
              u_set_prim_prod = 0;
              u_set_prim_cons = 0;
            end if;

            error_Q_abs = Q_dot_set_use - Q_dot_is_use;

            // assign control variables vector
            contr_vars_real[1]   =  u_set_sec_cons;
            contr_vars_real[2]   =  u_set_sec_prod;
            contr_vars_real[3]   =  pi_set;
            contr_vars_real[4]   =  mu_set;
            contr_vars_real[5]   =  u_set_prim_prod;
            contr_vars_real[6]   =  u_set_prim_cons;

              annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{
                      120,180}}),                                           graphics={
                    Text(
                    extent={{-70,56},{64,-56}},
                    textColor={28,108,200},
                    textString="weighted
PID"),           Rectangle(extent={{-120,180},{120,-160}}, lineColor={0,0,0})}),
                                                                             Diagram(
                  coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{120,180}})));
          end PID_Q_T_weighted_crossover_new;

          model PID_Q_T_weighted_sameside

            import Modelica.Units.SI;
            import T_AbsZeroDegC = Modelica.Constants.T_zero;
            import Modelica.Blocks.Types.Init;
            import Modelica.Blocks.Types.SimpleController;

              // !!!!! parameters !!!!!
            parameter Real Delta_Qdot_norm = 1
                "Heat power value for normalizing the error (deviation) of the transferred heat.
      For alpha=0.5 a deviation of Delta_Qdot_norm in heat transfer is weigthed equal to a deviation of Delta_T_norm in temperature."
                annotation(Dialog(group="Normalizing values"));
            parameter SI.TemperatureDifference Delta_T_norm(min=0) = 3
                "Temperature difference for normalizing the error (deviation) of the temperature.
      For alpha=0.5 a deviation of Delta_T_norm in temperature is weighted equal to a deviation of Delta_Qdot_norm in heat transfer."
                annotation(Dialog(group="Normalizing values"));

            parameter SI.Temperature T_prim_hot_des(min=277)= - T_AbsZeroDegC + 53.5
                "desired temperature supply primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.Temperature T_sec_hot_des(min=277)= - T_AbsZeroDegC + 50
                "desired temperature supply secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_prim_des(min=1) =   20
                "desired temperature difference primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_sec_des(min=1) =   20
                "desired temperature difference secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter Real V_dot_sec_max(unit="l/min", displayUnit="l/min") = 8.5
              "maximum secondary side volume flow in [l/min]"
              annotation(Dialog(group="General PID settings"));
            parameter Real k_prim_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Ti_prim_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Td_prim_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real alpha_prim_prod(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real k_sec_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Ti_sec_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Td_sec_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real alpha_sec_prod(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real k_prim_cons = 1.0
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Ti_prim_cons = 35
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Td_prim_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real alpha_prim_cons(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real k_sec_cons = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Ti_sec_cons = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Td_sec_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real alpha_sec_cons(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter .Modelica.Blocks.Types.SimpleController controllerType=
                   Modelica.Blocks.Types.SimpleController.PID "Type of controller"
                   annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Init initType = Modelica.Blocks.Types.Init.NoInit
              "Type of initialization (1: no init, 2: steady state, 3: initial state, 4: initial output)"
              annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Real tol = 0.1
              "tolerance [kW] for idle mode concerning heat transfer setpoint dotQ"
              annotation(Dialog(tab="Advanced", group="Miscellaneous"));

            // !!!!! variables !!!!!
            Real beta_prim_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_prim_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Integer  prosumer_mode
              "prosumer mode {-1;0;1}";
            Real T_prim_relev_des
                "desired value of relevant temperature (difference)
      for control of primary side";
            Real T_prim_relev_is
                "current value of relevant temperature (difference)
      for control of primary side";
            Real T_sec_relev_des
                "desired value of relevant temperature (difference)
      for control of secondary side";
            Real T_sec_relev_is
                "current value of relevant temperature (difference)
      for control of secondary side";

            Real PIDin_prim_cons_is_weighted
                "weighted input of is-values for PID_prim_cons";
            Real PIDin_prim_cons_des_weighted
                "weighted input of desired values for PID_prim_cons";
            Real PIDin_prim_prod_is_weighted
                "weighted input of is-values for PID_prim_prod";
            Real PIDin_prim_prod_des_weighted
                "weighted input of desired values for PID_prim_prod";
            Real PIDin_sec_cons_is_weighted
                "weighted input of is-values for PID_sec_cons";
            Real PIDin_sec_cons_des_weighted
                "weighted input of desired values for PID_sec_cons";
            Real PIDin_sec_prod_is_weighted
                "weighted input of is-values for PID_sec_prod";
            Real PIDin_sec_prod_des_weighted
                "weighted input of desired values for PID_sec_prod";

            Real error_prim_weighted
                "weighted overall error of primary side controller";

            Real error_sec_weighted
                "weighted overall error of primary side controller";

            Real error_T_prim_abs
                "temperature error of primary side controller";

            Real error_T_sec_abs
                "temperature error of primary side controller";

            Real error_Q_abs
                "temperature error of primary side controller";

            Real error_T_high_prio_abs
                "error of higher prioritized temperature objective";

            Real error_T_low_prio_abs
                "error of lower prioritized temperature objective";

            Real Delta_T_prim
                "weighted overall error of primary side controller";

            Real Delta_T_sec
                "weighted overall error of primary side controller";

            Real Q_dot_is_use;
            Real Q_dot_set_use;

             Real Delta_p_prim(unit="Pa", displayUnit="bar") annotation (
                Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=180,
                  origin={-80,-140})));

            // !!!!! ports !!!!!

            Modelica.Blocks.Interfaces.RealVectorInput states[8]
              annotation (Placement(transformation(extent={{-140,-20},{-100,20}})));

            Modelica.Blocks.Interfaces.RealVectorOutput contr_vars_real[6]
              annotation (Placement(transformation(extent={{100,-20},{140,20}})));

            Real u_set
              "Normalized velocity of feed-in pump"
                annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-60}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-60})));
            Real kappa_set
              "Normalized flow coefficient for control valve"
               annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-100}),iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-100})));
            Real pi_set
              "Participation" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,20}),    iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,20})));
            Real mu_set
              "Operating mode" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-20}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-20})));
            Real T_sec_hot(
              unit="K",
              displayUnit="degC",
              min=277) "current temperature hot level secondary side"      annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,60})));
            Real T_sec_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature cold  level secondary side"    annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,20})));
            Real T_prim_hot(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature hot level primary side"        annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,140})));
            Real T_prim_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                      "current temperature cold level primary side"       annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,100})));
            Modelica.Blocks.Interfaces.RealInput Q_dot_set(unit="kW", displayUnit="kW")
              "setpoint heat transfer (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-20,-20},{20,20}},
                  rotation=-90,
                  origin={-60,188})));
            Real V_dot_prim(unit="l/min", displayUnit="l/min")
              annotation (Placement(transformation(extent={{-100,-40},{-60,0}})));
            Real V_dot_sec(unit="l/min", displayUnit="l/min")
              annotation (Placement(transformation(extent={{-100,-80},{-60,-40}})));

            Real Q_dot_is(unit="kW", displayUnit="kW")
              "currently transferred heat (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-100,-120},{-60,-80}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_cons(
              controllerType=controllerType,
              k=k_prim_cons,
              Ti=Ti_prim_cons,
              Td=Td_prim_cons,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_cons.yMax)
              annotation (Placement(transformation(extent={{-30,-32},{-10,-12}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_cons(
              controllerType=controllerType,
              k=k_sec_cons,
              Ti=Ti_sec_cons,
              Td=Td_sec_cons,
              yMax=V_dot_sec_max,
              yMin=2,
              initType=initType,
              y_start=PID_sec_cons.yMax)
              annotation (Placement(transformation(extent={{-34,28},{-14,48}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_prod(
              controllerType=controllerType,
              k=k_prim_prod,
              Ti=Ti_prim_prod,
              Td=Td_prim_prod,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_prod.yMax) annotation (Placement(transformation(extent={{12,-30},
                      {32,-10}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_prod(
              controllerType=controllerType,
              k=k_sec_prod,
              Ti=Ti_sec_prod,
              Td=Td_sec_prod,
              yMax=V_dot_sec_max,
              yMin=2,
              initType=initType,
              y_start=PID_sec_prod.yMax) annotation (Placement(transformation(extent={{10,28},
                      {30,48}})));
            Real T_sec_set(unit="K", displayUnit="degC")
               "Temperature on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,100})));
            Real V_dot_sec_set(unit="l/min", displayUnit=
                 "l/min") "volume flow rate setpoint on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,60})));
            Modelica.Blocks.Interfaces.RealInput T_sec_in_is(unit="K", displayUnit="degC")
              "Temperature on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=270,
                  origin={60,190})));

          equation

            // assign inputs
            T_prim_hot   = states[1];
            T_prim_cold  = states[2];
            T_sec_hot    = states[3];
            T_sec_cold   = states[4];
            V_dot_prim   = states[5];
            V_dot_sec    = states[6];
            Q_dot_is     = states[7];
            Delta_p_prim = states[8];

            Delta_T_prim      = T_prim_hot -T_prim_cold;
            Delta_T_sec       = T_sec_hot  -T_sec_cold;

            beta_prim_prod = 1 - alpha_prim_prod;
            beta_sec_prod  = 1 - alpha_sec_prod;
            beta_prim_cons = 1 - alpha_prim_cons;
            beta_sec_cons  = 1 - alpha_sec_cons;

            // determine easy static values that just depend on prosumer mode
            // determine inputs for the four PIDs
            // four PIDs in order to be able to have different gains for each situation

            if  Q_dot_set <= 0-tol then // consumption mode
              prosumer_mode = -1;
            elseif Q_dot_set >= 0+tol then // production mode
              prosumer_mode = +1;
            else // idle mode
              prosumer_mode = 0;
            end if;

            Q_dot_is_use = abs(Q_dot_is);
            Q_dot_set_use = abs(Q_dot_set);

            if prosumer_mode == -1 then // consumption mode
              pi_set = 1;
              mu_set = -1;
              T_prim_relev_des = DeltaT_prim_des;
              T_prim_relev_is = T_prim_hot-T_prim_cold;
              T_sec_relev_des = T_sec_hot_des;
              T_sec_relev_is = T_sec_hot;

              PIDin_prim_cons_is_weighted    = alpha_prim_cons*Q_dot_is_use/Delta_Qdot_norm + beta_prim_cons*(-1)*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_cons_des_weighted   = alpha_prim_cons*Q_dot_set_use/Delta_Qdot_norm + beta_prim_cons*(-1)*T_prim_relev_des/Delta_T_norm;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = alpha_sec_cons*Q_dot_is_use/Delta_Qdot_norm + beta_sec_cons*(-1)*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_cons_des_weighted    = alpha_sec_cons*Q_dot_set_use/Delta_Qdot_norm + beta_sec_cons*(-1)*T_sec_relev_des/Delta_T_norm;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = PIDin_prim_cons_des_weighted - PIDin_prim_cons_is_weighted;
              error_sec_weighted             = PIDin_sec_cons_des_weighted - PIDin_sec_cons_is_weighted;

              error_T_prim_abs               = DeltaT_prim_des - Delta_T_prim;
              error_T_sec_abs                = T_sec_hot_des - T_sec_hot;

              error_T_high_prio_abs          = T_sec_hot_des - T_sec_hot;
              error_T_low_prio_abs           = DeltaT_prim_des - Delta_T_prim;

            elseif prosumer_mode == 1 then // production mode
              pi_set = 1;
              mu_set = 1;
              T_prim_relev_des = T_prim_hot_des;
              T_prim_relev_is = T_prim_hot;
              T_sec_relev_des = DeltaT_sec_des;
              T_sec_relev_is = T_sec_hot-T_sec_cold;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = alpha_prim_prod*Q_dot_is_use/Delta_Qdot_norm + beta_prim_prod*(-1)*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_prod_des_weighted   = alpha_prim_prod*Q_dot_set_use/Delta_Qdot_norm + beta_prim_prod*(-1)*T_prim_relev_des/Delta_T_norm;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = alpha_sec_prod*Q_dot_is_use/Delta_Qdot_norm + beta_sec_prod*(-1)*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_prod_des_weighted    = alpha_sec_prod*Q_dot_set_use/Delta_Qdot_norm + beta_sec_prod*(-1)*T_sec_relev_des/Delta_T_norm;

              error_prim_weighted            = PIDin_prim_prod_des_weighted - PIDin_prim_prod_is_weighted;
              error_sec_weighted             = PIDin_sec_prod_des_weighted - PIDin_sec_prod_is_weighted;

              error_T_prim_abs               = T_prim_hot_des - T_prim_hot;
              error_T_sec_abs                = DeltaT_sec_des - Delta_T_sec;

              error_T_high_prio_abs          = T_prim_hot_des - T_prim_hot;
              error_T_low_prio_abs           = DeltaT_sec_des - Delta_T_sec;

            else // idle mode
              pi_set = 0;
              mu_set = -1;
              T_prim_relev_des = 0;
              T_prim_relev_is = 0;
              T_sec_relev_des = 0;
              T_sec_relev_is = 0;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = 0;
              error_sec_weighted             = 0;

              error_T_prim_abs               = 0;
              error_T_sec_abs                = 0;

              error_T_high_prio_abs          = 0;
              error_T_low_prio_abs           = 0;

            end if;

            // assign PID controller inputs
            PID_prim_cons.u_s    = PIDin_prim_cons_des_weighted;
            PID_prim_cons.u_m    = PIDin_prim_cons_is_weighted;
            PID_prim_prod.u_s    = PIDin_prim_prod_des_weighted;
            PID_prim_prod.u_m    = PIDin_prim_prod_is_weighted;
            PID_sec_cons.u_s     = PIDin_sec_cons_des_weighted;
            PID_sec_cons.u_m     = PIDin_sec_cons_is_weighted;
            PID_sec_prod.u_s     = PIDin_sec_prod_des_weighted;
            PID_sec_prod.u_m     = PIDin_sec_prod_is_weighted;

            // connect secondary side temperature setpoint
            T_sec_set    =  T_sec_in_is;

            // assign PID outputs to controller outputs
            if prosumer_mode == -1 then // consumption mode
              u_set = 0;
              kappa_set =PID_prim_cons.y;
              V_dot_sec_set = PID_sec_cons.y;
            elseif prosumer_mode == 1 then // production mode
              u_set =PID_prim_prod.y;
              kappa_set = 0;
              V_dot_sec_set = PID_sec_prod.y;
            else // idle mode
              V_dot_sec_set = 0;
              u_set = 0;
              kappa_set = 0;
            end if;

            error_Q_abs = Q_dot_set_use - Q_dot_is_use;

            // assign control variables vector
            contr_vars_real[1]   =  T_sec_set;
            contr_vars_real[2]   =  V_dot_sec_set;
            contr_vars_real[3]   =  pi_set;
            contr_vars_real[4]   =  mu_set;
            contr_vars_real[5]   =  u_set;
            contr_vars_real[6]   =  kappa_set;

              annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{
                      120,180}}),                                           graphics={
                    Text(
                    extent={{-70,56},{64,-56}},
                    textColor={28,108,200},
                    textString="weighted
PID"),           Rectangle(extent={{-120,180},{120,-160}}, lineColor={0,0,0})}),
                                                                             Diagram(
                  coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{120,180}})));
          end PID_Q_T_weighted_sameside;

          model PID_Q_T_weighted_crossover_idealNet

            import Modelica.Units.SI;
            import T_AbsZeroDegC = Modelica.Constants.T_zero;
            import Modelica.Blocks.Types.Init;
            import Modelica.Blocks.Types.SimpleController;

              // !!!!! parameters !!!!!
            parameter Real Delta_Qdot_norm = 1
                "Heat power value for normalizing the error (deviation) of the transferred heat.
      For alpha=0.5 a deviation of Delta_Qdot_norm in heat transfer is weigthed equal to a deviation of Delta_T_norm in temperature."
                annotation(Dialog(group="Normalizing values"));
            parameter SI.TemperatureDifference Delta_T_norm(min=0) = 3
                "Temperature difference for normalizing the error (deviation) of the temperature.
      For alpha=0.5 a deviation of Delta_T_norm in temperature is weighted equal to a deviation of Delta_Qdot_norm in heat transfer."
                annotation(Dialog(group="Normalizing values"));

            parameter SI.Temperature T_prim_hot_des(min=277)= - T_AbsZeroDegC + 53.5
                "desired temperature supply primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.Temperature T_sec_hot_des(min=277)= - T_AbsZeroDegC + 50
                "desired temperature supply secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_prim_des(min=1) =   20
                "desired temperature difference primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_sec_des(min=1) =   20
                "desired temperature difference secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter Real _prim_cons_sec_prod_max = 1
              "maximum secondary side volume flow in [l/min]"
              annotation(Dialog(group="General PID settings"));
            parameter Real k_prim_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Ti_prim_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Td_prim_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real alpha_prim_prod(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real k_sec_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Ti_sec_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Td_sec_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real alpha_sec_prod(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real k_prim_cons = 1
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Ti_prim_cons = 35
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Td_prim_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real alpha_prim_cons(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real k_sec_cons = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Ti_sec_cons = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Td_sec_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real alpha_sec_cons(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter .Modelica.Blocks.Types.SimpleController controllerType=
                   Modelica.Blocks.Types.SimpleController.PID "Type of controller"
                   annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Init initType = Modelica.Blocks.Types.Init.NoInit
              "Type of initialization (1: no init, 2: steady state, 3: initial state, 4: initial output)"
              annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Real tol = 0.1
              "tolerance [kW] for idle mode concerning heat transfer setpoint dotQ"
              annotation(Dialog(tab="Advanced", group="Miscellaneous"));

            // !!!!! variables !!!!!
            Real beta_prim_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_prim_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Integer  prosumer_mode
              "prosumer mode {-1;0;1}";
            Real T_prim_relev_des
                "desired value of relevant temperature (difference)
      for control of primary side";
            Real T_prim_relev_is
                "current value of relevant temperature (difference)
      for control of primary side";
            Real T_sec_relev_des
                "desired value of relevant temperature (difference)
      for control of secondary side";
            Real T_sec_relev_is
                "current value of relevant temperature (difference)
      for control of secondary side";

            Real PIDin_prim_cons_is_weighted
                "weighted input of is-values for PID_prim_cons";
            Real PIDin_prim_cons_des_weighted
                "weighted input of desired values for PID_prim_cons";
            Real PIDin_prim_prod_is_weighted
                "weighted input of is-values for PID_prim_prod";
            Real PIDin_prim_prod_des_weighted
                "weighted input of desired values for PID_prim_prod";
            Real PIDin_sec_cons_is_weighted
                "weighted input of is-values for PID_sec_cons";
            Real PIDin_sec_cons_des_weighted
                "weighted input of desired values for PID_sec_cons";
            Real PIDin_sec_prod_is_weighted
                "weighted input of is-values for PID_sec_prod";
            Real PIDin_sec_prod_des_weighted
                "weighted input of desired values for PID_sec_prod";

            Real error_prim_weighted
                "weighted overall error of primary side controller";

            Real error_sec_weighted
                "weighted overall error of primary side controller";

            Real error_T_prim_abs
                "temperature error of primary side controller";

            Real error_T_sec_abs
                "temperature error of primary side controller";

            Real error_Q_abs
                "temperature error of primary side controller";

            Real error_T_high_prio_abs
                "error of higher prioritized temperature objective";

            Real error_T_low_prio_abs
                "error of lower prioritized temperature objective";

            Real Delta_T_prim
                "weighted overall error of primary side controller";

            Real Delta_T_sec
                "weighted overall error of primary side controller";

            Real Q_dot_is_use;
            Real Q_dot_set_use;

             Real Delta_p_prim(unit="Pa", displayUnit="bar") annotation (
                Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=180,
                  origin={-80,-140})));

            // !!!!! ports !!!!!

            Modelica.Blocks.Interfaces.RealVectorInput states[8]
              annotation (Placement(transformation(extent={{-140,-20},{-100,20}})));

            Modelica.Blocks.Interfaces.RealVectorOutput contr_vars_real[6]
              annotation (Placement(transformation(extent={{100,-20},{140,20}})));

            Real u_set_prim_prod
              "Normalized velocity of feed-in pump"
                annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-60}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-60})));
            Real u_set_prim_cons
              "Normalized flow coefficient for control valve"
               annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-100}),iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-100})));
            Real pi_set
              "Participation" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,20}),    iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,20})));
            Real mu_set
              "Operating mode" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-20}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-20})));
            Real T_sec_hot(
              unit="K",
              displayUnit="degC",
              min=277) "current temperature hot level secondary side"      annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,60})));
            Real T_sec_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature cold  level secondary side"    annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,20})));
            Real T_prim_hot(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature hot level primary side"        annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,140})));
            Real T_prim_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                      "current temperature cold level primary side"       annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,100})));
            Modelica.Blocks.Interfaces.RealInput Q_dot_set(unit="kW", displayUnit="kW")
              "setpoint heat transfer (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-20,-20},{20,20}},
                  rotation=-90,
                  origin={-60,188})));
            Real V_dot_prim(unit="l/min", displayUnit="l/min")
              annotation (Placement(transformation(extent={{-100,-40},{-60,0}})));
            Real u2
              annotation (Placement(transformation(extent={{-100,-80},{-60,-40}})));

            Real Q_dot_is(unit="kW", displayUnit="kW")
              "currently transferred heat (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-100,-120},{-60,-80}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_cons(
              controllerType=controllerType,
              k=k_prim_cons,
              Ti=Ti_prim_cons,
              Td=Td_prim_cons,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_cons.yMax)
              annotation (Placement(transformation(extent={{-30,-32},{-10,-12}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_cons(
              controllerType=controllerType,
              k=k_sec_cons,
              Ti=Ti_sec_cons,
              Td=Td_sec_cons,
              yMax=1,
              yMin=0,
              initType=initType,
              y_start=PID_sec_cons.yMax)
              annotation (Placement(transformation(extent={{-34,28},{-14,48}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_prod(
              controllerType=controllerType,
              k=k_prim_prod,
              Ti=Ti_prim_prod,
              Td=Td_prim_prod,
              yMax=2,
              yMin=0,
              initType=initType,
              y_start=PID_prim_prod.yMax) annotation (Placement(transformation(extent={{12,-30},
                      {32,-10}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_prod(
              controllerType=controllerType,
              k=k_sec_prod,
              Ti=Ti_sec_prod,
              Td=Td_sec_prod,
              yMax=1,
              yMin=0,
              initType=initType,
              y_start=PID_sec_prod.yMax) annotation (Placement(transformation(extent={{10,28},
                      {30,48}})));
            Real u_set_sec_cons
               "Normalized velocity of the secondary side pump in production" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,100})));
            Real u_set_sec_prod
             "speed set for secondary side pupm in consumption mode" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,60})));
            Modelica.Blocks.Interfaces.RealInput T_sec_in_is(unit="K", displayUnit="degC")
              "Temperature on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=270,
                  origin={60,190})));

          equation

            // assign inputs
            T_prim_hot   = states[1];
            T_prim_cold  = states[2];
            T_sec_hot    = states[3];
            T_sec_cold   = states[4];
            V_dot_prim   = states[5];
            u2           = states[6];
            Q_dot_is     = states[7];
            Delta_p_prim = states[8];

            Delta_T_prim      = T_prim_hot -T_prim_cold;
            Delta_T_sec       = T_sec_hot  -T_sec_cold;

            beta_prim_prod = 1 - alpha_prim_prod;
            beta_sec_prod  = 1 - alpha_sec_prod;
            beta_prim_cons = 1 - alpha_prim_cons;
            beta_sec_cons  = 1 - alpha_sec_cons;

            // determine easy static values that just depend on prosumer mode
            // determine inputs for the four PIDs
            // four PIDs in order to be able to have different gains for each situation

            if  Q_dot_set <= 0-tol then // consumption mode
              prosumer_mode = -1;
            elseif Q_dot_set >= 0+tol then // production mode
              prosumer_mode = +1;
            else // idle mode
              prosumer_mode = 0;
            end if;

            Q_dot_is_use = abs(Q_dot_is);
            Q_dot_set_use = abs(Q_dot_set);

            if prosumer_mode == -1 then // consumption mode
              pi_set = 1;
              mu_set = -1;
              T_prim_relev_des = T_sec_hot_des;
              T_prim_relev_is = T_sec_hot;
              T_sec_relev_des = DeltaT_prim_des;
              T_sec_relev_is = T_prim_hot-T_prim_cold;

              PIDin_prim_cons_is_weighted    = alpha_prim_cons*Q_dot_is_use/Delta_Qdot_norm + beta_prim_cons*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_cons_des_weighted   = alpha_prim_cons*Q_dot_set_use/Delta_Qdot_norm + beta_prim_cons*T_prim_relev_des/Delta_T_norm;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = alpha_sec_cons*Q_dot_is_use/Delta_Qdot_norm + beta_sec_cons*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_cons_des_weighted    = alpha_sec_cons*Q_dot_set_use/Delta_Qdot_norm +
                beta_sec_cons*T_sec_relev_des/Delta_T_norm;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = PIDin_prim_cons_des_weighted - PIDin_prim_cons_is_weighted;
              error_sec_weighted             = PIDin_sec_cons_des_weighted - PIDin_sec_cons_is_weighted;

              error_T_prim_abs               = DeltaT_prim_des - Delta_T_prim;
              error_T_sec_abs                = T_sec_hot_des - T_sec_hot;

              error_T_high_prio_abs          = T_sec_hot_des - T_sec_hot; // T_sec_hot
              error_T_low_prio_abs           = DeltaT_prim_des - Delta_T_prim; // Delta_T_prim

            elseif prosumer_mode == 1 then // production mode
              pi_set = 1;
              mu_set = 1;
              T_prim_relev_des = DeltaT_sec_des;
              T_prim_relev_is = T_sec_hot-T_sec_cold;
              T_sec_relev_des = T_prim_hot_des;
              T_sec_relev_is = T_prim_hot;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = alpha_prim_prod*Q_dot_is_use/Delta_Qdot_norm + beta_prim_prod*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_prod_des_weighted   = alpha_prim_prod*Q_dot_set_use/Delta_Qdot_norm + beta_prim_prod*T_prim_relev_des/Delta_T_norm;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = alpha_sec_prod*Q_dot_is_use/Delta_Qdot_norm + beta_sec_prod*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_prod_des_weighted    = alpha_sec_prod*Q_dot_set_use/Delta_Qdot_norm + beta_sec_prod*T_sec_relev_des/Delta_T_norm;

              error_prim_weighted            = PIDin_prim_prod_des_weighted - PIDin_prim_prod_is_weighted;
              error_sec_weighted             = PIDin_sec_prod_des_weighted - PIDin_sec_prod_is_weighted;

              error_T_prim_abs               = T_prim_hot_des - T_prim_hot;
              error_T_sec_abs                = DeltaT_sec_des - Delta_T_sec;

              error_T_high_prio_abs          = T_prim_hot_des - T_prim_hot; // T_pim_hot
              error_T_low_prio_abs           = DeltaT_sec_des - Delta_T_sec; // Deltat_T_sec

            else // idle mode
              pi_set = 0;
              mu_set = -1;
              T_prim_relev_des = 0;
              T_prim_relev_is = 0;
              T_sec_relev_des = 0;
              T_sec_relev_is = 0;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = 0;
              error_sec_weighted             = 0;

              error_T_prim_abs               = 0;
              error_T_sec_abs                = 0;

              error_T_high_prio_abs          = 0;
              error_T_low_prio_abs           = 0;

            end if;

            // assign PID controller inputs
            PID_prim_cons.u_s    = PIDin_prim_cons_des_weighted;
            PID_prim_cons.u_m    = PIDin_prim_cons_is_weighted;
            PID_prim_prod.u_s    = PIDin_prim_prod_des_weighted;
            PID_prim_prod.u_m    = PIDin_prim_prod_is_weighted;
            PID_sec_cons.u_s     = PIDin_sec_cons_des_weighted;
            PID_sec_cons.u_m     = PIDin_sec_cons_is_weighted;
            PID_sec_prod.u_s     = PIDin_sec_prod_des_weighted;
            PID_sec_prod.u_m     = PIDin_sec_prod_is_weighted;

            // assign PID outputs to controller outputs
            if prosumer_mode == -1 then // consumption mode
              u_set_prim_prod = 0;
              u_set_prim_cons =PID_prim_cons.y;
              u_set_sec_cons = PID_sec_cons.y;
              u_set_sec_prod = 0;
            elseif prosumer_mode == 1 then // production mode
              u_set_prim_prod =PID_prim_prod.y;
              u_set_prim_cons = 0;
              u_set_sec_cons = 0;
              u_set_sec_prod = PID_sec_prod.y;
            else // idle mode
              u_set_sec_cons = 0;
              u_set_sec_prod = 0;
              u_set_prim_prod = 0;
              u_set_prim_cons = 0;
            end if;

            error_Q_abs = Q_dot_set_use - Q_dot_is_use;

            // assign control variables vector
            contr_vars_real[1]   =  u_set_sec_cons;
            contr_vars_real[2]   =  u_set_sec_prod;
            contr_vars_real[3]   =  pi_set;
            contr_vars_real[4]   =  mu_set;
            contr_vars_real[5]   =  u_set_prim_prod;
            contr_vars_real[6]   =  u_set_prim_cons;

              annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{
                      120,180}}),                                           graphics={
                    Text(
                    extent={{-70,56},{64,-56}},
                    textColor={28,108,200},
                    textString="weighted
PID"),           Rectangle(extent={{-120,180},{120,-160}}, lineColor={0,0,0})}),
                                                                             Diagram(
                  coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{120,180}})));
          end PID_Q_T_weighted_crossover_idealNet;

          model PID_Q_T_weighted_mix1

            import Modelica.Units.SI;
            import T_AbsZeroDegC = Modelica.Constants.T_zero;
            import Modelica.Blocks.Types.Init;
            import Modelica.Blocks.Types.SimpleController;

              // !!!!! parameters !!!!!
            parameter Real Delta_Qdot_norm = 1
                "Heat power value for normalizing the error (deviation) of the transferred heat.
      For alpha=0.5 a deviation of Delta_Qdot_norm in heat transfer is weigthed equal to a deviation of Delta_T_norm in temperature."
                annotation(Dialog(group="Normalizing values"));
            parameter SI.TemperatureDifference Delta_T_norm(min=0) = 3
                "Temperature difference for normalizing the error (deviation) of the temperature.
      For alpha=0.5 a deviation of Delta_T_norm in temperature is weighted equal to a deviation of Delta_Qdot_norm in heat transfer."
                annotation(Dialog(group="Normalizing values"));

            parameter SI.Temperature T_prim_hot_des(min=277)= - T_AbsZeroDegC + 53.5
                "desired temperature supply primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.Temperature T_sec_hot_des(min=277)= - T_AbsZeroDegC + 50
                "desired temperature supply secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_prim_des(min=1) =   20
                "desired temperature difference primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_sec_des(min=1) =   20
                "desired temperature difference secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter Real V_dot_sec_max(unit="l/min", displayUnit="l/min") = 8.5
              "maximum secondary side volume flow in [l/min]"
              annotation(Dialog(group="General PID settings"));
            parameter Real k_prim_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Ti_prim_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Td_prim_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real alpha_prim_prod(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real k_sec_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Ti_sec_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Td_sec_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real alpha_sec_prod(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real k_prim_cons = 1.0
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Ti_prim_cons = 35
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Td_prim_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real alpha_prim_cons(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real k_sec_cons = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Ti_sec_cons = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Td_sec_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real alpha_sec_cons(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter .Modelica.Blocks.Types.SimpleController controllerType=
                   Modelica.Blocks.Types.SimpleController.PID "Type of controller"
                   annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Init initType = Modelica.Blocks.Types.Init.NoInit
              "Type of initialization (1: no init, 2: steady state, 3: initial state, 4: initial output)"
              annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Real tol = 0.1
              "tolerance [kW] for idle mode concerning heat transfer setpoint dotQ"
              annotation(Dialog(tab="Advanced", group="Miscellaneous"));

            // !!!!! variables !!!!!
            Real beta_prim_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_prim_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Integer  prosumer_mode
              "prosumer mode {-1;0;1}";
            Real T_prim_relev_des
                "desired value of relevant temperature (difference)
      for control of primary side";
            Real T_prim_relev_is
                "current value of relevant temperature (difference)
      for control of primary side";
            Real T_sec_relev_des
                "desired value of relevant temperature (difference)
      for control of secondary side";
            Real T_sec_relev_is
                "current value of relevant temperature (difference)
      for control of secondary side";

            Real PIDin_prim_cons_is_weighted
                "weighted input of is-values for PID_prim_cons";
            Real PIDin_prim_cons_des_weighted
                "weighted input of desired values for PID_prim_cons";
            Real PIDin_prim_prod_is_weighted
                "weighted input of is-values for PID_prim_prod";
            Real PIDin_prim_prod_des_weighted
                "weighted input of desired values for PID_prim_prod";
            Real PIDin_sec_cons_is_weighted
                "weighted input of is-values for PID_sec_cons";
            Real PIDin_sec_cons_des_weighted
                "weighted input of desired values for PID_sec_cons";
            Real PIDin_sec_prod_is_weighted
                "weighted input of is-values for PID_sec_prod";
            Real PIDin_sec_prod_des_weighted
                "weighted input of desired values for PID_sec_prod";

            Real error_prim_weighted
                "weighted overall error of primary side controller";

            Real error_sec_weighted
                "weighted overall error of primary side controller";

            Real error_T_prim_abs
                "temperature error of primary side controller";

            Real error_T_sec_abs
                "temperature error of primary side controller";

            Real error_Q_abs
                "temperature error of primary side controller";

            Real error_T_high_prio_abs
                "error of higher prioritized temperature objective";

            Real error_T_low_prio_abs
                "error of lower prioritized temperature objective";

            Real Delta_T_prim
                "weighted overall error of primary side controller";

            Real Delta_T_sec
                "weighted overall error of primary side controller";

            Real Q_dot_is_use;
            Real Q_dot_set_use;

             Real Delta_p_prim(unit="Pa", displayUnit="bar") annotation (
                Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=180,
                  origin={-80,-140})));

            // !!!!! ports !!!!!

            Modelica.Blocks.Interfaces.RealVectorInput states[8]
              annotation (Placement(transformation(extent={{-140,-20},{-100,20}})));

            Modelica.Blocks.Interfaces.RealVectorOutput contr_vars_real[6]
              annotation (Placement(transformation(extent={{100,-20},{140,20}})));

            Real u_set
              "Normalized velocity of feed-in pump"
                annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-60}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-60})));
            Real kappa_set
              "Normalized flow coefficient for control valve"
               annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-100}),iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-100})));
            Real pi_set
              "Participation" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,20}),    iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,20})));
            Real mu_set
              "Operating mode" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-20}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-20})));
            Real T_sec_hot(
              unit="K",
              displayUnit="degC",
              min=277) "current temperature hot level secondary side"      annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,60})));
            Real T_sec_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature cold  level secondary side"    annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,20})));
            Real T_prim_hot(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature hot level primary side"        annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,140})));
            Real T_prim_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                      "current temperature cold level primary side"       annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,100})));
            Modelica.Blocks.Interfaces.RealInput Q_dot_set(unit="kW", displayUnit="kW")
              "setpoint heat transfer (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-20,-20},{20,20}},
                  rotation=-90,
                  origin={-60,188})));
            Real V_dot_prim(unit="l/min", displayUnit="l/min")
              annotation (Placement(transformation(extent={{-100,-40},{-60,0}})));
            Real V_dot_sec(unit="l/min", displayUnit="l/min")
              annotation (Placement(transformation(extent={{-100,-80},{-60,-40}})));

            Real Q_dot_is(unit="kW", displayUnit="kW")
              "currently transferred heat (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-100,-120},{-60,-80}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_cons(
              controllerType=controllerType,
              k=k_prim_cons,
              Ti=Ti_prim_cons,
              Td=Td_prim_cons,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_cons.yMax)
              annotation (Placement(transformation(extent={{-30,-32},{-10,-12}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_cons(
              controllerType=controllerType,
              k=k_sec_cons,
              Ti=Ti_sec_cons,
              Td=Td_sec_cons,
              yMax=V_dot_sec_max,
              yMin=2,
              initType=initType,
              y_start=PID_sec_cons.yMax)
              annotation (Placement(transformation(extent={{-34,28},{-14,48}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_prod(
              controllerType=controllerType,
              k=k_prim_prod,
              Ti=Ti_prim_prod,
              Td=Td_prim_prod,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_prod.yMax) annotation (Placement(transformation(extent={{12,-30},
                      {32,-10}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_prod(
              controllerType=controllerType,
              k=k_sec_prod,
              Ti=Ti_sec_prod,
              Td=Td_sec_prod,
              yMax=V_dot_sec_max,
              yMin=2,
              initType=initType,
              y_start=PID_sec_prod.yMax) annotation (Placement(transformation(extent={{10,28},
                      {30,48}})));
            Real T_sec_set(unit="K", displayUnit="degC")
               "Temperature on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,100})));
            Real V_dot_sec_set(unit="l/min", displayUnit=
                 "l/min") "volume flow rate setpoint on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,60})));
            Modelica.Blocks.Interfaces.RealInput T_sec_in_is(unit="K", displayUnit="degC")
              "Temperature on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=270,
                  origin={60,190})));

          equation

            // assign inputs
            T_prim_hot   = states[1];
            T_prim_cold  = states[2];
            T_sec_hot    = states[3];
            T_sec_cold   = states[4];
            V_dot_prim   = states[5];
            V_dot_sec    = states[6];
            Q_dot_is     = states[7];
            Delta_p_prim = states[8];

            Delta_T_prim      = T_prim_hot -T_prim_cold;
            Delta_T_sec       = T_sec_hot  -T_sec_cold;

            beta_prim_prod = 1 - alpha_prim_prod;
            beta_sec_prod  = 1 - alpha_sec_prod;
            beta_prim_cons = 1 - alpha_prim_cons;
            beta_sec_cons  = 1 - alpha_sec_cons;

            // determine easy static values that just depend on prosumer mode
            // determine inputs for the four PIDs
            // four PIDs in order to be able to have different gains for each situation

            if  Q_dot_set <= 0-tol then // consumption mode
              prosumer_mode = -1;
            elseif Q_dot_set >= 0+tol then // production mode
              prosumer_mode = +1;
            else // idle mode
              prosumer_mode = 0;
            end if;

            Q_dot_is_use = abs(Q_dot_is);
            Q_dot_set_use = abs(Q_dot_set);

            if prosumer_mode == -1 then // consumption mode
              pi_set = 1;
              mu_set = -1;
              T_prim_relev_des = T_sec_hot_des;
              T_prim_relev_is = T_sec_hot;
              T_sec_relev_des = DeltaT_prim_des;
              T_sec_relev_is = T_prim_hot-T_prim_cold;

              PIDin_prim_cons_is_weighted    = alpha_prim_cons*Q_dot_is_use/Delta_Qdot_norm + beta_prim_cons*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_cons_des_weighted   = alpha_prim_cons*Q_dot_set_use/Delta_Qdot_norm + beta_prim_cons*T_prim_relev_des/Delta_T_norm;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = alpha_sec_cons*Q_dot_is_use/Delta_Qdot_norm + beta_sec_cons*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_cons_des_weighted    = alpha_sec_cons*Q_dot_set_use/Delta_Qdot_norm + beta_sec_cons*T_sec_relev_des/Delta_T_norm;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = PIDin_prim_cons_des_weighted - PIDin_prim_cons_is_weighted;
              error_sec_weighted             = PIDin_sec_cons_des_weighted - PIDin_sec_cons_is_weighted;

              error_T_prim_abs               = DeltaT_prim_des - Delta_T_prim;
              error_T_sec_abs                = T_sec_hot_des - T_sec_hot;

              error_T_high_prio_abs          = T_sec_hot_des - T_sec_hot; // T_sec_hot
              error_T_low_prio_abs           = DeltaT_prim_des - Delta_T_prim; // Delta_T_prim

            elseif prosumer_mode == 1 then // production mode
              pi_set = 1;
              mu_set = 1;
              T_prim_relev_des = T_prim_hot_des;
              T_prim_relev_is = T_prim_hot;
              T_sec_relev_des = DeltaT_sec_des;
              T_sec_relev_is = T_sec_hot-T_sec_cold;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = alpha_prim_prod*Q_dot_is_use/Delta_Qdot_norm + beta_prim_prod*(-1)*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_prod_des_weighted   = alpha_prim_prod*Q_dot_set_use/Delta_Qdot_norm + beta_prim_prod*(-1)*T_prim_relev_des/Delta_T_norm;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = alpha_sec_prod*Q_dot_is_use/Delta_Qdot_norm + beta_sec_prod*(-1)*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_prod_des_weighted    = alpha_sec_prod*Q_dot_set_use/Delta_Qdot_norm + beta_sec_prod*(-1)*T_sec_relev_des/Delta_T_norm;

              error_prim_weighted            = PIDin_prim_prod_des_weighted - PIDin_prim_prod_is_weighted;
              error_sec_weighted             = PIDin_sec_prod_des_weighted - PIDin_sec_prod_is_weighted;

              error_T_prim_abs               = T_prim_hot_des - T_prim_hot;
              error_T_sec_abs                = DeltaT_sec_des - Delta_T_sec;

              error_T_high_prio_abs          = T_prim_hot_des - T_prim_hot;
              error_T_low_prio_abs           = DeltaT_sec_des - Delta_T_sec;

            else // idle mode
              pi_set = 0;
              mu_set = -1;
              T_prim_relev_des = 0;
              T_prim_relev_is = 0;
              T_sec_relev_des = 0;
              T_sec_relev_is = 0;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = 0;
              error_sec_weighted             = 0;

              error_T_prim_abs               = 0;
              error_T_sec_abs                = 0;

              error_T_high_prio_abs          = 0;
              error_T_low_prio_abs           = 0;

            end if;

            // assign PID controller inputs
            PID_prim_cons.u_s    = PIDin_prim_cons_des_weighted;
            PID_prim_cons.u_m    = PIDin_prim_cons_is_weighted;
            PID_prim_prod.u_s    = PIDin_prim_prod_des_weighted;
            PID_prim_prod.u_m    = PIDin_prim_prod_is_weighted;
            PID_sec_cons.u_s     = PIDin_sec_cons_des_weighted;
            PID_sec_cons.u_m     = PIDin_sec_cons_is_weighted;
            PID_sec_prod.u_s     = PIDin_sec_prod_des_weighted;
            PID_sec_prod.u_m     = PIDin_sec_prod_is_weighted;

            // connect secondary side temperature setpoint
            T_sec_set    =  T_sec_in_is;

            // assign PID outputs to controller outputs
            if prosumer_mode == -1 then // consumption mode
              u_set = 0;
              kappa_set =PID_prim_cons.y;
              V_dot_sec_set = PID_sec_cons.y;
            elseif prosumer_mode == 1 then // production mode
              u_set =PID_prim_prod.y;
              kappa_set = 0;
              V_dot_sec_set = PID_sec_prod.y;
            else // idle mode
              V_dot_sec_set = 0;
              u_set = 0;
              kappa_set = 0;
            end if;

            error_Q_abs = Q_dot_set_use - Q_dot_is_use;

            // assign control variables vector
            contr_vars_real[1]   =  T_sec_set;
            contr_vars_real[2]   =  V_dot_sec_set;
            contr_vars_real[3]   =  pi_set;
            contr_vars_real[4]   =  mu_set;
            contr_vars_real[5]   =  u_set;
            contr_vars_real[6]   =  kappa_set;

              annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{
                      120,180}}),                                           graphics={
                    Text(
                    extent={{-70,56},{64,-56}},
                    textColor={28,108,200},
                    textString="weighted
PID"),           Rectangle(extent={{-120,180},{120,-160}}, lineColor={0,0,0})}),
                                                                             Diagram(
                  coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{120,180}})));
          end PID_Q_T_weighted_mix1;

          model PID_Q_T_weighted_mix2

            import Modelica.Units.SI;
            import T_AbsZeroDegC = Modelica.Constants.T_zero;
            import Modelica.Blocks.Types.Init;
            import Modelica.Blocks.Types.SimpleController;

              // !!!!! parameters !!!!!
            parameter Real Delta_Qdot_norm = 1
                "Heat power value for normalizing the error (deviation) of the transferred heat.
      For alpha=0.5 a deviation of Delta_Qdot_norm in heat transfer is weigthed equal to a deviation of Delta_T_norm in temperature."
                annotation(Dialog(group="Normalizing values"));
            parameter SI.TemperatureDifference Delta_T_norm(min=0) = 3
                "Temperature difference for normalizing the error (deviation) of the temperature.
      For alpha=0.5 a deviation of Delta_T_norm in temperature is weighted equal to a deviation of Delta_Qdot_norm in heat transfer."
                annotation(Dialog(group="Normalizing values"));

            parameter SI.Temperature T_prim_hot_des(min=277)= - T_AbsZeroDegC + 53.5
                "desired temperature supply primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.Temperature T_sec_hot_des(min=277)= - T_AbsZeroDegC + 50
                "desired temperature supply secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_prim_des(min=1) =   20
                "desired temperature difference primary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter SI.TemperatureDifference DeltaT_sec_des(min=1) =   20
                "desired temperature difference secondary side"
                annotation(Dialog(group="Temperature objectives"));
            parameter Real V_dot_sec_max(unit="l/min", displayUnit="l/min") = 8.5
              "maximum secondary side volume flow in [l/min]"
              annotation(Dialog(group="General PID settings"));
            parameter Real k_prim_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Ti_prim_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real Td_prim_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real alpha_prim_prod(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - producer mode - tuning"));
            parameter Real k_sec_prod = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Ti_sec_prod = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real Td_sec_prod = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real alpha_sec_prod(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - producer mode - tuning"));
            parameter Real k_prim_cons = 1.0
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Ti_prim_cons = 35
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real Td_prim_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real alpha_prim_cons(min=0, max=1) = 0.666
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID primary side - consumer mode - tuning"));
            parameter Real k_sec_cons = 1.5
              "Proportional gain for controller in [-]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Ti_sec_cons = 8
              "Integral time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real Td_sec_cons = 0
              "Derivative time constant for controller in [s]"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter Real alpha_sec_cons(min=0, max=1) = 0.333
              "weight for the relevance of the error of the transferred heat in comparison to the error of temperature objectives (sum is one)"
              annotation(Dialog(group="PID secondary side - consumer mode - tuning"));
            parameter .Modelica.Blocks.Types.SimpleController controllerType=
                   Modelica.Blocks.Types.SimpleController.PID "Type of controller"
                   annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Init initType = Modelica.Blocks.Types.Init.NoInit
              "Type of initialization (1: no init, 2: steady state, 3: initial state, 4: initial output)"
              annotation(Dialog(tab="Advanced", group="PIDs general"));
            parameter Real tol = 0.1
              "tolerance [kW] for idle mode concerning heat transfer setpoint dotQ"
              annotation(Dialog(tab="Advanced", group="Miscellaneous"));

            // !!!!! variables !!!!!
            Real beta_prim_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_prod(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_prim_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Real beta_sec_cons(min=0, max=1)
              "weight for the relevance of the error of the temperature(difference)";
            Integer  prosumer_mode
              "prosumer mode {-1;0;1}";
            Real T_prim_relev_des
                "desired value of relevant temperature (difference)
      for control of primary side";
            Real T_prim_relev_is
                "current value of relevant temperature (difference)
      for control of primary side";
            Real T_sec_relev_des
                "desired value of relevant temperature (difference)
      for control of secondary side";
            Real T_sec_relev_is
                "current value of relevant temperature (difference)
      for control of secondary side";

            Real PIDin_prim_cons_is_weighted
                "weighted input of is-values for PID_prim_cons";
            Real PIDin_prim_cons_des_weighted
                "weighted input of desired values for PID_prim_cons";
            Real PIDin_prim_prod_is_weighted
                "weighted input of is-values for PID_prim_prod";
            Real PIDin_prim_prod_des_weighted
                "weighted input of desired values for PID_prim_prod";
            Real PIDin_sec_cons_is_weighted
                "weighted input of is-values for PID_sec_cons";
            Real PIDin_sec_cons_des_weighted
                "weighted input of desired values for PID_sec_cons";
            Real PIDin_sec_prod_is_weighted
                "weighted input of is-values for PID_sec_prod";
            Real PIDin_sec_prod_des_weighted
                "weighted input of desired values for PID_sec_prod";

            Real error_prim_weighted
                "weighted overall error of primary side controller";

            Real error_sec_weighted
                "weighted overall error of primary side controller";

            Real error_T_prim_abs
                "temperature error of primary side controller";

            Real error_T_sec_abs
                "temperature error of primary side controller";

            Real error_Q_abs
                "temperature error of primary side controller";

            Real error_T_high_prio_abs
                "error of higher prioritized temperature objective";

            Real error_T_low_prio_abs
                "error of lower prioritized temperature objective";

            Real Delta_T_prim
                "weighted overall error of primary side controller";

            Real Delta_T_sec
                "weighted overall error of primary side controller";

            Real Q_dot_is_use;
            Real Q_dot_set_use;

             Real Delta_p_prim(unit="Pa", displayUnit="bar") annotation (
                Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=180,
                  origin={-80,-140})));

            // !!!!! ports !!!!!

            Modelica.Blocks.Interfaces.RealVectorInput states[8]
              annotation (Placement(transformation(extent={{-140,-20},{-100,20}})));

            Modelica.Blocks.Interfaces.RealVectorOutput contr_vars_real[6]
              annotation (Placement(transformation(extent={{100,-20},{140,20}})));

            Real u_set
              "Normalized velocity of feed-in pump"
                annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-60}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-60})));
            Real kappa_set
              "Normalized flow coefficient for control valve"
               annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-100}),iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-100})));
            Real pi_set
              "Participation" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,20}),    iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,20})));
            Real mu_set
              "Operating mode" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,-20}),  iconTransformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={100,-20})));
            Real T_sec_hot(
              unit="K",
              displayUnit="degC",
              min=277) "current temperature hot level secondary side"      annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,60})));
            Real T_sec_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature cold  level secondary side"    annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,20})));
            Real T_prim_hot(
              unit="K",
              displayUnit="degC",
              min=277)
                     "current temperature hot level primary side"        annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,140})));
            Real T_prim_cold(
              unit="K",
              displayUnit="degC",
              min=277)
                      "current temperature cold level primary side"       annotation (Placement(
                  transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={-80,100})));
            Modelica.Blocks.Interfaces.RealInput Q_dot_set(unit="kW", displayUnit="kW")
              "setpoint heat transfer (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-20,-20},{20,20}},
                  rotation=-90,
                  origin={-60,188})));
            Real V_dot_prim(unit="l/min", displayUnit="l/min")
              annotation (Placement(transformation(extent={{-100,-40},{-60,0}})));
            Real V_dot_sec(unit="l/min", displayUnit="l/min")
              annotation (Placement(transformation(extent={{-100,-80},{-60,-40}})));

            Real Q_dot_is(unit="kW", displayUnit="kW")
              "currently transferred heat (positive production, negative consumption)"
              annotation (Placement(transformation(extent={{-100,-120},{-60,-80}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_cons(
              controllerType=controllerType,
              k=k_prim_cons,
              Ti=Ti_prim_cons,
              Td=Td_prim_cons,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_cons.yMax)
              annotation (Placement(transformation(extent={{-30,-32},{-10,-12}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_cons(
              controllerType=controllerType,
              k=k_sec_cons,
              Ti=Ti_sec_cons,
              Td=Td_sec_cons,
              yMax=V_dot_sec_max,
              yMin=2,
              initType=initType,
              y_start=PID_sec_cons.yMax)
              annotation (Placement(transformation(extent={{-34,28},{-14,48}})));
            Modelica.Blocks.Continuous.LimPID PID_prim_prod(
              controllerType=controllerType,
              k=k_prim_prod,
              Ti=Ti_prim_prod,
              Td=Td_prim_prod,
              yMax=1,
              yMin=0.25,
              initType=initType,
              y_start=PID_prim_prod.yMax) annotation (Placement(transformation(extent={{12,-30},
                      {32,-10}})));
            Modelica.Blocks.Continuous.LimPID PID_sec_prod(
              controllerType=controllerType,
              k=k_sec_prod,
              Ti=Ti_sec_prod,
              Td=Td_sec_prod,
              yMax=V_dot_sec_max,
              yMin=2,
              initType=initType,
              y_start=PID_sec_prod.yMax) annotation (Placement(transformation(extent={{10,28},
                      {30,48}})));
            Real T_sec_set(unit="K", displayUnit="degC")
               "Temperature on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,100})));
            Real V_dot_sec_set(unit="l/min", displayUnit=
                 "l/min") "volume flow rate setpoint on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=0,
                  origin={80,60})));
            Modelica.Blocks.Interfaces.RealInput T_sec_in_is(unit="K", displayUnit="degC")
              "Temperature on the secondary side" annotation (Placement(transformation(
                  extent={{-20,-20},{20,20}},
                  rotation=270,
                  origin={60,190})));

          equation

            // assign inputs
            T_prim_hot   = states[1];
            T_prim_cold  = states[2];
            T_sec_hot    = states[3];
            T_sec_cold   = states[4];
            V_dot_prim   = states[5];
            V_dot_sec    = states[6];
            Q_dot_is     = states[7];
            Delta_p_prim = states[8];

            Delta_T_prim      = T_prim_hot -T_prim_cold;
            Delta_T_sec       = T_sec_hot  -T_sec_cold;

            beta_prim_prod = 1 - alpha_prim_prod;
            beta_sec_prod  = 1 - alpha_sec_prod;
            beta_prim_cons = 1 - alpha_prim_cons;
            beta_sec_cons  = 1 - alpha_sec_cons;

            // determine easy static values that just depend on prosumer mode
            // determine inputs for the four PIDs
            // four PIDs in order to be able to have different gains for each situation

            if  Q_dot_set <= 0-tol then // consumption mode
              prosumer_mode = -1;
            elseif Q_dot_set >= 0+tol then // production mode
              prosumer_mode = +1;
            else // idle mode
              prosumer_mode = 0;
            end if;

            Q_dot_is_use = abs(Q_dot_is);
            Q_dot_set_use = abs(Q_dot_set);

            if prosumer_mode == -1 then // consumption mode
              pi_set = 1;
              mu_set = -1;
              T_prim_relev_des = DeltaT_prim_des;
              T_prim_relev_is = T_prim_hot-T_prim_cold;
              T_sec_relev_des = T_sec_hot_des;
              T_sec_relev_is = T_sec_hot;

              PIDin_prim_cons_is_weighted    = alpha_prim_cons*Q_dot_is_use/Delta_Qdot_norm + beta_prim_cons*(-1)*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_cons_des_weighted   = alpha_prim_cons*Q_dot_set_use/Delta_Qdot_norm + beta_prim_cons*(-1)*T_prim_relev_des/Delta_T_norm;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = alpha_sec_cons*Q_dot_is_use/Delta_Qdot_norm + beta_sec_cons*(-1)*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_cons_des_weighted    = alpha_sec_cons*Q_dot_set_use/Delta_Qdot_norm + beta_sec_cons*(-1)*T_sec_relev_des/Delta_T_norm;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = PIDin_prim_cons_des_weighted - PIDin_prim_cons_is_weighted;
              error_sec_weighted             = PIDin_sec_cons_des_weighted - PIDin_sec_cons_is_weighted;

              error_T_prim_abs               = DeltaT_prim_des - Delta_T_prim;
              error_T_sec_abs                = T_sec_hot_des - T_sec_hot;

              error_T_high_prio_abs          = T_sec_hot_des - T_sec_hot;
              error_T_low_prio_abs           = DeltaT_prim_des - Delta_T_prim;

            elseif prosumer_mode == 1 then // production mode
              pi_set = 1;
              mu_set = 1;
              T_prim_relev_des = DeltaT_sec_des;
              T_prim_relev_is = T_sec_hot-T_sec_cold;
              T_sec_relev_des = T_prim_hot_des;
              T_sec_relev_is = T_prim_hot;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = alpha_prim_prod*Q_dot_is_use/Delta_Qdot_norm + beta_prim_prod*T_prim_relev_is/Delta_T_norm;
              PIDin_prim_prod_des_weighted   = alpha_prim_prod*Q_dot_set_use/Delta_Qdot_norm + beta_prim_prod*T_prim_relev_des/Delta_T_norm;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = alpha_sec_prod*Q_dot_is_use/Delta_Qdot_norm + beta_sec_prod*T_sec_relev_is/Delta_T_norm;
              PIDin_sec_prod_des_weighted    = alpha_sec_prod*Q_dot_set_use/Delta_Qdot_norm + beta_sec_prod*T_sec_relev_des/Delta_T_norm;

              error_prim_weighted            = PIDin_prim_prod_des_weighted - PIDin_prim_prod_is_weighted;
              error_sec_weighted             = PIDin_sec_prod_des_weighted - PIDin_sec_prod_is_weighted;

              error_T_prim_abs               = T_prim_hot_des - T_prim_hot;
              error_T_sec_abs                = DeltaT_sec_des - Delta_T_sec;

              error_T_high_prio_abs          = T_prim_hot_des - T_prim_hot; // T_pim_hot
              error_T_low_prio_abs           = DeltaT_sec_des - Delta_T_sec; // Deltat_T_sec

            else // idle mode
              pi_set = 0;
              mu_set = -1;
              T_prim_relev_des = 0;
              T_prim_relev_is = 0;
              T_sec_relev_des = 0;
              T_sec_relev_is = 0;

              PIDin_prim_cons_is_weighted    = 0;
              PIDin_prim_cons_des_weighted   = 0;
              PIDin_prim_prod_is_weighted    = 0;
              PIDin_prim_prod_des_weighted   = 0;
              PIDin_sec_cons_is_weighted     = 0;
              PIDin_sec_cons_des_weighted    = 0;
              PIDin_sec_prod_is_weighted     = 0;
              PIDin_sec_prod_des_weighted    = 0;

              error_prim_weighted            = 0;
              error_sec_weighted             = 0;

              error_T_prim_abs               = 0;
              error_T_sec_abs                = 0;

              error_T_high_prio_abs          = 0;
              error_T_low_prio_abs           = 0;

            end if;

            // assign PID controller inputs
            PID_prim_cons.u_s    = PIDin_prim_cons_des_weighted;
            PID_prim_cons.u_m    = PIDin_prim_cons_is_weighted;
            PID_prim_prod.u_s    = PIDin_prim_prod_des_weighted;
            PID_prim_prod.u_m    = PIDin_prim_prod_is_weighted;
            PID_sec_cons.u_s     = PIDin_sec_cons_des_weighted;
            PID_sec_cons.u_m     = PIDin_sec_cons_is_weighted;
            PID_sec_prod.u_s     = PIDin_sec_prod_des_weighted;
            PID_sec_prod.u_m     = PIDin_sec_prod_is_weighted;

            // connect secondary side temperature setpoint
            T_sec_set    =  T_sec_in_is;

            // assign PID outputs to controller outputs
            if prosumer_mode == -1 then // consumption mode
              u_set = 0;
              kappa_set =PID_prim_cons.y;
              V_dot_sec_set = PID_sec_cons.y;
            elseif prosumer_mode == 1 then // production mode
              u_set =PID_prim_prod.y;
              kappa_set = 0;
              V_dot_sec_set = PID_sec_prod.y;
            else // idle mode
              V_dot_sec_set = 0;
              u_set = 0;
              kappa_set = 0;
            end if;

            error_Q_abs = Q_dot_set_use - Q_dot_is_use;

            // assign control variables vector
            contr_vars_real[1]   =  T_sec_set;
            contr_vars_real[2]   =  V_dot_sec_set;
            contr_vars_real[3]   =  pi_set;
            contr_vars_real[4]   =  mu_set;
            contr_vars_real[5]   =  u_set;
            contr_vars_real[6]   =  kappa_set;

              annotation (Icon(coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{
                      120,180}}),                                           graphics={
                    Text(
                    extent={{-70,56},{64,-56}},
                    textColor={28,108,200},
                    textString="weighted
PID"),           Rectangle(extent={{-120,180},{120,-160}}, lineColor={0,0,0})}),
                                                                             Diagram(
                  coordinateSystem(preserveAspectRatio=false, extent={{-120,-160},{120,180}})));
          end PID_Q_T_weighted_mix2;

          package auxiliary
            block TimeTable_noInterp
              "Generate a discontinuous and non-interpolated signal from a table by using the forward value."

              parameter Real table[:, 2] = fill(0.0, 0, 2)
                "Table matrix (time = first column; e.g., table=[0, 0; 1, 1; 2, 4])"
                annotation(Dialog(groupImage="modelica://Modelica/Resources/Images/Blocks/Sources/TimeTable.png"));
              parameter Modelica.Units.SI.Time timeScale(min=Modelica.Constants.eps)=1
                "Time scale of first table column" annotation (Evaluate=true);
              extends Modelica.Blocks.Interfaces.SignalSource;
              parameter Modelica.Units.SI.Time shiftTime=startTime
                "Shift time of first table column";
            protected
              discrete Real a "Interpolation coefficient a of actual interval (y=a*x+b)";
              discrete Real b "Interpolation coefficient b of actual interval (y=a*x+b)";
              Integer last(start=1) "Last used lower grid index";
              discrete Modelica.Units.SI.Time nextEvent(start=0, fixed=true)
                "Next event instant";
              discrete Real nextEventScaled(start=0, fixed=true)
                "Next scaled event instant";
              Real timeScaled "Scaled time";

              function getInterpolationCoefficients
                "Determine interpolation coefficients and next time event"
                extends Modelica.Icons.Function;
                input Real table[:, 2] "Table for interpolation";
                input Real offset "y-offset";
                input Real startTimeScaled "Scaled time-offset";
                input Real timeScaled "Actual scaled time instant";
                input Integer last "Last used lower grid index";
                input Real TimeEps "Relative epsilon to check for identical time instants";
                input Real shiftTimeScaled "Time shift";
                output Real a "Interpolation coefficient a (y=a*x + b)";
                output Real b "Interpolation coefficient b (y=a*x + b)";
                output Real nextEventScaled "Next scaled event instant";
                output Integer next "New lower grid index";
              protected
                Integer columns=2 "Column to be interpolated";
                Integer ncol=2 "Number of columns to be interpolated";
                Integer nrow=size(table, 1) "Number of table rows";
                Integer next0;
                Real tp;
                Real dt;
              algorithm
                next := last;
                nextEventScaled := timeScaled - TimeEps*abs(timeScaled);
                // in case there are no more time events
                tp := timeScaled + TimeEps*abs(timeScaled);

                if tp < startTimeScaled then
                  // First event not yet reached
                  nextEventScaled := startTimeScaled;
                  a := 0;
                  b := offset;
                elseif nrow < 2 then
                  // Special action if table has only one row
                  a := 0;
                  b := offset + table[1, columns];
                else
                  tp := tp - shiftTimeScaled;
                  // Find next time event instant. Note, that two consecutive time instants
                  // in the table may be identical due to a discontinuous point.
                  while next < nrow and tp >= table[next, 1] loop
                    next := next + 1;
                  end while;

                  // Define next time event, if last table entry not reached
                  if next < nrow then
                    nextEventScaled := shiftTimeScaled + table[next, 1];
                  end if;

                  // Determine interpolation coefficients
                  if next == 1 then
                    next := 2;
                  end if;
                  next0 := next - 1;
                  dt := table[next, 1] - table[next0, 1];
                  if dt <= TimeEps*abs(table[next, 1]) then
                    // Interpolation interval is not big enough, use "next" value
                    a := 0;
                    b := offset + table[next, columns];
                  else
                    a := table[next0, columns]; // (table[next, columns] - table[next0, columns])/dt;
                    b := 0; // offset + table[next0, columns] - a*table[next0, 1];
                  end if;
                end if;
                // Take into account shiftTimeScaled "a*(time - shiftTime) + b"
                b := b - a*shiftTimeScaled;
              end getInterpolationCoefficients;
            algorithm
              if noEvent(size(table, 1) > 1) then
                assert(not (table[1, 1] > 0.0 or table[1, 1] < 0.0), "The first point in time has to be set to 0, but is table[1,1] = " + String(table[1, 1]));
              end if;
              when {time >= pre(nextEvent),initial()} then
                (a,b,nextEventScaled,last) := getInterpolationCoefficients(
                    table,
                    offset,
                    startTime/timeScale,
                    timeScaled,
                    last,
                    100*Modelica.Constants.eps,
                    shiftTime/timeScale);
                nextEvent := nextEventScaled*timeScale;
              end when;
            equation
              assert(size(table, 1) > 0, "No table values defined.");
              timeScaled = time/timeScale;
              y = a; // a*timeScaled + b;
              annotation (
                Icon(coordinateSystem(
                    preserveAspectRatio=true,
                    extent={{-100,-100},{100,100}}), graphics={
                    Line(points={{-80,68},{-80,-80}}, color={192,192,192}),
                    Polygon(
                      points={{-80,90},{-88,68},{-72,68},{-80,90}},
                      lineColor={192,192,192},
                      fillColor={192,192,192},
                      fillPattern=FillPattern.Solid),
                    Line(points={{-90,-70},{82,-70}}, color={192,192,192}),
                    Polygon(
                      points={{90,-70},{68,-62},{68,-78},{90,-70}},
                      lineColor={192,192,192},
                      fillColor={192,192,192},
                      fillPattern=FillPattern.Solid),
                    Rectangle(
                      extent={{-48,70},{2,-50}},
                      lineColor={255,255,255},
                      fillColor={192,192,192},
                      fillPattern=FillPattern.Solid),
                    Line(points={{-48,-50},{-48,70},{52,70},{52,-50},{-48,-50},{-48,-20},
                          {52,-20},{52,10},{-48,10},{-48,40},{52,40},{52,70},{2,70},{2,-51}}),
                    Text(
                      extent={{-150,-150},{150,-110}},
                      textString="offset=%offset")}),
                    Documentation(info="<html>
<p>
This block generates an output signal by <strong>linear interpolation</strong> in
a table. The time points and function values are stored in a matrix
<strong>table[i,j]</strong>, where the first column table[:,1] contains the
time points and the second column contains the data to be interpolated.
The table interpolation has the following properties:
</p>
<ul>
<li>The interpolation interval is found by a linear search where the interval used in the
    last call is used as start interval.</li>
<li>The time points need to be <strong>monotonically increasing</strong>.</li>
<li><strong>Discontinuities</strong> are allowed, by providing the same
    time point twice in the table.</li>
<li>Values <strong>outside</strong> of the table range, are computed by
    <strong>extrapolation</strong> through the last or first two points of the
    table.</li>
<li>If the table has only <strong>one row</strong>, no interpolation is performed and
    the function value is just returned independently of the actual time instant.</li>
<li>Via parameters <strong>shiftTime</strong> and <strong>offset</strong> the curve defined
    by the table can be shifted both in time and in the ordinate value.
    The time instants stored in the table are therefore <strong>relative</strong>
    to <strong>shiftTime</strong>.</li>
<li>If time &lt; startTime, no interpolation is performed and the offset
    is used as ordinate value for the output.</li>
<li>If the table has more than one row, the first point in time <strong>always</strong> has to be set to <strong>0</strong>, e.g.,
    <strong>table=[1,1;2,2]</strong> is <strong>illegal</strong>. If you want to
    shift the time table in time use the <strong>shiftTime</strong> parameter instead.</li>
<li>The table is implemented in a numerically sound way by
    generating <strong>time events</strong> at interval boundaries.
    This generates continuously differentiable values for the integrator.</li>
<li>Via parameter <strong>timeScale</strong> the first column of the table array can
    be scaled, e.g., if the table array is given in hours (instead of seconds)
    <strong>timeScale</strong> shall be set to 3600.</li>
</ul>
<p>
Example:
</p>
<blockquote><pre>
   table = [0, 0;
            1, 0;
            1, 1;
            2, 4;
            3, 9;
            4, 16];
If, e.g., time = 1.0, the output y =  0.0 (before event), 1.0 (after event)
    e.g., time = 1.5, the output y =  2.5,
    e.g., time = 2.0, the output y =  4.0,
    e.g., time = 5.0, the output y = 23.0 (i.e., extrapolation).
</pre></blockquote>

<p>
<img src=\"modelica://Modelica/Resources/Images/Blocks/Sources/TimeTable.png\"
     alt=\"TimeTable.png\">
</p>

</html>",           revisions="<html>
<h4>Release Notes</h4>
<ul>
<li><em>Oct. 21, 2002</em>
       by Christian Schweiger:<br>
       Corrected interface from
<blockquote><pre>
parameter Real table[:, :]=[0, 0; 1, 1; 2, 4];
</pre></blockquote>
       to
<blockquote><pre>
parameter Real table[:, <strong>2</strong>]=[0, 0; 1, 1; 2, 4];
</pre></blockquote>
       </li>
<li><em>Nov. 7, 1999</em>
       by <a href=\"http://www.robotic.dlr.de/Martin.Otter/\">Martin Otter</a>:<br>
       Realized.</li>
</ul>
</html>"));
            end TimeTable_noInterp;

            model test_procedure

              parameter Real dotQ_low( min = 0) = 8
              "heat transfer setpoint for high heat transfer in test procedure";

              parameter Real dotQ_high( min= 0) = 12
              "heat transfer setpoint for low heat transfer in test procedure";

              parameter Real Tsecin_warm(  min= 0) = 45
              "warm inlet temperature for secondary side";

              parameter Real Tsecin_cold(  min= 0) = 30
               "cold inlet temperature for secondary side";

              parameter Real noise_mu( min = 0) = 0
              "mean value of noise for temperature"
              annotation(Dialog(group="Noise"));

              parameter Real noise_sigma( min = 0) = 5
              "standard deviation of noise for temperature"
              annotation(Dialog(group="Noise"));

              parameter Integer test_procedure[:,3] = [
                    0,0,0;
                    900,1,6;
                    1800,1,6;
                    2700,1,6;
                    3600,0,0;
                    4500,0,0;
                    5400,0,0;
                    6300,1,6;
                    7200,1,9;
                    8100,1,6;
                    9000,0,0;
                    9900,-1,6;
                    10800,-1,9;
                    11700,-1,6;
                    12600,0,0;
                    13500,1,9;
                    14400,0,0;
                    15300,0,0;
                    16200,-1,9;
                    17100,0,0;
                    18000,0,0]
              "time [s], prosumer mode (producer[1], consumer[-1], idle[0]), heat transfer (high[9], low[6])";

              Modelica.Blocks.Sources.CombiTimeTable combiTimeTable(
                tableOnFile=false,
                table=test_procedure,
                smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
                extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic)
                "time [s], prosumer mode (producer[1], consumer[-1], idle[0]), heat transfer (high[9], low[6])"
                annotation (Placement(transformation(extent={{-16,2},{4,22}})));

              Modelica.Blocks.Noise.NormalNoise normalNoise(
                samplePeriod=30,
                mu=noise_mu,
                sigma=noise_sigma)
                annotation (Placement(transformation(extent={{-62,-46},{-42,-26}})));

              Modelica.Blocks.Interfaces.RealOutput dotQ
                annotation (Placement(transformation(extent={{90,30},{110,50}})));
              Modelica.Blocks.Interfaces.RealOutput T
                annotation (Placement(transformation(extent={{90,-30},{110,-10}})));
              inner Modelica.Blocks.Noise.GlobalSeed globalSeed(enableNoise=false,
                  fixedSeed=4345)
                annotation (Placement(transformation(extent={{-80,64},{-60,84}})));
            equation

              if combiTimeTable.y[1] == 1 then
                T = Tsecin_warm + 273.15 + normalNoise.y;
                  if combiTimeTable.y[2] == 6 then
                    dotQ = dotQ_low;
                  elseif combiTimeTable.y[2] == 9 then
                    dotQ = dotQ_high;
                  else
                    dotQ = 0;
                  end if;
              elseif combiTimeTable.y[1] == -1 then
                T = Tsecin_cold + 273.15 + normalNoise.y;
                  if combiTimeTable.y[2] == 6 then
                    dotQ = -dotQ_low;
                  elseif combiTimeTable.y[2] == 9 then
                    dotQ = -dotQ_high;
                  else
                    dotQ = 0;
                  end if;
              else
                T = Tsecin_cold + 273.15;
                dotQ = 0;
              end if;

              annotation (Icon(coordinateSystem(preserveAspectRatio=false)), Diagram(
                    coordinateSystem(preserveAspectRatio=false)));
            end test_procedure;

            function simpleMATLAB_fileConverter
            "Function to import trajectory result files and write them as MatLab compatible .mat f
iles"
            input String filename="filename" "File to be converted" annotation (Dialog(__Dymola_loadSelector(filter="Matlab files (*.mat)",
            caption="Select the results trajectory file")));
            input String varOrigNames[:]={"Time","J1.w","J2.w"} "Variable names/headers in the fil
e in modelica syntax";
            input String varReNames[:]={"Time","Inertia_1_angularVel","Inertia_2_angularVel"}
            "Variable names which will appear in the MATLAB results file";
            input String outputFilename="outputFile.mat";
            protected
            Integer noRows "Number of rows in the trajectory being converted";
            Integer noColumn=12 "Number of columns in the trajectory being converted";
            Real data[:,:] "Data read in from trajectory file";
            Real dataDump[:,:] "Sacrificial dump variable for writeMatrix command";
            Integer i=2 "Loop counter";
            algorithm
            noRows := DymolaCommands.Trajectories.readTrajectorySize(filename);
            data := DymolaCommands.Trajectories.readTrajectory(
            filename,
            varOrigNames,
            noRows);
            data := transpose(data);
            noColumn := size(data, 2);
            while i <= noColumn loop
            dataDump := [data[:, 1],data[:, i]];
            if i == 2 then
            DymolaCommands.MatrixIO.writeMatrix(
            outputFilename,
            varReNames[i],
            dataDump);
            else
            DymolaCommands.MatrixIO.writeMatrix(
            outputFilename,
            varReNames[i],
            dataDump,
            true);
            end if;
            i := i + 1;
            end while;
            annotation (Documentation(info="<html>
<p></p>
</html>"),             uses(DymolaCommands(version="1.4")));
            end simpleMATLAB_fileConverter;
          end auxiliary;

        end Controller_PID_based;

      end BidirectionalSubstation_idealNet;
    end ideal_network;
  end Scenarios;
end Bidirectional_Substation;
